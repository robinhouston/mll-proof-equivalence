\documentclass{lmcs}

\usepackage{amssymb,amsthm,amsmath}
\usepackage{microtype}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{mathtools}


\usepackage{mllequiv,willemtools}

\graphicspath{{../notes/}}

\shortJournalNames
\makeTheoremDefs

\let\capsabbrev=\uppercase




% MLL
%   remove naming - work with occurrences instead ??
%   explain cut-elimination
%   define *-autonomous categories

% PROOF NETS
%   separate section for proof nets
%   discuss both small-step and big-step equivalence
%      connect jumps anywhere / to positive leaves (1,a) only
%   example translation: proof => net
% 
%   add 3-partition example
%

% CONSTRAINT LOGIC
%	add separate section for constraint logic
%	

% PARITY
%   stress alternation over n-arity
%   explain n-arity is safe
%   mention alternatives ??
%   clear up argument where possible

% CONSTRUCTION
%   clarify where possible





\title{Proof equivalence in MLL is PSPACE-complete}

\author{Willem Heijltjes and Robin Houston}


%============================================================

\begin{document}

\maketitle

% ACM classifications:
% F.2.2 - Nonnumerical Algorithms and Problems (Complexity of proof procedures)
% F.4.1 - Mathematical logic (Proof theory)

%\category{F.4.1}{Mathematical logic and formal languages}{Mathematical logic}[Proof theory]
%\category{F.2.2}{Analysis of algorithms and problem complexity}{Nonnumerical algorithms and problems}[Complexity of proof procedures]

%\keywords{linear logic, proof equivalence, proof nets, constraint logic, \capsabbrev{pspace}-completeness}

\begin{abstract}
\capsabbrev{mll} proof equivalence is the problem of deciding whether two proofs in multiplicative linear logic are related by a series of inference permutations.
%
It is also known as the word problem for $*$-autonomous categories.
%
Previous work has shown the problem to be equivalent to a rewiring problem on proof nets, which are not canonical for full \capsabbrev{mll} due to the presence of the two units.
%
Drawing from recent work on reconfiguration problems, in this paper it is shown that \capsabbrev{mll} proof equivalence is \capsabbrev{pspace}-complete, using a reduction from Nondeterministic Constraint Logic.
%
An important consequence of the result is that the existence of a satisfactory notion of proof nets for \capsabbrev{mll} with units is ruled out (under current complexity assumptions).
\end{abstract}

%------------------------------------------------------------


\section{Introduction}


%

\cite{Lambek-1968}

\cite{Girard-1987,Danos-Regnier-1989}
\cite{Trimble-1994,Blute-Cockett-Seely-Trimble-1996}
\cite{Lamarche-Strassburger-2006}
\cite{HughesFreeStar,HughesMLLProofNets}


\cite{Hughes-vanGlabbeek-2005}
\cite{Heijltjes-2011}

\cite{Demaine-Hearn-2008}

\cite{ReconfigurationProblems}
\cite{Kanovich-1992,Lincoln-Winkler-1994}.




%------------------------------------------------------------


\section{\capsabbrev{mll}}




The formulae of unit-only multiplicative linear logic are given by the following grammar.
%
\setMidspace{5pt}
\[
	A,B,C \Coloneq \bot \Mid 1 \Mid A\parr B \Mid A\tn B
\]
%
The connectives $\tn$ and $\parr$ will be considered up to associativity, and \emph{duality} $\dual A$ is via DeMorgan.
%
A \emph{sequent} $\Gamma,\Delta$ will be a multiset of formulae.
%
Within a sequent, connectives and units will be \emph{named} with distinct elements from an arbitrary set of names, e.g.\
\[
	\named a1\named b\parr\named c1,\named d\bot\named e\tn\named f\bot~.
\]
%
This allows to 1) identify \emph{occurrences} of subformulae uniquely by the name of their root connective, e.g.\ as $\named bA$, 2) distinguish the two proofs of the above sequent while using standard multiset sequents, and 3) easily extract proof nets, as graphs using the names of connectives as vertices.
%
Names will often be left implicit.



Proofs are constructed from the inference rules in Figure~\ref{fig:MLL}, where the names of units and connectives are preserved through inferences.
%
Only cut-free proofs are considered, and no cut-rule is added.
%
\emph{Permutations} of inference rules are displayed in Figure~\ref{fig:permutations}; the symmetric variants of the last two permutations, \emph{par-tensor} and \emph{tensor-tensor}, have been omitted.



\begin{definition}
\label{def:equivalence}
%
\emph{Equivalence} $(\perm)$ of proofs in (cut-free, unit-only) multiplicative linear logic is the congruence generated by the permutations given in Figure~\ref{fig:permutations}.
%
\emph{\capsabbrev{mll}\ proof equivalence} is the problem of deciding whether two given proofs are equivalent.
%
\end{definition}


The permutations of sequent proofs are exactly the identifications imposed by the categorical semantics of \capsabbrev{mll}, star-autonomous categories \cite{Barr-1991} (and semi-star-autonomous categories \cite{Houston-2008,Heijltjes-Strassburger} for \capsabbrev{mll} without units).
%
Proof equivalence for \capsabbrev{mll} is therefore equivalent to the \emph{word problem} for star-autonomous categories: the problem whether two term representations denote the same morphism in any star-autonomous category.


\begin{figure}
\quad\MLLrule b
\hfill\MLLrule 1
\hfill\MLLrule p
\hfill\MLLrule t
\quad
\caption{Inference rules for unit-only \capsabbrev{mll}}
\label{fig:MLL}
\end{figure}


\begin{figure}[!tb]
\renewcommand\scalefactor{0.88}
\[
\begin{array}{@{}rcl@{}}
	\multicolumn{3}{@{}c@{}}{
		\vc{\scale{\MLLperm{bb1}}} ~\perm~ \vc{\scale{\MLLperm{bb2}}}
		\hfill
		\vc{\scale{\MLLperm{bp1}}} ~\perm~ \vc{\scale{\MLLperm{bp2}}}
	}
\\ \\[6pt]
	\multicolumn{3}{@{}c@{}}{
		\vc{\scale{\MLLperm{bt2}}} ~\perm~ \vc{\scale{\MLLperm{bt1}}}
								   ~\perm~ \vc{\scale{\MLLperm{bt3}}}
	}
\\ \\[6pt]
	\vc{\scale{\MLLperm{pp1}}} &\perm& \vc{\scale{\MLLperm{pp2}}}
\\ \\[6pt]
	\vc{\scale{\MLLperm{pt1}}} &\perm& \vc{\scale{\MLLperm{pt2}}}
\\ \\[6pt]
	\vc{\scale{\MLLperm{tt1}}} &\perm& \vc{\scale{\MLLperm{tt2}}}
\end{array}
\]
\caption{Permutations}
\label{fig:permutations}
\end{figure}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Proof nets}


Proof nets provide a solution to proof equivalence for \capsabbrev{mll} without units.
%
For full \capsabbrev{mll}, they reduce the proof equivalence problem to a simple rewiring relation \cite{HughesMLLProofNets}.


\begin{definition}
\label{def:proof nets}
%
For a sequent $\Gamma$,
\begin{itemize}

	\item
	a \emph{linking} $\links$ is a function from the names of $\bot$-subformulae to the names of $1$-subformulae,

	\item
	a \emph{switching graph} for $\links$ is an undirected graph over the names of $\Gamma$, with for every subformula $\named aA\named c\tn\named bB$ the edges $\edge ac$ and $\edge bc$, for every subformula $\named aA\named c\parr\named bB$ either the edge $\edge ac$ or the edge $\edge bc$, and for every subformula $\named a\bot$ the edge $\edge a{\links(a)}$,

 	\item
	a \emph{proof net} $\links$ or $(\Gamma,\links)$ is a linking $\links$ such that every switching graph is acyclic and connected.

\end{itemize}
\end{definition}


\noindent
An edge $\edge a{\links(a)}$ in a proof net or switching graph is called a \emph{link} or a \emph{jump}.
%
The restriction that jumps must target $\1$-occurrences (rather than any connective) is a convenience---it can be circumvented by replacing a subformula $A$ by the equivalent $A\tn\1$.


\begin{figure}
\[
	\netA 1223 ~\perm*~
	\netA 1323 ~\perm*~
	\netA 1321 ~\perm*~
	\netA 2321
\]
\caption{A rewiring sequence on proof nets}
\label{fig:net rewiring}
\end{figure}


\begin{definition}
\label{def:proof net equivalence}
%
A \emph{rewiring} $(\perm*)$ between proof nets is the redirection of exactly one link.
%
\emph{Equivalence} $(\perm)$ of proof nets over a sequent $\Gamma$ is the equivalence generated by rewiring.
%
\end{definition}

\noindent
An example rewiring sequence is given in Figure~\ref{fig:net rewiring}, using the notation for proof nets introduced below.



To translate a sequent proof to a proof net requires to find a target for each jump from a $\bot$-formula.
%
The inference rule for $\bot$ introduces it into a sequent $\Gamma$; in the corresponding proof net, any occurrence of $\1$ in $\Gamma$ may serve as the target of the jump.


\begin{definition}
\label{def:proofs to nets}
%
The relation $(\toNet)$ interprets a proof $\Pi$ for a sequent $\Delta$ by a linking $\links$ as follows:
% 
$\Pi\toNet\links$ if for each $\named a\bot$ in $\Delta$, if $\Gamma$ is the context of the inference introducing $\named a\bot$, as illustrated below, then $\links(a)$ is the name of some $1$ in $\Gamma$.
\[
	\infer[\MLLlabel b]{\Gamma,\named a\bot}{\Gamma}
\]
%
\end{definition}



\begin{proposition}[\cite{Danos-Regnier-1989}, \cite{Lamarche-Strassburger-2006}]
\label{prop:correctness and sequentialisation}
%
%
If $\Pi\toNet\links$ and $\Pi$ has conclusion $\Gamma$, then $\links$ is a proof net for $\Gamma$.
%
For a net $\links$ for $\Gamma$, there is a proof $\Pi$ of $\Gamma$ such that $\Pi\toNet\links$ (\emph{sequentialisation}).
%
\end{proposition}


\noindent
Proof nets are a canonical representation of proofs in the absence of the units: they factor out the permutations among tensor- and par-inferences, which are the last three permutations in Figure~\ref{fig:permutations}.
%
Equivalence of proof nets is generated by the four remaining permutations, on $\bot$-introduction.



\begin{proposition}[\cite{HughesMLLProofNets}]
\label{prop:proof nets work}
%
For proofs $\Pi$, $\Pi'$ and proof nets $\links$, $\links'$, if $\Pi\toNet\links$ and $\Pi'\toNet\links'$, then $\Pi\perm\Pi'$ if and only if $\links\perm\links'$.
%
\end{proposition}


\noindent
The above proposition means that \capsabbrev{mll}\ proof equivalence is the problem of deciding equivalence of proof nets.


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Notation}


We will use a concise diagrammatic notation for sequents and proof nets.
%
The units $1$ and $\bot$ are represented by a circle~($\circ$) and a disc~($\bullet$) respectively;
%
formulae related by a tensor will be connected by edges; 
formulae related by a par will be juxtaposed, and collected in a box when a par-formula is an immediate subformula of a tensor-formula (and also for illustrative purposes).
%
For example, the following denote the same sequent:
\[
	\bot\tn\bot,\bot\tn\bot,\1,(\1\parr\1\parr\1)\tn\bot
\]
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (0,0) node[bullet] (a) {} -- (1,0) node[bullet] (b) {} (2,0) node[bullet] (c) {} -- (3,0) node[bullet] (d) {};
	\node[circ] (1) at (4,0) {};
	\node[circ] (2) at (5.25,0) {}; \node[circ] (3) at (6.25,0) {}; \node[circ] (4) at (7.25,0) {};
	\draw[rounded corners] (4.75,-1) rectangle (7.75,1);
	\draw (7.75,0) -- (8.75,0) node[bullet] (e) {};
\end{tikzpicture}
\]
The links of a proof net are added to the sequent as coloured arrows.
%
The following example is a proof net for the above sequent.
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\node[circ] (1) at (6,0) {};
	\draw (0,0) node[bullet] (a) {} -- (1,0) node[bullet] (b) {} (3,0) node[bullet] (c) {} -- (4,0) node[bullet] (d) {};
	\node[circ] (2) at (1,3) {}; \node[circ] (3) at (2,3) {}; \node[circ] (4) at (3,3) {};
	\draw[rounded corners] (0,2) rectangle (4,4);
	\draw (4,3) -- (5,3) node[bullet] (e) {};
	\begin{scope}[thepink,->]
			\draw[bend right=10] (a) to (2.center);
			\draw[bend right=10] (b) to (3.center);
			\draw[bend left=10]  (c) to (3.center);
			\draw[bend left=10]  (d) to (4.center);
			\draw[bend right=10] (e) to (1.center);
	\end{scope}
\end{tikzpicture}
\]


We will denote by $A^n$ the sequent consisting of $n$ occurrences of a formula $A$.
%
Given a sequent $\Gamma=A_1,\dotsc,A_n$ we will write $\bigtn\Gamma$ for $A_1\!\tn\cdots\tn A_n$, and $\bigparr\Gamma$ for $A_1\!\parr\cdots\parr\! A_n$.
%
In diagrammatic notation, a big disc will represent an $n$-ary tensor over only $\bot$-formulae, $\bigtn(\bot^n)$, and a big circle will represent an $n$-ary par (or a sequent) over only $1$-formulae, $\bigparr(\1^n)$.
%
A linking between $\bigtn(\bot^n)$ and $\bigparr(\1^n)$ will be represented by a wide arrow, as illustrated below.
\[
\begin{tikzpicture}[x=-5mm,y=5mm,octo]
	\node[big_] (A) at (-1,2) {};
	\node[big1] (!) at (-1,0) {};
	\node at (.5,1) {$\Rightarrow$};
	\draw (2,2) node[bullet] (a) {} -- (3,2) node[bullet] (b) {} -- (4,2) (5,2) -- (6,2) node[bullet] (c) {}; 
	\node[circ] (1) at (2,0) {}; \node[circ] (2) at (3,0) {}; \node[circ] (3) at (6,0) {};
	\draw[dotted] (4,2)--(5,2) (4,0)--(5.1,0);
	\begin{scope}[thepink,->]
			\draw[big>] (A) to (!.center);
			\draw[bend right=10] (a) to (1.center);
			\draw[bend right=10] (b) to (2.center);
			\draw[bend right=10] (c) to (3.center);
	\end{scope}
\end{tikzpicture}
\]
Two formulae $\bigtn(\bot^{i+1})$ and $\bigtn(\bot^{j+1})$ may together connect to a formula $\bigparr(\1^{i+j+1})$, as illustrated below for $i=2$ and $j=3$.
%
Nodes will be labelled $i'$ for $i+1$, so that both the abbreviated formulae and the arithmetic of connecting them remain intuitive.
%
\[
\vc{
  \begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (0,0) node[bullet] (a) {}--
		  (1,0) node[bullet] (b) {}--
		  (2,0) node[bullet] (c) {};
	\draw (4,0) node[bullet] (d) {}--
		  (5,0) node[bullet] (e) {}--
		  (6,0) node[bullet] (f) {}--
		  (7,0) node[bullet] (g) {};
	\foreach \i in {1,...,6} {\node[circ] (\i) at (\i,3) {};}
	\begin{scope}[thepink,->]
			\draw[bend right=10] (a) to (1);
			\draw[bend right=10] (b) to (2);
			\draw[bend right=10] (c) to (3);
			\draw[bend left=10]  (d) to (3);
			\draw[bend left=10]  (e) to (4);
			\draw[bend left=10]  (f) to (5);
			\draw[bend left=10]  (g) to (6);
	\end{scope}
  \end{tikzpicture}
}
\quad\Rightarrow\quad
\vc{
  \begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\node[big_] (A) at (-1,0) {$2'$};
	\node[big_] (B) at ( 1,0) {$3'$};
	\node[big1] (!) at ( 0,3) {$5'$};
	\begin{scope}[thepink,->,big>]
		\draw[bend right=15] (A) to (!);
		\draw[bend left=15]  (B) to (!);
	\end{scope}
  \end{tikzpicture}
}
\]
%
A path in a proof net or switching graph is indicated $\path ab$, and illustrated as below.
%
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[bullet] (a) at (0,0) {}; \node[bullet] (b) at (2,0) {}; \draw[dashed] (a)--(b);
\end{tikzpicture}
\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[circ] (a) at (0,0) {}; \node[circ] (b) at (2,0) {}; \draw[dashed] (a)--(b);
\end{tikzpicture}
\]


%------------------------------------------------------------


\section{Constraint logic}
\label{sec:ncl}

%
\emph{Non-deterministic constraint logic} \cite{Hearn-Demaine-2005,Demaine-Hearn-2008,GamesPuzzlesAndComputation} is a simple graph-rewriting formalism, used here as a convenient tool for \capsabbrev{pspace}-hardness reduction.
%
A \emph{constraint graph} is a graph with weighted edges and an \emph{inflow constraint}---a natural number that may be taken to be always $2$---on each vertex. A \emph{configuration} is an assignment of directions to the edges of the underlying undirected constraint graph. A rewrite step consists of the reversal of a single edge in a configuration, while preserving the condition that the total weight of the incoming edges at each vertex is at least its inflow constraint.



Figure~\ref{fig:NCL example} shows an example rewrite sequence in a part of a constraint graph.
%
The central node has inflow constraint 2, the thick blue edge has weight 2, and the thinner red edges have weight 1.



The specific problem we will use is the \emph{configuration--to--configuration} problem, which asks whether a path of rewrite steps exists between two constraint graphs.
%
A constraint graph may be encoded as a sequent, and a configuration as a proof net.
%
It is useful for us to generalise the notion of configuration a little: we will allow \emph{partial} configurations, where edges may be left undirected---as long as the inflow constraints are satisfied by the directed edges.


\begin{definition} 
A \emph{constraint graph} $G=(V,E,c,v,w)$ consists of: a set $V$ of vertices with \emph{inflow constraint} $c\colon V\to\mathbb N$; and a set $E$ of undirected edges with \emph{weight} $w\colon E\to\mathbb N$, connecting the two vertices $v(e)=\{v_1,v_2\}\subseteq V$.

\smallskip

A \emph{(partial) configuration} for a constraint graph is a (partial) function $\gamma\colon E\to V$ such that
\begin{itemize}
	\item
for every edge $e$, if $\gamma(e)$ is defined then $\gamma(e)\in v(e)$,
	\item
for every vertex $v$, the total weight of its incoming edges is at least its inflow constraint, 
$\sum\{w(e)\mid\gamma(e)=v\}\geq c(v)$.
\end{itemize} 

\smallskip
A \emph{reconfiguration step} $\gamma\perm*\delta$ relates two (partial) configurations for $G$ that differ in value (or definedness) on exactly one edge; this edge is then called \emph{mobile} in $\gamma$ and $\delta$.
%
The reflexive--transitive closure of $(\perm*)$ will be denoted $(\perm)$.
%
\end{definition}


\begin{proposition}
\label{prop:partial simulates total reconfiguration}
For total configurations $\gamma$ and $\delta$, if $\gamma\perm\delta$ then $\gamma$ and $\delta$ are also connected by a sequence of reconfiguration steps over total configurations only.
\end{proposition}


\begin{proof}
By the following two observations: firstly, 
%
if $\gamma\perm*\delta$ for partial configurations, then these may be completed to total configurations $\gamma'\perm*\delta'$ or $\gamma'=\delta'$; and secondly,
%
if $\gamma'$ and $\gamma''$ are total configurations that both agree with a partial configuration $\gamma$ where the latter is defined, then $\gamma'$ and $\gamma''$ are connected by reversing the edges on which they disagree one after another.
%
\end{proof}


\emph{Non-deterministic constraint graph reconfiguration} or \emph{\capsabbrev{ncg}-reconfiguration} is the problem of deciding whether two total configurations of a constraint graph are connected by a sequence of reconfiguration steps.



\begin{figure}
$
~
\vc{\begin{tikzpicture}[x=-3mm,y=3mm]
	\draw[ncl2,->-] (0,0) -- (3,0);
	\draw[ncl1,->-] (3,0) -- (5,2);
	\draw[ncl1,->-] (3,0) -- (5,-2);
	\node[nclnode] at (3,0) {};
\end{tikzpicture}}
\hfill\perm*\,
\vc{\begin{tikzpicture}[x=-3mm,y=3mm]
	\draw[ncl2,->-] (0,0) -- (3,0);
	\draw[ncl1,-<-] (3,0) -- (5,2);
	\draw[ncl1,->-] (3,0) -- (5,-2);
	\node[nclnode] at (3,0) {};
\end{tikzpicture}}
\hfill\perm*\,
\vc{\begin{tikzpicture}[x=-3mm,y=3mm]
	\draw[ncl2,->-] (0,0) -- (3,0);
	\draw[ncl1,-<-] (3,0) -- (5,2);
	\draw[ncl1,-<-] (3,0) -- (5,-2);
	\node[nclnode] at (3,0) {};
\end{tikzpicture}}
\hfill\perm*\,
\vc{\begin{tikzpicture}[x=-3mm,y=3mm]
	\draw[ncl2,-<-] (0,0) -- (3,0);
	\draw[ncl1,-<-] (3,0) -- (5,2);
	\draw[ncl1,-<-] (3,0) -- (5,-2);
	\node[nclnode] at (3,0) {};
\end{tikzpicture}}
~
$

\smallskip
\caption{A series of reconfiguration steps in a constraint graph}
\label{fig:NCL example}
\end{figure}

\begin{theorem}[\cite{GamesPuzzlesAndComputation}, Theorem~5.15]
\capsabbrev{ncg}-reconfiguration is \capsabbrev{pspace}-complete.
\end{theorem}


\section{Encoding constraint logic}
\label{sec:encoding}
\noindent
%
We will demonstrate the \capsabbrev{pspace}-hardness of \capsabbrev{mll} proof equivalence by an encoding of \capsabbrev{ncg}-reconfiguration in \capsabbrev{mll} proof nets.


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


\begin{figure*}
\[
\vc{\scalebox{0.36}{\BIGexample 3}}
\quad\perm\quad
\vc{\scalebox{0.36}{\BIGexample 2}}
\quad\perm\quad
\vc{\scalebox{0.36}{\BIGexample 1}}
\]
\caption{Rewiring three edge-gadgets connected to a single vertex-gadget}
\label{fig:encoding example}
\end{figure*}


\subsection*{The encoding}


The basis of the encoding of constraint graphs in \capsabbrev{mll} is formed by \emph{weight elements}, which encode one unit of weight on an edge, and \emph{constraint elements}, that encode one unit towards the inflow constraint of a vertex.
%
The arithmetic of linking formulae of the form $\bigtn(\bot^n)$ to formulae $\bigparr(1^m)$ will be used to ensure that a weight element may be linked to only two vertices.
%
Below left is a weight element, below right a constraint element.
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big_] (A) at (0,0) {$i'$}; 
	\node[big_] (B) at (2,0) {$j'$};
	\node[big_] (C) at (4,0) {$k'$};
	\draw[rounded corners] (-1,-1) rectangle (5,1);
\end{tikzpicture}
\qquad\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big1] (1) at (0,0) {$m'$}; 
	\node[big1] (2) at (3,0) {$n'$};
	\draw[rounded corners] (-1,-1) rectangle (1,1) (2,-1) rectangle (4,1);
	\draw (1,0)--(2,0);
\end{tikzpicture}
\]
For all edges and vertices in the encoding of a constraint graph, the sum $i+j+k=m+n$ will be the same -- this way, a priori any weight element may connect to any constraint element.
%
The value of $m$ (and thus $n$) will differ for each vertex.
%
The weight element above will be able to connect naturally to those constraint elements where $m=i$ and where $m=i+j$, as illustrated below.
\[
	\connectingElements 1 \qquad \connectingElements 2
\]
To ensure that no other connections can be made, values are chosen such that $m\equiv1$ and $n\equiv2 \pmod 3$, and accordingly $i\equiv1$, $j\equiv0$, and $k\equiv2\pmod 3$.


In a constraint graph, the sum of all weights is usually greater than the sum of all inflow constraints---otherwise, no edge can move, or no configuration exists.
%
An encoding will therefore have weight elements not connected to constraint elements.
%
These will instead connect to additional, separate $\1$-formulae, referred to as \emph{weight absorbers}, as follows.
%
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big_] (A) at (0,0) {}; 
	\node[big_] (B) at (2,0) {};
	\node[big_] (C) at (4,0) {};
	\draw[rounded corners] (-1,-1) rectangle (5,1);
	\node[big1] (1) at (7.5,0) {};
	\begin{scope}[thepink,->,big>]
		\draw[bend left=30] (A) to (1);
		\draw[bend right=30] (B) to (1);
		\draw (C) to (1);
	\end{scope}
\end{tikzpicture}
\]
%
An edge will be encoded by an \emph{edge-gadget}, illustrated below left, constructed by stringing together a number of similar weight elements plus a single \emph{indicator} vertex.
%
Illustrated below right is a \emph{vertex-gadget} encoding a vertex, formed by a number of constraint elements plus a single \emph{indicator target}.
%
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big_] (A) at (0,0) {$i'$}; 
	\node[big_] (B) at (2,0) {$j'$};
	\node[big_] (C) at (4,0) {$k'$};
	\draw[rounded corners] (-1,-1) rectangle (5,1);
	\node[big_] (D) at (0,4) {$i'$}; 
	\node[big_] (E) at (2,4) {$j'$};
	\node[big_] (F) at (4,4) {$k'$};
	\draw[rounded corners] (-1,3) rectangle (5,5);
	\draw (2,1)--(2,1.5) (2,2.5)--(2,3);
	\draw[dotted] (2,1.5)--(2,2.5);
	\draw (2,-1)--(2,-2) node[bullet] {};
	\path (0,-2.5)--(1,-2.5);
\end{tikzpicture}
\qquad\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big1] (1) at (0,0) {$m'$}; 
	\node[big1] (2) at (3,0) {$n'$};
	\draw[rounded corners] (-1,-1) rectangle (1,1) (2,-1) rectangle (4,1);
	\draw (1,0)--(2,0);
	\node[big1] (3) at (0,4) {$m'$};
	\node[big1] (4) at (3,4) {$n'$};
	\draw[rounded corners] (-1,3) rectangle (1,5) (2,3) rectangle (4,5);
	\draw (1,4)--(2,4);
	\draw[dotted] (1.5,1.5)--(1.5,2.6);
	\node[circ] at (1.5,-2) {};
	\draw[rounded corners] (-1.5,-2.5) rectangle (4.5,5.5);
\end{tikzpicture}
\]
%
It would be natural to encode an edge of weight $n$ by an edge-gadget with $n$ weight elements.
%
However, there is a minor issue that prevents this straightforward approach.
%
Although one weight element cannot `fill' an inappropriate constraint element, two weight elements can, in the way illustrated below.
%
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\node[big_] (A) at (-1,0) {}; 
	\draw (.75,0) node[big_] (B1) {} -- (2.25,0) node[big_] (B2) {};
	\node[big_] (C) at (4,0) {};
	\draw[rounded corners] (-2,-1) rectangle (5,1);
	\draw (7,0) node[big_] (D1) {} -- (8.5,0) node[big_] (D2) {}; 
	\node[big_] (E) at (10.25,0) {};
	\node[big_] (F) at (12,0) {};
	\draw[rounded corners] (6,-1) rectangle (13,1);
	\node[big1] (1) at (1,4) {};
	\node[big1] (2) at (4,4) {}; 
	\node[big1] (3) at (7,4) {};
	\node[big1] (4) at (10,4) {};
	\draw[rounded corners] (3,3) rectangle (5,5) (6,3) rectangle (8,5);
	\draw (5,4)--(6,4);
	\begin{scope}[thepink,->,big>]
		\draw[bend right=25] (A)  to (1);
		\draw[bend right=15] (B1) to (1);
		\draw[bend right=25] (B2) to (2);
		\draw[bend right=15] (C)  to (2);
		\draw[bend left=15] (D1) to (3);
		\draw[bend right=15] (D2) to (4);
		\draw[bend left=20] (E)  to (4);
		\draw[bend left=20] (F)  to (4);
	\end{scope}
\end{tikzpicture}
\]
%
In such an inappropriate linking, since both halves of the constraint element are connected, the weight elements must be disconnected---otherwise, the linking would violate the switching condition.
%
That means the weight elements must belong to different edges.


As the linkings above illustrate, it may occur that one subformula of a weight element $A\parr B\parr C$ fills one half of a constraint element.
%
Consequently, a weight element can fill three halves, but only of different constraint elements.
%
The other three halves may be filled by weight elements of a different edge---so to fill 3 constraint elements requires 2 inappropriate edges.
%
To fill the next three constraint elements, at most 1 previous inappropriate edge may be used, and one additional one is needed.
%
To fill $3n$ constraint elements inappropriately therefore requires $n+1$ edges.
%
It thus suffices to multiply the number of constraint elements by three times the number of edges, and encode a vertex with inflow constraint $c$ by a vertex-gadget with $c\times3\times|E|$ constraint elements (where $|E|$ denotes the number of edges in the constraint graph).



The complete encoding of a constraint graph $G$ will then be a sequent $\Gamma$ consisting of:
%
\begin{enumerate}
 	\item
all vertex-gadgets, combined in a single formula via tensors, 
	\item
all edge-gadgets as individual formulae, and
	\item
a sufficient number of weight absorbers ($\1$-formulae).
\end{enumerate}
%
A configuration for $G$ will be encoded as a proof net for $\Gamma$, and conversely each proof net for $\Gamma$ may be interpreted as a (partial) configuration for $G$.


Figure~\ref{fig:encoding example} displays an encoding of two edges of weight 1, and one of weight 2, connecting to a central vertex with inflow constraint 2, as in the example reconfiguration sequence in Figure~\ref{fig:NCL example}.
%
The jumps from the three indicator vertices, at the bottom, indicate which vertex an edge is directed at.
%
Indicator jumps can only be rewired between vertices when the edge-gadget is connected only to weight absorbers---in the first net of Figure~\ref{fig:encoding example}, the two leftmost edges are mobile, and in the third, the rightmost edge is mobile.
%
All three nets in Figure~\ref{fig:encoding example} then correspond to the third graph in Figure~\ref{fig:NCL example}, but the first net allows rewiring according to the second and first graph, whereas the third net allows rewiring according to the fourth graph.



The encoding will be made formal in Section~\ref{sec:correctness}; first we will establish some basic results for rewiring on proof nets.



%------------------------------------------------------------



\section{Rewiring proof nets}
\label{sec:rewiring}


%
In this section we will explore the global rewiring behaviour of proof nets.
%
We will look at notions of subnets; we will introduce a notion of relative \emph{parity} between nets, which if odd, guarantees inequivalence; and we will give a simple account of equivalence for the fragment of \capsabbrev{mll} that omits the par.



The notions and results introduced in this section will be used in the main proofs of the paper, in Section~\ref{sec:correctness}, which show that the encoding of \capsabbrev{ncg}-reconfiguration in \capsabbrev{MLL} proof equivalence, as described informally in the previous section, is correct.


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Subnets}


We will discuss (and adapt) some convenient standard notions for \capsabbrev{mll} proofs and proof nets, and relate them to rewiring.
%
Firstly we will look at subnets---see also \cite{Bellin-vandeWiele-1995}.


\begin{definition}
A \emph{sub-sequent} $\Delta\leq\Gamma$ of a sequent $\Gamma$ is a sequent consisting of disjoint subformulae of $\Gamma$, preserving names.
\end{definition}

\begin{definition}
A \emph{subnet} $(\Delta,\links') \leq (\Gamma,\links)$ of a proof net is a net such that $\Delta\leq\Gamma$ and $\links'$ is the restriction of $\links$ to the names in $\Delta$.
\end{definition}



The \emph{ports} of a sub-sequent $\Gamma'$ or subnet $(\Gamma',\links')$ are the root vertices of $\Gamma'$.
%
For a vertex $v$ naming a par, tensor, or bottom, the subnets of which it is a port correspond to the possible subproofs of the rule introducing $v$ in a sequentialisation (the subproof of a $\1$-subformula must always be empty).



In the graph of a proof net, a chosen subnet for a par can be made explicit as a \emph{box}, as illustrated below left.
%
Boxes may replace the switching condition as a correctness criterion: in the example, both the outside and the inside of the box form a tree.
%
To make this precise, we will consider the action of \emph{closing} a box, which means it is regarded as a single vertex in the graph, as illustrated below right.
%
%
%
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (-2.25,0) node[bullet] (x) {} -- (-1.25,0) node[bullet] (y) {}
		  (.25,0) node[bullet] (a) {} -- (1.25,0) node[bullet] (b) {}
		  ( 2.75,0) node[bullet] (c) {} -- (3.75,0) node[bullet] (d) {};
	\node[circ] (0) at (5.75,0) {};
	\node[circ] (1) at (-1,3) {};
	\node[circ] (2) at (1,3) {}; \node[circ] (3) at (2,3) {}; \node[circ] (4) at (3,3) {};
	\draw[rounded corners] (0,2) rectangle (4,4);
	\draw (4,3) -- (5.5,3) node[bullet] (e) {};
	\begin{scope}[thepink,->]
			\draw[bend right=10] (x) to (1);
			\draw[bend right=20] (y) to (2);
			\draw[bend right=10] (a) to (2);
			\draw[bend right=10] (b) to (3);
			\draw[bend left=10]  (c) to (3);
			\draw[bend left=10]  (d) to (4);
			\draw[bend right=10] (e) to (0);
	\end{scope}
	\draw[dashed,rounded corners] (-.25,-.5) rectangle (4.25,4.25);
\end{tikzpicture}
\qquad\qquad
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (-2.25,0) node[bullet] (x) {} -- (-1.25,0) node[bullet] (y) {};
	\node[circ] (0) at (3,0) {};
	\node[circ] (1) at (-1,3) {};
	\node[draw,rounded corners,minimum size=16pt] (box) at (1,3) {};
	\draw (box)--(3,3) node[bullet] (e) {};
	\begin{scope}[thepink,->]
			\draw[bend right=10] (x) to (1);
			\draw[bend right=20] (y) to (box);
			\draw[bend right=10] (e) to (0);
	\end{scope}
	\path (0,4.25)--(1,4.25);
\end{tikzpicture}
\]
%
%
\begin{definition}
A \emph{boxing} $s$ for a linking $\links$ for $\Gamma$ assigns a sub-sequent $s(v)\leq\Gamma$ to each par-vertex $\named v\parr$ such that 1) $v$ is a port of $s(v)$ and 2) boxes are either disjoint or strictly nested: if $s(v)\cap s(w)\neq\varnothing$ then $s(w)<s(v)$ or $s(v)<s(w)$.
\end{definition}

\noindent
In the graph for $\links$ and $\Gamma$, a box $s(v)$ may be \emph{closed} by replacing the subgraph over $s(v)$ by the single vertex $v$, and replacing every arc into $s(v)$ by one onto $v$.
%
For each box $s(v)$ we define the \emph{local graph} to be that formed by the subgraph over $s(v)$ where each immediately smaller box $s(w)<s(v)$ is closed.
%
The following is then a variation on the local retraction algorithm by Danos \cite{Danos-1990}.

\begin{proposition}
\label{prop:scoping correctness}
A linking $\links$ for $\Gamma$ is a proof net if and only if it has a boxing $s$ such that each local graph is a tree.
\end{proposition}

\begin{proof}
Given a boxing $s$, it follows by induction on the nesting of boxes that the graph over each $s(v)$ satisfies the switching condition.
%
In the other direction, given a sequentialisation of $(\Gamma,\links)$, a box $s(v)\leq\Gamma$ for each $\named v\parr$ is found by taking the conclusion $\Delta, A\named v\parr B$ of its introduction rule, below.
\[
	\infer[\MLLlabel p]{\Delta,A\named v\parr B}{\Delta,A,B}
\]
\end{proof}


In a proof net, the \emph{kingdom} and the \emph{empire} of a vertex $v$ are respectively the smallest and largest subnet that have $v$ as a port.
%
In working with the rewiring relation, the notion of empire can be particularly useful.
%
We will denote the empire of $v$ in $\links$ by $\emp v$ (used both as a graph and a set of vertices).



\begin{proposition}[{\cite[Proposition 2.b]{Bellin-vandeWiele-1995}}]
\label{prop:empire propagation}
The empire $\emp v$ is determined by propagation from $v$: 1) through links; 2) up towards subformulae; 3) into a tensor if one of its subformulae is in $\emp v-\{v\}$; 4) into a par if all its subformulae are in $\emp v-\{v\}$.
\end{proposition}


\noindent
The following three lemmata show how empires are connected to rewiring.
%
Firstly, a jump from $\named v\bot$ may be rewired to exactly those $\1$-occurences that are in the empire of $v$ (Lemma~\ref{lem:rewiring within empire}).
%
Secondly, rewiring this jump preserves the empire of $v$, up to that rewiring (Lemma~\ref{lem:rewiring preserves empire}).
%
Thirdly, the empire of any other vertex $w$ will grow or shrink, or neither, but not both (Lemma~\ref{lem:rewiring affects empires}).



\begin{lemma}
\label{lem:rewiring within empire}
For a proof net $(\Gamma,\links)$ where $\links(a)=v$, and $w$ names a $\1$-occurrence in $\Gamma$, the following are equivalent:
%
\begin{enumerate}
	\item
$\links\perm*\links'$ where $\links'(a)=w$;
	\item
$w$ is in the empire $\emp a$; and
	\item
in any switching graph for $(\Gamma,\links)$, the path $\path vw$ does not pass through $a$.
\end{enumerate}
\end{lemma}


\begin{proof}
By \cite[Proposition 2.a]{Bellin-vandeWiele-1995} 2 and 3 are equivalent.

Next, it is shown that 2 implies 1.
%
The empire $\emp a$ corresponds to the largest subproof $\Sigma$ in any $\Pi\toNet\links$ with as conclusion the introduction rule of $\named a\bot$.
%
By Definition~\ref{def:proofs to nets}, in the translation of $\Sigma$ to a net, $a$ may link to any $1$-occurrence, including to $w$.


Finally, it is shown that 1 implies 3, by contraposition.
%
If for some switching of $\links$ the path $\path vw$ passes through $a$, then in $\links'$ there is no path $\path av$ (and two paths $\path aw$) for that switching, so that $\links'$ is not a net.
%
\end{proof}

\begin{lemma}
\label{lem:rewiring preserves empire}
If $\links\perm*\links'$ by $\links(v)\neq\links'(v)$ then $\emp v\perm*\emp*v$.
\end{lemma}

\begin{proof}
Since $v$ may rewire to exactly the same $\1$-occurrences in $\links$ as in $\links'$, by Lemma~\ref{lem:rewiring within empire} the empires $\emp v$ and $\emp*v$ contain the same $\1$-subformulae.
%
That they also share any other subformula $A$ follows by the observation that $A\tn\1$ may replace $A$: by Proposition~\ref{prop:empire propagation} the new $\1$ is in a given empire if and only if $A$ is (unless $v$ names $A$, but in this case $A$ is included in both $\emp v$ and $\emp*v$).
%
\end{proof}


\begin{lemma}
\label{lem:rewiring affects empires}
If $\links\perm*\links'$ where $\emp v$ is a net for the sequent $\Delta$, and $\emp*v$ a net for $\Delta'$, then $\Delta\leq\Delta'$ or $\Delta\geq\Delta'$.
\end{lemma}


\begin{proof}
Let the link from $a$ be rewired, $\links(a)=w$ but $\links'(a)=w'$.
%
Using Proposition~\ref{prop:empire propagation}, there are four cases.
%
\begin{enumerate}
	\item
If the empire of $v$ is propagated from $a$ to $w$ in $\links$, it includes the empire of $a$.
%
Then by Lemma~\ref{lem:rewiring preserves empire} $\Delta=\Delta'$.

	\item
If the empire of $v$ includes $w$ but not $w'$, then it is propagated through $a$ in $\links$ but not in $\links'$, so that $\Delta\geq\Delta'$.

	\item
If the empire of $v$ includes $w'$ but not $w$, then $\Delta\leq\Delta'$.

	\item
Otherwise, $\Delta=\Delta'$. \hfill\qedhere
\end{enumerate}
\end{proof}



% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Parity}



The linearity of \capsabbrev{mll} means that in a proof or proof net, there is always a certain balance to the number of $\bot$- and $\parr$-occurrences. 
%
This observation gives a well-known necessary condition for the provability of a sequent.


\begin{definition}
The \emph{balance} of a sequent is the number of $\bot$s minus the number of $\parr$s and commas.
%
A sequent is \emph{balanced} if its balance is zero.
\end{definition}


\begin{proposition}
\label{prop:unbalanced then uninhabited}
An unbalanced sequent is uninhabited.
\end{proposition}


Here, we will introduce a similar necessary condition for the equivalence of two proof nets.
%
We shall associate a \emph{parity} with any pair of linkings $\links$ and $\links'$ over the same sequent $\Gamma$, and we shall find that the parity of equivalent linkings is always even.


For this argument we will work with $n$-ary connectives $\tn$ and $\parr$, and alternating formulae, i.e.\ every argument of a $\tn$ is a $\parr$ and vice versa.
%
The units are given by the $0$-ary connectives, and we need not rule out unary ones.
%
We will consider a given named sequent $\Gamma$, but will assume that it consists of a single formula, if necessary by introducing a $\parr$ at the root.


To be able to compare arbitrary proof nets over $\Gamma$, we will use the following naming scheme for the edges of a switching graph, for any proof net over $\Gamma$.
%
A tensor $\bigtn(A_1,\dotsc,A_n)$ named $v$ has $n$ edges, which we shall name $v(1)$ through $v(n)$; a par $\named v\pr$ has one switched edge, to be named $v(1)$; and $\named v\bot$ has the jump named $v(1)$.
%
The naming scheme identifies edges across all switching graphs of all proof nets for $\Gamma$.


Taking a different perspective, we may consider a switching graph as a directed tree, rooted in the root connective of $\Gamma$.
%
This establishes a bijection between the edges and the non-root vertices, which associates each edge with its target vertex.



The example in Figure~\ref{fig:directed switching graph} displays a proof net on the left, and on the right the switching graph choosing the edge $\edge ij$ for the par $i$, and the edge $\edge rg$ for the root par $r$.
%
The induced bijection associates for example the edge named $r(1)$ with the vertex $g$, the edge $g(1)$ with $h$, and the edge $h(1)$ with $a$; it further associates $f(1)$ with $f$ and $c(3)$ with $c$.


Given two proof nets $\links$ and $\links'$ for $\Gamma$, and a switching graph for each (not necessarily given by the same switching of $\Gamma$), we obtain two bijections between edges and (non-root) vertices.
%
Composing these gives a permutation on the non-root vertices.
%
\begin{definition}
The \emph{parity} of two switching graphs for proof nets $\links$ and $\links'$ for a sequent $\Gamma$ is the parity of their induced permutation.
\end{definition}
%
We will show that both 1) rewiring and 2) choosing a different switching induce even parity.
%
By 2) we may define the parity of two proof nets $\links$ and $\links'$ to be that over arbitrary switching graphs; then by 1) it follows that proof nets with odd parity are inequivalent.


We will demonstrate 1), while 2) is similar.
%
Let $\links\perm*\links'$ by rewiring a jump from $\edge va$ to $\edge vb$.
%
By fixing a switching for $\Gamma$, we obtain a switching graph for each of the two nets, where the jump is named $v(1)$ in each.
%
There are two possibilities, illustrated in Figure~\ref{fig:rewiring directed switching graph}.
%
On the left, if the jump $v(1)$ is directed upward, then the target of each edge in the directed switching graphs remains the same---in particular $v(1)$ has target $v$---and the induced permutation is the identity.


On the right, in Figure~\ref{fig:rewiring directed switching graph}, if the jump from $v$ is directed downward, the subtree of $a$ will get the new root node $b$.
%
Then the vertices that are associated with a new edge are exactly those on the path $\path ab$ in the switching graph, as illustrated below.
%
\[
	\parityNetE
\]
%
Since the connectives in $\Gamma$ were assumed to be strictly alternating, there are an odd number of vertices on this path, $2n+3$: each even $v_i$ must be a $\bot$ or $\pr$, while each odd $v_j$ must be a $\1$ or $\tn$.
%
The permutation induced is then as follows.
%
Since $v$ has target $a$ in the first switching graph, and target $b$ in the second, it takes $a$ to $b$.
%
Further, since an edge connecting $v_i$ and $v_{i+1}$ has target $v_{i+1}$ in the first, but target $v_i$ in the second graph, the permutation takes $v_{i+1}$ to $v_i$.
%
The complete permutation is then a cyclic one taking each vertex on the path $\path ab$ to the previous, and the first to the last.
%
A cyclic permutation of odd length has even parity.


The above argument gives us 1), that rewiring has even parity.
%
To see that the same argument also gives 2), it is sufficient to consider that choosing a different switching for a single par is essentially the same operation as rewiring, if the par is considered a $\bot$ and the switched edge a jump.
%
We may thus conclude that:


\begin{proposition}
Two equivalent proof nets have even parity.
\end{proposition}


\begin{figure}
\[
	\vc{\parityNetA} \qquad \vc{\parityNetB}
\]
\caption{A switching graph of a proof net as a directed tree}
\label{fig:directed switching graph}
\end{figure}



\begin{figure}
\[
	\vc{\parityNetC1} \perm \vc{\parityNetC2}
\quad \vc{\rule{.5pt}{4cm}} \quad
	\vc{\parityNetD1} \perm \vc{\parityNetD2} \kern5pt{=}\kern-5pt \vc{\parityNetD3}
\]
\caption{Rewiring on the directed tree of a switching graph}
\label{fig:rewiring directed switching graph}
\end{figure}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


\begin{figure*}
\[
	\vc{\doubleExchange uvxy}
	\quad\perm*\quad
	\vc{\doubleExchange uyxy}
	\quad\perm*\quad
	\vc{\doubleExchange uyxu}
	\quad\perm*\quad
	\vc{\doubleExchange vyxu}
	\quad\perm*\quad
	\vc{\doubleExchange vyyu}
	\quad\perm*\quad
	\vc{\doubleExchange vuyu}
	\quad\perm*\quad
	\vc{\doubleExchange vuyx}
\]
\caption{Double exchange of links (Lemma~\ref{lem:double exchange})}
\label{fig:double exchange}
\end{figure*}


\subsection*{Equivalence without $\parr$}


Let a \emph{basic} sequent be one of formulae constructed only over $\1$, $\bot$, and $\tn$.
%
After removing dangling $\bot$-formulae and replacing subformulae $\1\tn A$ with $A$, basic sequents consist of formulae of the form $1$ or $\bigtn(\bot^n)$ with $n\geq2$.


Provability for basic sequents is entirely determined by balance:


\begin{proposition}
A balanced basic sequent is inhabited.
\end{proposition}


We will show that, similarly, equivalence for basic sequents is determined by parity.
%
An immediate observation is that a proof net for a basic sequent with only one tensor-formula, every $\1$ is linked to by exactly one jump---which means that no rewiring is possible.


\begin{proposition}
A basic sequent $\1^n,\bigtn(\bot^n)$ is inhabited by exactly $n!$ inequivalent proof nets.
\end{proposition}


In the following we will characterise equivalence for basic sequents with two or more tensor-formulae.


\begin{lemma}
\label{lem:double exchange}
Let $\links$ be a proof net with for every switching a path
$\links(a){\xedge}a{\xpath}b{\xedge}\links(b){\xpath}\links(c){\xedge}c{\xpath}d{\xedge}\links(d)$.
%
Then $\links\perm\links'$ where $\links'(a)=\links(b)$ and $\links'(b)=\links(a)$, $\links'(c)=\links(d)$, and $\links'(d)=\links(c)$, and $\links'(z)=\links(z)$ otherwise.
%
\end{lemma}

\begin{proof}
By the rewiring path shown in Figure~\ref{fig:double exchange}.
\end{proof}



\begin{lemma}
\label{lem:level0 max binary}
%
A basic sequent with at least two tensor-formulae has at most two equivalence classes of proof nets.
%
\end{lemma}


\begin{proof}
By induction on the size of a sequent $\Gamma$.
%
The base case is the sequent $\1,\1,\bot\tn\bot$, which has two inequivalent proof nets.
%
For the inductive step,
%
let $\Gamma=\Gamma',A\tn\named a\bot,\named z\1$ where $A\tn\named a\bot$ is a largest $\tn$-formula in $\Gamma$.
%
It will be shown that any net $\links$ is equivalent to one $\links'$ where $\links'(a)=z$; then by induction, the subnet $\links'$ restricted to $\Gamma',A$ belongs to one of two equivalence classes.
%
To find $\links'$, there are two cases.

1) The path $\path az$ is via $\links(a)$.
%
If $\links(a)=z$, we are done. Otherwise, by Lemma~\ref{lem:rewiring within empire} $\links'$ may be obtained from $\links$ by changing only $\links'(a)=z$.


2) The path $\path az$ is via some $\named b\bot$ in $A$.
%
Firstly, if $\links(b)\neq z$, use Lemma~\ref{lem:rewiring within empire} to re-attach $b$ to $z$.
%
Next, let $\named c\bot$ and $\named d\bot$ be occurrences in a separate formula $B$ such that $c$ links to the same $\1$-occurrence as some $\bot$ in $A$.
%
Then $\links'$ is obtained by linking $c$ to $b$, and applying Lemma~\ref{lem:double exchange} to exchange the targets of $a$ and $b$, as well as those of $c$ and $d$.
%
\end{proof}




\begin{proposition}
\label{prop:parity determines equivalence}
For a basic sequent with at least two tensor-formulae, two proof nets with even parity are equivalent.
\end{proposition}

\begin{proof}
By Lemma~\ref{lem:level0 max binary} the sequent has at most 2 equivalence classes.
%
Given two proof nets of even parity, both must be in the other equivalence class than a proof net with odd relative parity to both, which exists by exchanging two jumps from one tensor-formula.
\end{proof}


%------------------------------------------------------------



\section{Formalising the encoding}
\label{sec:correctness}


%
We will formalise the encoding of \capsabbrev{ncg}-reconfiguration into \capsabbrev{mll} proof equivalence that was informally introduced in Section~\ref{sec:encoding}.
%
A constraint graph $G$ will be encoded as a sequent $\itn G$, and a configuration $\gamma$ for $G$ will be encoded as a proof net $\itn\gamma$ for $\itn G$.
%
We will show that $\gamma\perm\delta$ if and only if $\itn\gamma\perm\itn\delta$ (modulo a small adjustment to ensure even parity between $\itn\gamma$ and $\itn\delta$).


For a constraint graph $G=(V,E,c,v,w)$, let $|V|$ and $|E|$ denote the number of vertices and edges, and let $|c|$ and $|w|$ denote the sum of all inflow constraints and the sum of all weights, respectively:
\[
	|c| = \sum_{v\in V}c(v) \qquad |w| = \sum_{e\in E}w(e)~.
\]


\begin{definition}
\label{def:graph encoding}
The \emph{encoding} $\itn G$ of a constraint graph $G$ is a sequent constructed as follows.
%
Let $G=(V,E,c,v,w)$ with $|V|=n$, $|E|=m$, $V=\{v_1,\dotsc,v_n\}$, and $E=\{e_1,\dotsc,e_m\}$.

\noindent
The encoding of a vertex $v_k$ is the formula
\[
	\itn{v_k} = \bigparr\big(C_n(k)^{3m\times c(v_k)} \big)\parr\1
\]
where each \emph{constraint element} $C_n(k)$ is the formula
\[
	C_n(k) = \bigparr\big(1^{3k+2}\big) \tn \bigparr\big(1^{3(n-k)+3}\big)~.
\]

\noindent
The encoding of an edge $e$ connecting vertices $v_i$ and $v_j$ with $i<j$ is the formula
\[
	\itn{e} = \bigtn\big(W_n(i,j)^{3m\times w(e)}\big)\tn\bot
\]
where each \emph{weight element} $W_n(i,j)$ is the formula
\[
	W_n(i,j) = \bigtn\big(\bot\!^{3i+2}\big)\parr\bigtn\big(\bot\!^{3(j-i)+1}\big)\parr\bigtn\big(\bot\!^{3(n-j)+3}\big)\,.
\]

\noindent
The encoding of the graph $G$ is the sequent
\[
	\itn G = \itn{v_1}\tn\dotso\tn\itn{v_n}, \itn{e_1},\dotsc,\itn{e_m}, 1^p
\]
where $p=3m\times(|w|-|c|)\times(3n+4)$.

\end{definition}



In the above definition, the final $\1$-subformula of a vertex-gadget $\itn{v_k}$ is its \emph{indicator target}; the final $\bot$-subformula of an edge-gadget $\itn{e}$ is its \emph{indicator}; and in the completed encoding $\itn G$ the $p$ instances of $\1$ are the \emph{weight absorbers}.
%
In a constraint graph $G$, a vertex $v$ and an edge $e$ will be called \emph{appropriate} (for each other) if $v\in v(e)$, and \emph{inappropriate} otherwise.
%
This notion is extended to vertex-gadgets $\itn v$ and edge-gadgets $\itn e$ in $\itn G$, and their respective constraint elements and weight elements.



A configuration $\gamma$ for a constraint graph $G$ will be encoded as a proof net for the sequent $\itn G$.
%
Firstly we will define a standard way of linking a weight element to a constraint element.

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
\begin{definition}
\label{def:standard linkings}
For $W=W_n(i,j)=A\parr B\parr C$ a weight element,
\begin{enumerate}
	\item
for a constraint element $C=C_n(i)=X\tn Y$, the \emph{standard linking} for the sequent $W,C$ links the first $\bot$ in $A$ to the first $\1$ in $X$, the first $\bot$ in $B$ and $C$ each to the first $\1$ in $Y$, and each remaining $\bot$ in $A,B,C$ to a remaining $\1$ in $X,Y$ in their order of occurrence;
	\item
for $C=C_n(j)=X\tn Y$, the \emph{standard linking} for $W,C$ is defined as above, except the first $\bot$ in $B$ links to the first $\1$ in $X$;
	\item
the \emph{standard linking} for the sequent $W,\1^{3n+4}$ links the first $\bot$ in $A$, $B$, and $C$ to the first $\1$, and each remaining $\bot$ to a remaining $\1$ in order of occurrence.
\end{enumerate}
\end{definition}

The standard linkings defined in the second and third case of the above definition are illustrated below.

\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[circ] (1) at (-.25,0) {};
	\node[big1] (2) at (1,0) {};
	\node[big1] (3) at (2.5,0) {};
	\node[big1] (4) at (5.5,0) {};
	\draw[rounded corners] (-1,-1) rectangle (3.5,1) (4.5,-1) rectangle (6.5,1);
	\draw (3.5,0)--(4.5,0);
	%
	\draw (-.25,4) node[bullet] (a) {} -- (.75,4) node[big_] (A) {};
	\draw (2.25,4) node[bullet] (b) {} -- (3.25,4) node[big_] (B) {};
	\node[big_] (C) at (5.5,4) {};
	\draw[rounded corners] (-1,3) rectangle (6.5,5);
	%
	\begin{scope}[thepink,->]
		\draw[bend right=5] (a) to (1);
		\draw[bend right=10] (b) to (1);
		\draw[big>,bend left=25] (A) to (2);
		\draw[big>,bend left=20] (B) to (3);
		\draw[big>,bend left=15] (C) to (4);
	\end{scope}
\end{tikzpicture}
\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[circ] (1) at (.75,0) {};
	\node[big1] (2) at (2,0) {};
	\node[big1] (3) at (3.5,0) {};
	\node[big1] (4) at (5,0) {};
	%
	\draw ( 0  ,4) node[bullet] (a) {} -- ( 1  ,4) node[big_] (A) {};
	\draw ( 2.5,4) node[bullet] (b) {} -- ( 3.5,4) node[big_] (B) {};
	\draw ( 5  ,4) node[bullet] (c) {} -- ( 6  ,4) node[big_] (C) {};
	\draw[rounded corners] (-.5,3) rectangle (7,5);
	\path (0,-1) -- (1,-1);
	%
	\begin{scope}[thepink,->]
		\draw[bend right=5] (a) to (1);
		\draw[bend right=10] (b) to (1);
		\draw[bend right=15] (c) to (1);
		\draw[big>,bend left=25] (A) to (2);
		\draw[big>,bend left=20] (B) to (3);
		\draw[big>,bend left=15] (C) to (4);
	\end{scope}
\end{tikzpicture}
\]

\begin{proposition}
\label{prop:element linkings}
Standard linkings are proof nets.
\end{proposition}


The encoding of a configuration is then as follows.



\begin{definition}
\label{def:configuration encoding}
The \emph{encoding} $\itn\gamma$ of a total configuration $\gamma$ for a constraint graph $G$ is a linking $\links$ for $\itn G$, constructed incrementally for each successive edge $e$ and for each successive weight element $W$ within $e$, as follows.
%
Let $\gamma(e)=v$; firstly, the indicator of $\itn e$ is linked to the indicator target of $\itn v$.
%
Then successively for each weight element $W$ in $e$, if $\itn v$ has a first free constraint element $C$, extend $\itn\gamma$ to include the standard linking on $W,C$; otherwise, extend $\itn\gamma$ by the standard linking on the sequent consisting of $W$ plus the first $3n+4$ free weight absorbers.
\end{definition}



\begin{proposition}
If $\gamma$ is a total configuration for $G$ then $\itn\gamma$ is a proof net for $\itn G$.
\end{proposition}

\begin{proof}
Using Proposition~\ref{prop:scoping correctness}, it is sufficient to give a suitable box for each $\parr$. 
%
The box of each weight element $W$ is the sequent $W,C$ or $W,1^{3n+4}$ of its standard linking, which forms a proof net by Proposition~\ref{prop:element linkings}.
%
The box of each vertex-gadget $\itn v$ contains the edge-gadgets $\itn e$ such that $\gamma(e)=v$, plus all the weight absorbers within boxes of weight elements inside $\itn e$.
%
Since the weights of the connected edges $e$ sum to more than the inflow constraint of $v$, there are no unused constraint elements remaining in $\itn v$.
%
After closing the box of each $W$, each edge-gadget in the box of $\itn v$ becomes a single string of connected vertices, connected to other edge-gadgets only via the indicator target of $\itn v$, thus forming a tree.
\end{proof}





Finally, if two connected configurations $\gamma\perm\delta$ are encoded individually as $\itn\gamma$ and $\itn\delta$, these may not be equivalent simply because their parity happens to be odd.
%
For that reason we shall adjust the encoding of the second to guarantee an even parity.


\begin{definition}
%
Let $\itn\delta'$ be $\itn\delta$ with the first two weight absorbers exchanged.
%
For configurations $\gamma$ and $\delta$ for $G$, let $\itn\delta_\gamma$ be $\itn\delta$ if it has even parity with $\itn\gamma$, and $\itn\delta'$ otherwise.
%
\end{definition}


In the remainder, we will show that our encoding is correct, i.e.\ that $\gamma\perm\delta$ if and only if $\itn\gamma\perm\itn\delta_\gamma$.
%
This will be separated into two parts: completeness ($\Rightarrow$) and soundness ($\Leftarrow$) .





% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Completeness}



Given a reconfiguration path $\gamma\perm\delta$ over total configurations, we will demonstrate a rewiring sequence between $\itn\gamma$ and $\itn\delta_\gamma$.
%
The central part of the argument will be to show how the weight element linking to a constraint element may be exchanged for another (Lemma~\ref{lem:octopus roll}).
%
Before and after the exchange, the constraint element and the weight element connecting to it will be in a standard linking.
%
The linking between weight elements and weight absorbers need not be standard: it will be shown that weight absorbers may be freely rearranged, as long as parity remains even (Lemma~\ref{lem:permute weight absorbers}).



For a reconfiguration step $\gamma\perm*\delta$ where the edge $e$ changes direction from $v$ to $w$, the rewiring sequence $\itn\gamma\perm\itn\delta_\gamma$ will be as follows.
%
First, the weight elements of edge-gadgets connecting to $\itn v$ are rearranged to match their target configuration, in $\itn\delta_\gamma$, which means the weight elements of $\itn e$ connect only to weight absorbers.
%
Then $\itn e$ is moved from $\itn v$ to $\itn w$ by rewiring its indicator link, from the indicator of $\itn v$ to that of $\itn w$.
%
Next, the weight elements connecting to $\itn w$ are rewired to match $\itn\delta_\gamma$, and finally, weight absorbers are rearranged to match $\itn\delta_\gamma$ as well.



To describe the intermediate stages of such a rewiring sequence, call an edge-gadget $\itn e$ \emph{well linked} if: 1) its indicator connects to the indicator target of an appropriate vertex-gadget $\itn v$, and 2) each weight element is either in a standard linking with a constraint element of $\itn v$, or linked only to weight absorbers (in arbitrary fashion).
%
A well-linked edge-gadget is \emph{mobile} if all its weight elements connect only to weight absorbers.
%
In the following main lemma we will exchange the weight element linking to a constraint element.
%
The lemma considers a sequent consisting of just a vertex-gadget, some appropriate edge-gadgets, and sufficiently many weight absorbers.


\begin{lemma}
\label{lem:octopus roll}
In a proof net $\links$ for $\Gamma=\itn v,\itn{e_1},\dotsc,\itn{e_m},1^p$ where each edge-gadget is well linked, if a weight element $W_i$ in $\itn{e_i}$ is linked to $V$ in $\itn v$ and $W_j$ in $\itn{e_j}$ is linked to weight absorbers $1^n$, then there is a net $\links'\perm\links$ in which $W_j$ is well linked to $V$, $W_i$ is linked to $1^n$, and $\links'$ agrees with $\links$ otherwise.
\end{lemma}


\renewcommand\scalefactor{0.80}

\newcommand\displayOcto[1]{%
   \medskip%
   \centerline{%
	 \scale{#1}%
  }%
  \medskip%
}


\begin{proof}
Let $W_i=A\parr B\parr C$, $W_j=D\parr E\parr F$, and $V=X\tn Y$.
%
The rewiring path will be illustrated for the case where $A,B,X$ and $D,X$, and thus also $C,Y$ and $E,F,Y$, are balanced sequents; other cases are similar.


\pagebreak
\noindent
1.\quad The initial configuration is illustrated below.
%
Other edges, other weight and constraint elements, and the outer box of the vertex-gadget, are omitted.
%
The vertices $i$, $j$, and  $v$ are the indicators of $\itn{e_i}$ and $\itn{e_j}$ and the indicator target of $\itn v$, respectively.

\displayOcto{\octorollA1}


\noindent
2.\quad The link $i-v$ is re-connected to a weight absorber together with only the links from the first $\bot$ of each of $D$, $E$, and $F$:

\displayOcto{\octorollB2}


\noindent
3.\quad The link from the first $\bot$ of $D$ is moved to $X$, and those from the first $\bot$ of $E$ and $F$ are moved to $Y$:


\displayOcto{\octorollB3}


\noindent
4.\quad In the present configuration, the links from the weight elements form two subnets: one over the sub-sequent $A,B,X,D,1^m$, and one over the sub-sequent $C,Y,E,F,1^k$, for some $m$ and $k$.
%
By Proposition~\ref{prop:parity determines equivalence}, these subnets are equivalent to any other over the same sequent, as long as their parity is preserved.
%
It is then sufficient to choose linkings so that $D\parr E\parr F$ is in a a standard linking with $X\tn Y$, with a minor adjustment: two links from $D$ to $X$ should remain exchanged, compared to the standard linking, for step 6 below.
%
The links of $A,B,C$ link to the weight absorbers $1^m$ and $1^k$, with one remaining link from $B$ to $X$ and one from $C$ to $Y$.


\displayOcto{\octorollC}

\newpage
\noindent
5.\quad The link from $C$ to $Y$ is moved towards a weight absorber connected to $A,B$.


\displayOcto{\octorollD1}


\noindent
6.\quad The link from $B$ to $X$ is the one remaining connection between the edge-gadgets $\itn{e_i}$ and $\itn{e_j}$.
%
Lemma~\ref{lem:double exchange} allows to swap the targets of the link from $B$ to $X$ and the link from $i$, and simultaneously undo the exchange in the links from $D$ to $X$ added in step 4 above.


\displayOcto{\octorollD2}


\noindent
7.\quad The link from $i$ is re-attached to $v$ to yield the final configuration:

\displayOcto{\octorollA2}
%
\end{proof}



In the exchange of weight elements in the above lemma, weight elements link to weight absorbers in arbitrary fashion.
%
To be able to correct for this, the next lemma will demonstrate that, modulo parity, weight absorbers can be re-arranged at will.




\begin{lemma}
\label{lem:permute weight absorbers}
If $\links$ and $\links'$ are well-linked proof nets for $\itn G$ that are equal up to an even permutation of weight absorbers, then $\links\perm\links'$ if $\links$ and $\links'$ have at least one mobile edge-gadget $\itn e$.
\end{lemma}

\begin{proof}
To reconfigure $\links'$ into $\links$, we will use the double exchange operation of Lemma~\ref{lem:double exchange} to exchange two arbitrary weight absorbers at a time, as well as two chosen jumps in the mobile edge-gadget $\itn e$.
%
Firstly, let $e_0$ be the indicator of $\itn e$.
%
Note that since $\itn e$ is mobile, $e_0$ may re-attach anywhere within the proof net.


We will need two basic operations: 1) to exchange two arbitrary weight absorbers $v$ and $w$ linked from outside $\itn e$; and 2) to exchange an arbitrary weight absorber linked from inside $\itn e$ with one linked from outside $\itn e$.
%
Since we are using double exchanges, each operation will also exchange two arbitrary jumps from $\itn e$ (but not that from $e_0$).
%
By using operation 1) twice, we obtain a third, where four arbitrary weight absorbers linked from inside $\itn e$ are pairwise exchanged.
%
Since $\links'$ and $\links$ differ by an even permutation of weight absorbers, these three operations together give $\links'\sim\links$.


To perform operation 1), exchanging $v$ and $w$ as well as the jumps from $e_1$ and $e_2$ in $\itn e$, first connect $e_0$ to $v$.
%
Then apply Lemma~\ref{lem:double exchange} three times: exchanging $v$ and $w$, and the targets of $e_0$ and $e_1$; exchanging $w$ and $v$, and the targets of $e_1$ and $e_2$; and exchanging $v$ and $w$, and the targets of $e_2$ and $e_0$.
%
The result is a net exchange of $v$ and $w$, and the targets of $e_1$ and $e_2$.


Operation 2) is performed similarly.
%
In both cases, if one of the weight absorbers exchanged is linked to by multiple $\bot$-occurrences within the same weight element, these may be temporarily attached elsewhere.
%
\end{proof}




\begin{lemma}
\label{lem:completeness}
If $\gamma\perm\delta$ for total configurations $\gamma$ and $\delta$, then $\itn\gamma\perm\itn\delta_\gamma$.
\end{lemma}

\begin{proof}
By Proposition~\ref{prop:partial simulates total reconfiguration} we may assume that $\gamma\perm\delta$ by a sequence of reconfiguration steps over total configurations.
%
We will prove that if $\gamma\perm*\delta$ then $\itn\gamma\perm\itn\delta$ or $\itn\gamma\perm\itn\delta'$.
%
The same proof will show the corresponding case for $\itn\gamma'$ instead of $\itn\gamma$, so that the general case for $\gamma\perm\delta$ follows by transitivity.



Let $\gamma$ and $\delta$ agree on every edge except $e$, where $\gamma(e)=v$ and $\delta(e)=w$.
%
Firstly, using Lemma~\ref{lem:octopus roll}, for the edges $d$ other than $e$ such that $\gamma(d)=v$, the weight elements of the edge-gadgets $\itn d$ may be linked to the constraint elements of $\itn v$, in accordance with the target configuration $\itn\delta$.
%
Since $e$ is mobile in $\gamma$, the weights of the edges $d$ suffice to fill the inflow constraint of $v$, and correspondingly the weight elements of edge-gadgets $\itn d$ suffice to fill the constraint elements of $\itn v$, so that $\itn e$ is mobile.
%
Next, the indicator vertex of $\itn e$, which links to the indicator target of $\itn v$, is re-attached to the indicator target of $\itn w$.
%
Again using Lemma~\ref{lem:octopus roll}, the weight elements of edge-gadgets connected to $\itn w$, including $\itn e$, may be linked in accordance with $\itn\delta$.
%
The resulting proof net is $\itn\delta$ modulo a permutation of weight absorbers; then it is equivalent to either $\itn\delta$ or $\itn\delta'$ by Lemma~\ref{lem:permute weight absorbers}.
\end{proof}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Soundness}


It will be shown that proof net rewiring $\itn\gamma\perm\itn\delta_\gamma$ is sound for \capsabbrev{ncg}-reconfiguration, $\gamma\perm\delta$.
%
To each proof net $\links$ for an encoded constraint graph $\itn G$ we will associate a partial configuration $\gamma=\coitn\links$, such that 1) a rewiring step between $\links$ and $\links'$ corresponds to a reconfiguration path $\coitn\links\perm\coitn{\links'}$, and 2) the function $\coitn-$ is a retraction of the encoding of configurations, $\coitn{\itn\gamma}=\gamma$.



The configuration $\coitn\links$ will assign an edge $e$ to a vertex $v$ when, in the proof net $(\links,\itn G)$, the edge-gadget $\itn e$ is in the empire of the vertex-gadget $\itn v$.
%
Firstly, it will be shown that $\coitn\links$ is a partial function.


\begin{proposition}[{\cite[Proposition 1.i]{Bellin-vandeWiele-1995}}]
\label{prop:tensor has disjoint subnets}
In a proof net, if vertices $v$ and $w$ are joined by a tensor, then any two subnets of which they are respective ports are disjoint.
\end{proposition}


\begin{lemma}
In a proof net for $\itn G$, an edge-gadget $\itn e$ belongs to the empire of at most one vertex-gadget $\itn v$.
\end{lemma}

\begin{proof}
Since vertex-gadgets are joined by a tensor, the lemma is immediate from Proposition~\ref{prop:tensor has disjoint subnets}.
\end{proof}


Next, it will be shown that the appropriate edge-gadgets in the empire of a vertex-gadget $\itn v$ contain sufficient weight elements to fill the constraint elements of $\itn v$.


\begin{lemma}
\label{lem:appropriate edge weights}
In a proof net for $\itn G$, for each node $v$ in $G$, the weights of the appropriate edge-gadgets in the empire of $\itn v$ are equal to or greater than the constraint of $v$.
\end{lemma}


\begin{proof}
%
Let $|E|=m$.
%
We will show that the inappropriate edge-gadgets in $G$ are insufficient to fill $3m$ weight elements in $\itn v$.
%
Since weight elements come in multiples of $3m$, it follows that to fill the $3m\times c(v)$ constraint elements of $v$, there must be at least as many appropriate weight elements available.



Let $e$ be inappropriate for $v$; let $C=A\tn B$ be a constraint element in $\itn v$, and $W=X\parr Y\parr Z$ weight element  in $\itn e$.
%
To find a proof net for the sequent $W,C$ requires to assign balanced boxes to the par-formulae $A$ and $B$.
%
Since $e$ is inappropriate, the sequents $A,X$ and $A,X,Y$ are not balanced, while the balance of each of the other sequents of $A$ with one or more of $X,Y,Z$ is always $1$ or $2$ $\pmod 3$.
%
It follows that there is no proof net for $W,C$.


Next, it will be shown that to balance $3m$ constraint elements requires at least $m+1$ inappropriate edge-gadgets.
%
Two edge-gadgets may balance at most three constraint elements: one weight element $W$ has three subformulae, which may each balance at most one half of a constraint element; the other halves may be balanced by different weight elements of the second edge-gadget.
%
In the same way, adding one further edge-gadget allows at most three further constraint elements to be filled, since previous edges may connect to only one half of each constraint element.
%
Then to balance $3m$ constraint elements inappropriately requires $m+1$ edge-gadgets.
%
\end{proof}



Using the above, a proof net for $\itn G$ may be interpreted as a configuration for $G$.



\begin{definition}
For a proof net $\links$ for $\itn G$, let $\coitn\links$ be the partial configuration for $G$ where $\coitn\links(e)$ is $v$ if both $e$ is appropriate for $v$ and $\itn e$ belongs to the empire of $\itn v$, and  undefined otherwise.
\end{definition}


The following lemma then shows that rewiring corresponds to reconfiguration under $\coitn-$.



\begin{lemma}
\label{lem:soundness}
If $\links\perm\links'$ are proof nets for $\itn G$ then $\coitn\links\perm\coitn{\links'}$.
\end{lemma}

\begin{proof}
The proof will consider the case where $\links\perm*\links'$; the general case follows by transitivity.
%
By Lemma~\ref{lem:rewiring affects empires}, the empire of each vertex-gadget $\itn v$ contains either a subset of, a superset of, or exactly the same edge-gadgets in $\links'$ as it does in $\links$.
%
Let $\itn {e_1}$ through $\itn {e_n}$ be the edge-gadgets moving into or out of the empire of $\itn v$.
%
By Lemma~\ref{lem:appropriate edge weights} other edge-gadgets must fill the constraint elements of $\itn v$.
%
Then the corresponding edges $e_1$ through $e_n$ are mobile in $\coitn\links$.
%
It follows that $\coitn\links\perm\coitn{\links'}$ by moving each $e_i$ in turn, and repeating the process for other vertices.
%
\end{proof}


%------------------------------------------------------------



\section{\capsabbrev{mll} proof equivalence is \capsabbrev{pspace}-complete}


%
We are now ready to state our main theorem.


\begin{theorem}
\capsabbrev{mll} proof equivalence is \capsabbrev{pspace}-complete.
\end{theorem}

\begin{proof}
\capsabbrev{mll} proof equivalence has at most non-deterministic polynomial space complexity: a proof net may be represented in linear space (with respect to a proof); a single rewiring step is performed without requiring additional space; and a non-deterministic algorithm may guess the correct rewiring sequence.
%
Then by Savitch's Theorem \cite{Savitch-1970} \capsabbrev{mll} proof equivalence is in \capsabbrev{pspace}.


\capsabbrev{pspace}-hardness is by the encoding of \capsabbrev{ncg}-reconfiguration, which in its completed form is stated:
\[
	\gamma\perm\delta \qquad\iff\qquad \itn\gamma\perm\itn\delta_\gamma~.
\]
%
The direction $(\Rightarrow)$ is by Lemma~\ref{lem:completeness}; the direction $(\Leftarrow)$ is by Lemma~\ref{lem:soundness} and the observation that $\coitn{\itn\gamma}=\gamma$ and $\coitn{\itn\delta_\gamma}=\delta$.
%
\end{proof}

\newpage

%\acks

We would like to thank Lutz Stra{\ss}burger for comments and discussion, and the anonymous referees for their constructive observations.

%===========================
\bibliographystyle{plain}
\bibliography{../refs}
\end{document}
%===========================

\end{document}


