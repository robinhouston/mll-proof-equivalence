\documentclass[conference]{IEEEtran}

\usepackage{amssymb,amsthm,amsmath}
\usepackage{microtype}
%\usepackage{enumitem}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{mathtools}

% Sorts citations; e.g. [1], [2], [5]--[7]
%\usepackage{cite}

% More reference handling options
%\usepackage{natbib}\renewcommand\bibfont{\footnotesize}

\usepackage{mllequiv,willemtools}

\graphicspath{{../notes/}}

\shortJournalNames
\makeTheoremDefs

\let\beforesection=\medskip
\let\aftersection=\noindent

\let\capsabbrev=\uppercase


\author{
  \IEEEauthorblockN{Willem Heijltjes}
  \IEEEauthorblockA{
  		University of Bath
	\\	Claverton Down
	\\	Bath BA2~7AY
	\\	w.b.heijltjes@bath.ac.uk
	}
\and
  \IEEEauthorblockN{Robin Houston}
  \IEEEauthorblockA{
		Kiln Enterprises
	\\	robin@kiln.it
	}
}

\title{No proof nets for \capsabbrev{mll} with units\\[5pt]\Large Proof equivalence in \capsabbrev{mll} is \capsabbrev{pspace}-complete}

%============================================================

\begin{document}

\maketitle

\begin{abstract}
\capsabbrev{mll} proof equivalence is the problem of deciding whether two proofs in multiplicative linear logic are related by a series of inference permutations.
%
It is also known as the word problem for $*$-autonomous categories.
%
Previous work has shown the problem to be equivalent to a rewiring problem on proof nets, which are not canonical for full \capsabbrev{mll} due to the presence of the two units.
%
Drawing from recent work on reconfiguration problems, in this paper it is shown that \capsabbrev{mll} proof equivalence is \capsabbrev{pspace}-complete, using a reduction from Nondeterministic Constraint Logic.
%
An important consequence of the result is that the existence of a satisfactory notion of proof nets for \capsabbrev{mll} with units is ruled out (under current complexity assumptions).
\end{abstract}


%------------------------------------------------------------
\beforesection

\section{Introduction}

\aftersection
%
The question of equivalence of proofs goes back to Lambek \cite{Lambek-1968}, who realised that the new tool of category-theoretic logic gave a notion of proof equivalence that was coarser and better-behaved than syntactic equality.

Later, a striking technical innovation of linear logic was the introduction of proof nets \cite{Girard-1987,Danos-Regnier-1989}, which define a canonical form for proofs in the unitless fragment of multiplicative linear logic -- two proofs are equivalent if and only if they have the same proof net -- so proof nets offer a simple decision procedure for proofs in this fragment. This naturally raises the question whether proof nets can be extended to work in the presence of units. The work in this direction begins with \cite{Trimble-1994,Blute-Cockett-Seely-Trimble-1996} via \cite{Strassburger-Lamarche-2004} and perhaps culminates in \cite{HughesFreeStar,HughesMLLProofNets}; but these proof nets are not canonical and must be identified up to a rewiring equivalence.

So the question remains whether there exist fully canonical proof nets for full \capsabbrev{mll}. Canonical proof nets have been found for several other fragments of linear logic: the combined multiplicative-additive fragment without units \cite{Hughes-vanGlabbeek-2005}, and the additive fragment, including the additive units \cite{Heijltjes-2011}.

In this paper we establish that the proof equivalence problem for multiplicative linear logic with units is \capsabbrev{pspace}-complete. It follows that there can be no satisfactory canonical notion of proof net.


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Constraint logic and reconfiguration problems}

\aftersection The proof of \capsabbrev{pspace}-completeness relies on a polynomial reduction from the configuration-to-configuration problem in nondeterministic
\emph{constraint logic}, a graphical formalism recently introduced as a uniform tool for use in complexity reductions \cite{Demaine-Hearn-2008}.
%
Constraint logic is a simple graph rewriting formalism, where weighted edges may be reversed as long as the given in-flow constraint for each vertex is satisfied; the configuration-to-configuration question is whether two graphs are related by a sequence of valid rewriting steps.

This is one of a class of problems called \emph{reconfiguration problems} \cite{ReconfigurationProblems}: can one solution to a given problem be transformed into another by a series of elementary changes, while remaining valid throughout?
%
For example, the reconfiguration problem for boolean satisfiability (SAT) asks whether one satisfying assignment can be transformed into another by changing the value of one atomic formula at a time, without passing via a non-satisfying assignment.
%
It is not uncommon for an \capsabbrev{np}-complete problem to have an associated reconfiguration problem that is \capsabbrev{pspace}-complete \cite{ReconfigurationProblems}; one example is SAT-reconfiguration, which is \capsabbrev{pspace}-complete. \capsabbrev{mll} proof equivalence may be regarded as the reconfiguration problem associated with \capsabbrev{mll} proof search, which is \capsabbrev{np}-complete \cite{Kanovich-1992,Lincoln-Winkler-1994}.

%------------------------------------------------------------

\begin{figure}[!b]
\quad\MLLrule b
\hfill\MLLrule 1
\hfill\MLLrule p
\hfill\MLLrule t
\quad
\caption{Inference rules for unit-only \capsabbrev{mll}}
\label{fig:MLL}
\end{figure}


\begin{figure}[!tb]
\renewcommand\scalefactor{0.88}
\[
\begin{array}{@{}rcl@{}}
	\multicolumn{3}{@{}c@{}}{
		\vc{\scale{\MLLperm{bb1}}} ~\perm~ \vc{\scale{\MLLperm{bb2}}}
		\hfill
		\vc{\scale{\MLLperm{bp1}}} ~\perm~ \vc{\scale{\MLLperm{bp2}}}
	}
\\ \\[6pt]
	\multicolumn{3}{@{}c@{}}{
		\vc{\scale{\MLLperm{bt2}}} ~\perm~ \vc{\scale{\MLLperm{bt1}}}
								   ~\perm~ \vc{\scale{\MLLperm{bt3}}}
	}
\\ \\[6pt]
	\vc{\scale{\MLLperm{pp1}}} &\perm& \vc{\scale{\MLLperm{pp2}}}
\\ \\[6pt]
	\vc{\scale{\MLLperm{pt1}}} &\perm& \vc{\scale{\MLLperm{pt2}}}
\\ \\[6pt]
	\vc{\scale{\MLLperm{tt1}}} &\perm& \vc{\scale{\MLLperm{tt2}}}
\end{array}
\]
\caption{Permutations}
\label{fig:permutations}
\end{figure}

\beforesection

\section{\capsabbrev{mll}}

\aftersection
%
The formulae of unit-only multiplicative linear logic are given by the following grammar.
%
\setMidspace{5pt}
\[
	A,B,C \Coloneq \bot \Mid 1 \Mid A\parr B \Mid A\tn B
\]
%
The connectives $\tn$ and $\parr$ will be considered up to associativity, and \emph{duality} $\dual A$ is via DeMorgan.
%
A \emph{sequent} $\Gamma,\Delta$ will be a multiset of formulae.
%
Within a sequent, connectives and units will be \emph{named} with distinct elements from an arbitrary set of names, e.g.\
$\named a1\named b\parr\named c1,\named d\bot\named e\tn\named f\bot$.
%
This allows to 1) identify \emph{occurrences} of subformulae uniquely by the name of their root connective, e.g.\ as $\named bA$, 2) distinguish the two proofs of the above sequent while using standard multiset sequents, and 3) easily extract proof nets, as graphs using the names of connectives as vertices.
%
Names will mostly be left implicit.



Proofs are constructed from the inference rules in Figure~\ref{fig:MLL}, where the names of units and connectives are preserved through inferences.
%
Only cut-free proofs are considered, and no cut-rule is added.
%
\emph{Permutations} of inference rules are displayed in Figure~\ref{fig:permutations}; the symmetric variants of the last two permutations, \emph{par-tensor} and \emph{tensor-tensor}, have been omitted.



\begin{definition}
\label{def:equivalence}
%
\emph{Equivalence} of proofs $(\perm)$ in (cut-free, unit-only) multiplicative linear logic is the congruence generated by the permutations given in Figure~\ref{fig:permutations}.
%
\emph{\capsabbrev{mll}\ proof equivalence} is the problem of deciding whether two given proofs are equivalent.
%
\end{definition}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Proof nets}

Proof nets provide a solution to proof equivalence for \capsabbrev{mll} without units.
%
For full \capsabbrev{mll}, they reduce the proof equivalence problem to a simple rewiring relation \cite{HughesMLLProofNets}.


\begin{definition}
\label{def:proof nets}
%
For a sequent $\Gamma$,
\begin{itemize}

	\item
	a \emph{linking} $\links$ is a function from the names of $\bot$-subformulae to the names of $1$-subformulae,

	\item
	a \emph{switching graph} for $\links$ is an undirected graph over the names of $\Gamma$, with for every subformula $\named aA\named c\tn\named bB$ the edges $\edge ac$ and $\edge bc$, for every subformula $\named aA\named c\parr\named bB$ either the edge $\edge ac$ or the edge $\edge bc$, and for every subformula $\named a\bot$ the edge $\edge a{\links(a)}$,

 	\item
	a \emph{proof net} $\links$ or $(\Gamma,\links)$ is a linking $\links$ such that every switching graph is acyclic and connected.

\end{itemize}
\end{definition}


\noindent
An edge $\edge a{\links(a)}$ in a proof net or switching graph is called a \emph{link} or a \emph{jump}.
%
% MAYBE SAY: The restriction that links must target $\1$-occurrences (rather than any connective) can be circumvented by replacing a subformula $A$ by the equivalent $A\tn\1$.


\begin{definition}
\label{def:proof net equivalence}
%
A \emph{rewiring} $(\perm*)$ between proof nets is the redirection of exactly one link.
%
\emph{Equivalence} $(\perm)$ of proof nets over a sequent $\Gamma$ is the equivalence generated by rewirings.
%
\end{definition}


\noindent
In the sequent calculus, the introduction rule for $\bot$ joins a $\bot$-formula to a sequent $\Gamma$, rather than an occurrence of $\1$.
%
The interpretation of a proof as a proof net may attach the corresponding link to an arbitrary $\1$ in $\Gamma$.


\begin{definition}
\label{def:proofs to nets}
%
The relation $(\toNet)$ interprets a proof $\Pi$ for a sequent $\Delta$ by a linking $\links$ as follows:
% 
$\Pi\toNet\links$ if for each $\named a\bot$ in $\Delta$, if $\Gamma$ is the context of the inference introducing $\named a\bot$, as illustrated below, then $\links(a)$ is the name of some $1$ in $\Gamma$.
\[
	\infer[\MLLlabel b]{\Gamma,\named a\bot}{\Gamma}
\]
%
\end{definition}



\begin{proposition}[\cite{Danos-Regnier-1989}]
\label{prop:correctness and sequentialisation}
%
%
If $\Pi\toNet\links$ and $\Pi$ has conclusion $\Gamma$, then $\links$ is a proof net for $\Gamma$.
%For a proof $\Pi$ with conclusion $\Gamma$, if $\Pi\toNet\links$ then $\links$ is a proof net for $\Gamma$.
%
For a net $\links$ for $\Gamma$, there is a proof $\Pi$ of $\Gamma$ such that $\Pi\toNet\links$ (\emph{sequentialisation}).
%
\end{proposition}


\noindent
Proof nets are canonical representations of proofs in the absence of units: they factor out the permutations among tensor- and par-inferences, which are the last three permutations in Figure~\ref{fig:permutations}.
%
Equivalence of proof nets is generated by the four remaining permutations, on $\bot$-introduction.



\begin{proposition}[\cite{HughesMLLProofNets}] %[\citeauthor{HughesMLLProofNets}, \citeyear{HughesMLLProofNets}]
\label{prop:proof nets work}
%
For proofs $\Pi$, $\Pi'$ and proof nets $\links$, $\links'$ such that $\Pi\toNet\links$ and $\Pi'\toNet\links'$, $\Pi\perm\Pi'$ if and only if $\links\perm\links'$.
%
\end{proposition}


\noindent
The above proposition means that \capsabbrev{mll}\ proof equivalence is the problem of deciding equivalence of proof nets.
%
% We will use proof net equivalence to encode constraint logic.


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Notation}


We will use a concise diagrammatic notation for sequents and proof nets.
%
The units $1$ and $\bot$ are represented by a circle $\circ$ and a disc $\bullet$ respectively;
%
formulae related by a tensor will be connected by edges; 
and
formulae related by a par will be juxtaposed, and collected in a box when a par-formula is an immediate subformula of a tensor-formula.
%
For example, the following denote the same sequent:
\[
	\bot\tn\bot,\bot\tn\bot,\1,(\1\parr\1\parr\1)\tn\bot
\]
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (0,0) node[bullet] (a) {} -- (1,0) node[bullet] (b) {} (2,0) node[bullet] (c) {} -- (3,0) node[bullet] (d) {};
	\node[circ] (1) at (4,0) {};
	\node[circ] (2) at (5.25,0) {}; \node[circ] (3) at (6.25,0) {}; \node[circ] (4) at (7.25,0) {};
	\draw[rounded corners] (4.75,-1) rectangle (7.75,1);
	\draw (7.75,0) -- (8.75,0) node[bullet] (e) {};
\end{tikzpicture}
\]
The links of a proof net are added to the sequent as coloured arrows.
%
The following example is a proof net for the above sequent.
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\node[circ] (1) at (6,0) {};
	\draw (0,0) node[bullet] (a) {} -- (1,0) node[bullet] (b) {} (3,0) node[bullet] (c) {} -- (4,0) node[bullet] (d) {};
	\node[circ] (2) at (1,3) {}; \node[circ] (3) at (2,3) {}; \node[circ] (4) at (3,3) {};
	\draw[rounded corners] (0,2) rectangle (4,4);
	\draw (4,3) -- (5,3) node[bullet] (e) {};
	\begin{scope}[thepink,->]
			\draw[bend right=10] (a) to (2.center);
			\draw[bend right=10] (b) to (3.center);
			\draw[bend left=10]  (c) to (3.center);
			\draw[bend left=10]  (d) to (4.center);
			\draw[bend right=10] (e) to (1.center);
	\end{scope}
\end{tikzpicture}
\]


We will denote by $A^n$ the sequent consisting of $n$ occurrences of a formula $A$.
%
Given a sequent $\Gamma=A_1,\dotsc,A_n$ we will write $\bigtn\Gamma$ for $A_1\tn\cdots\tn A_n$, and $\bigparr\Gamma$ for $A_1\parr\cdots\parr A_n$.
%
In diagrammatic notation, a big disc will represent an $n$-ary tensor over only $\bot$-formulae, $\bigtn(\bot^n)$, and a big circle will represent an $n$-ary par (or a sequent) over only $1$-formulae, $\bigparr(\1^n)$.
%
A linking between $\bigtn(\bot^n)$ and $\bigparr(\1^n)$ will be represented by a wide arrow, as illustrated below.
\[
\begin{tikzpicture}[x=-5mm,y=5mm,octo]
	\node[big_] (A) at (-1,2) {};
	\node[big1] (!) at (-1,0) {};
	\node at (.5,1) {$\Rightarrow$};
	\draw (2,2) node[bullet] (a) {} -- (3,2) node[bullet] (b) {} -- (4,2) (5,2) -- (6,2) node[bullet] (c) {}; 
	\node[circ] (1) at (2,0) {}; \node[circ] (2) at (3,0) {}; \node[circ] (3) at (6,0) {};
	\draw[dotted] (4,2)--(5,2) (4,0)--(5.1,0);
	\begin{scope}[thepink,->]
			\draw[big>] (A) to (!.center);
			\draw[bend right=10] (a) to (1.center);
			\draw[bend right=10] (b) to (2.center);
			\draw[bend right=10] (c) to (3.center);
	\end{scope}
\end{tikzpicture}
\]
Two formulae $\bigtn(\bot^{i+1})$ and $\bigtn(\bot^{j+1})$ may together connect to a formula $\bigparr(\1^{i+j+1})$, as illustrated below for $i=2$ and $j=3$.
%
Nodes will be labelled $i'$ for $i+1$, so that both the abbreviated formulae and the arithmetic of connecting them remain intuitive.
%
\[
\vc{
  \begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (0,0) node[bullet] (a) {}--
		  (1,0) node[bullet] (b) {}--
		  (2,0) node[bullet] (c) {};
	\draw (4,0) node[bullet] (d) {}--
		  (5,0) node[bullet] (e) {}--
		  (6,0) node[bullet] (f) {}--
		  (7,0) node[bullet] (g) {};
	\foreach \i in {1,...,6} {\node[circ] (\i) at (\i,3) {};}
	\begin{scope}[thepink,->]
			\draw[bend right=10] (a) to (1);
			\draw[bend right=10] (b) to (2);
			\draw[bend right=10] (c) to (3);
			\draw[bend left=10]  (d) to (3);
			\draw[bend left=10]  (e) to (4);
			\draw[bend left=10]  (f) to (5);
			\draw[bend left=10]  (g) to (6);
	\end{scope}
  \end{tikzpicture}
}
\quad\Rightarrow\quad
\vc{
  \begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\node[big_] (A) at (-1,0) {$2'$};
	\node[big_] (B) at ( 1,0) {$3'$};
	\node[big1] (!) at ( 0,3) {$5'$};
	\begin{scope}[thepink,->,big>]
		\draw[bend right=15] (A) to (!);
		\draw[bend left=15]  (B) to (!);
	\end{scope}
  \end{tikzpicture}
}
\]
%
A dashed edge will indicate that two vertices are connected, in a proof net or a switching graph, as illustrated below.
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[bullet] (a) at (0,0) {}; \node[bullet] (b) at (2,0) {}; \draw[dashed] (a)--(b);
\end{tikzpicture}
\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[circ] (a) at (0,0) {}; \node[circ] (b) at (2,0) {}; \draw[dashed] (a)--(b);
	%\coordinate (a') at ($(a) + (.6,0)$); \coordinate (b') at ($(b) + (-.6,0)$);
	%\draw[thepink,dashed] (a')--(b'); \draw[thepink,->] (a')--(a.center); \draw[thepink,->] (b')--(b.center);
\end{tikzpicture}
\]


%------------------------------------------------------------

\beforesection

\section{Rewiring proof nets}

\aftersection
%
In this section we will explore the global rewiring behaviour of proof nets.
%
In particular, we will look at notions of subnets, and we will give a simple account of equivalence for the fragment of \capsabbrev{mll} that omits the par, i.e.\ that of sequents of formulae constructed over $\1$, $\bot$, and $\tn$.


\begin{figure*}
\[
	\vc{\doubleExchange uvxy}
	\quad\perm*\quad
	\vc{\doubleExchange uyxy}
	\quad\perm*\quad
	\vc{\doubleExchange uyxu}
	\quad\perm*\quad
	\vc{\doubleExchange vyxu}
	\quad\perm*\quad
	\vc{\doubleExchange vyyu}
	\quad\perm*\quad
	\vc{\doubleExchange vuyu}
	\quad\perm*\quad
	\vc{\doubleExchange vuyx}
\]
\caption{Double exchange of links (Lemma~\ref{lem:double exchange})}
\label{fig:double exchange}
\end{figure*}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


\subsection*{Subnets}


We will discuss (and adapt) some convenient standard notions for \capsabbrev{mll} proofs and proof nets, and relate them to rewiring.
%
Firstly we will look at subnets---see also \cite{Bellin-vandeWiele-1995}.


\begin{definition}
A \emph{sub-sequent} $\Delta\leq\Gamma$ of a sequent $\Gamma$ is a sequent consisting of disjoint subformulae of $\Gamma$, preserving names.
\end{definition}

\begin{definition}
A \emph{subnet} $(\Gamma',\links') \leq (\Gamma,\links)$ of a proof net is a net such that $\Gamma'\leq\Gamma$ and $\links'$ is $(\links|_{\Gamma'})$, the restriction of $\links$ to $\Gamma'$.
\end{definition}


The root vertices of $\Gamma'$ are the \emph{ports} of the sub-sequent $\Gamma'$ and of the subnet $(\Gamma',\links')$.
%
A \emph{scope} of a par $\named v\parr$ is a subnet that has $v$ as a port.


The scopes of a par correspond to the possible subproofs of its introduction rule in a sequentialisation of the proof net that it occurs in.
%
In the graph of a proof net, the scope of a par $\named v\parr$ may be \emph{contracted} to a single vertex $v$ by removing all vertices except $v$,  and re-attaching the edges of any removed vertices to $v$.
%
In the example below, a scope of a (ternary) par is indicated (left) and contracted (right).
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (-2.25,0) node[bullet] (x) {} -- (-1.25,0) node[bullet] (y) {}
		  (.25,0) node[bullet] (a) {} -- (1.25,0) node[bullet] (b) {}
		  ( 2.75,0) node[bullet] (c) {} -- (3.75,0) node[bullet] (d) {};
	\node[circ] (0) at (5.75,0) {};
	\node[circ] (1) at (-1,3) {};
	\node[circ] (2) at (1,3) {}; \node[circ] (3) at (2,3) {}; \node[circ] (4) at (3,3) {};
	\draw[rounded corners] (0,2) rectangle (4,4);
	\draw (4,3) -- (5.5,3) node[bullet] (e) {};
	\begin{scope}[thepink,->]
			\draw[bend right=10] (x) to (1);
			\draw[bend right=20] (y) to (2);
			\draw[bend right=10] (a) to (2);
			\draw[bend right=10] (b) to (3);
			\draw[bend left=10]  (c) to (3);
			\draw[bend left=10]  (d) to (4);
			\draw[bend right=10] (e) to (0);
	\end{scope}
	\draw[dashed,rounded corners] (-.25,-.5) rectangle (4.25,4.25);
\end{tikzpicture}
\qquad\qquad
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (-2.25,0) node[bullet] (x) {} -- (-1.25,0) node[bullet] (y) {};
	\node[circ] (0) at (3,0) {};
	\node[circ] (1) at (-1,3) {};
	\node[draw,rounded corners,minimum size=16pt] (box) at (1,3) {};
	\draw (box)--(3,3) node[bullet] (e) {};
	\begin{scope}[thepink,->]
			\draw[bend right=10] (x) to (1);
			\draw[bend right=20] (y) to (box);
			\draw[bend right=10] (e) to (0);
	\end{scope}
	\path (0,4.25)--(1,4.25);
\end{tikzpicture}
\]
%
The contraction of scopes may replace the switching condition as a correctness criterion.
%
The following is a variant of the local retraction algorithm by Danos \cite{Danos-1990}.


\begin{proposition}
\label{prop:scoping correctness}
A linking $\links$ for a sequent $\Gamma$ is a proof net if and only if each $\named v\parr$ is a port of a sub-sequent $s(v)\leq\Gamma$ such that:

\begin{enumerate}
	\item
sub-sequents either disjoint or strictly nested: if $s(v)\cap s(w)\neq\varnothing$ then $s(w)<s(v)$ or $s(v)<s(w)$; and
	\item
for each $\named v\parr$ the graph $\sigma(v)=(s(v),\links|_{s(v)})$ becomes a tree when all immediate sub-sequents are contracted.
\end{enumerate}
%
\end{proposition}


\begin{IEEEproof}
For the `if' direction, it follows by induction on the nesting of sub-sequents that each graph $\sigma(v)$ satisfies the switching condition.
%
For the `only if' direction, given a sequentialisation of $(\Gamma,\links)$, a sub-sequent $s(v)\leq\Gamma$ for each $\named v\parr$ is found by taking the conclusion $\Delta, A\named v\parr B$ of its introduction rule, below.
\[
	\infer[\MLLlabel p]{\Delta,A\named v\parr B}{\Delta,A,B}
\]
\vskip-12pt
\end{IEEEproof}



In a proof net, the \emph{kingdom} and the \emph{empire} of a vertex $v$ are respectively the smallest and largest subnet that have $v$ as a port.
%
In working with the rewiring relation, the notion of empire can be particularly useful.
%
Firstly, we repeat the following proposition.


\begin{proposition}[{\cite[Proposition 2.b]{Bellin-vandeWiele-1995}}]
\label{prop:empire propagation}
The empire $\sigma$ of $v$ is determined by propagation from $v$: 1) through links; 2) up towards subformulae; 3) into a tensor if one of its subformulae is in $\sigma$; 4) into a par if all its subformulae are in $\sigma$; 5) except never into a par or tensor if $v$ is a subformula.
\end{proposition}


Empires are connected to rewiring in the following ways.


\begin{lemma}
\label{lem:rewiring within empire}
For a proof net $(\Gamma,\links)$ where $\links(a)=v$ and $w$ names a $\1$-occurrence in $\Gamma$, the following are equivalent:
%
\begin{enumerate}
	\item
$\links\perm*\links'$ where $\links'(a)=w$;
	\item
$w$ is in the empire of $a$; and
	\item
in any switching graph for $(\Gamma,\links)$, the path from $v$ to $w$ does not pass through $a$.
\end{enumerate}
\end{lemma}


\begin{IEEEproof}
By \cite[Proposition 2.a]{Bellin-vandeWiele-1995} 2 and 3 are equivalent.

Next, the empire of $a$ corresponds to the largest subproof $\Sigma$ in any $\Pi\toNet\links$ with as conclusion the introduction rule of $\named a\bot$.
%
By Definition~\ref{def:proofs to nets}, in the translation of $\Sigma$ to a net $\sigma$, $a$ may link anywhere in $\sigma$.
%
Then 2 implies 1. 

Finally, if for some switching of $\links$ the path from $v$ to $w$ passes through $a$, then in $\links'$ there is no path between $a$ and $v$ (and two paths between $a$ and $w$) for that switching, so $\links'$ is not a net; then by contraposition 1 implies 3.
%
\end{IEEEproof}


\begin{lemma}
\label{lem:rewiring preserves empire}
Let $\links\perm*\links'$ by $\links(v)\neq\links'(v)$, and denote the empire of $v$ in $\links$ and $\links'$ by $\sigma$ and $\sigma'$ respectively; then $\sigma\perm*\sigma'$.
\end{lemma}

\begin{IEEEproof}
By Lemma~\ref{lem:rewiring within empire} the empires $\sigma$ and $\sigma'$ contain the same $\1$-subformulae, since $v$ may rewire to exactly the same $\1$-occurrences in $\links$ as in $\links'$.
%
That $\sigma$ and $\sigma'$ must share also any other subformula $A$ follows by the observation that $A\tn\1$ may replace $A$: by Proposition~\ref{prop:empire propagation} the new $\1$ is in a given empire if and only if $A$ is.
%
\end{IEEEproof}


\begin{lemma}
\label{lem:rewiring affects empires}
For proof nets $\links\perm*\links'$, let the empire of a given vertex $v$ in $\links$ be a net for the sequent $\Delta$, and in $\links'$, for $\Delta'$; then $\Delta\leq\Delta'$ or $\Delta\geq\Delta'$.
\end{lemma}


\begin{IEEEproof}
Let the link from $a$ be rewired, $\links(a)=w$ but $\links'(a)=w'$.
%
Using Proposition~\ref{prop:empire propagation}, there are four cases.
%
\begin{enumerate}
	\item
If the empire of $v$ is propagated from $a$ to $w$ in $\links$, it includes the empire of $a$.
%
Then by Lemma~\ref{lem:rewiring preserves empire} $\Delta=\Delta'$.

	\item
If the empire of $v$ includes $w$ but not $w'$, then it is propagated through $a$ in $\links$ but not in $\links'$, so that $\Delta\geq\Delta'$.

	\item
If the empire of $v$ includes $w'$ but not $w$, then $\Delta\leq\Delta'$.

	\item
Otherwise, $\Delta=\Delta'$.
\end{enumerate}
\vskip-12pt
\end{IEEEproof}



% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -


\subsection*{Equivalence without $\parr$}


A basic observation on \capsabbrev{mll} is that the identity proof for $\bot\tn\bot,\1\parr\1$ is not equivalent to the `symmetry' or `twist' proof for the same sequent.
%
This will hold in general: exchanging the targets of two links generally results in an inequivalent net, in particular when the $\bot$-instances are connected by a tensor.
%
However, a double such exchange commonly does give an equivalent net.


\begin{lemma}
\label{lem:double exchange}
Let $\links$ be a proof net where $\links(a)=u$, $\links(b)=v$, $\links(c)=x$, and $\links(d)=y$, and for any switching the path from $u$ to $y$ passes through the links $\edge bv$ and $\edge xc$.
%
Then $\links\perm\links'$ where $\links'(a)=v$, $\links'(b)=u$, $\links'(c)=y$, and $\links'(d)=x$, and $\links'(z)=\links(z)$ otherwise.
\end{lemma}

\begin{IEEEproof}
By the rewiring path shown in Figure~\ref{fig:double exchange}.
\end{IEEEproof}


This dynamic completely characterises rewiring in the fragment of \capsabbrev{mll} that omits the par.
%
The following standard notion of \emph{balance} characterises provability for it.


\begin{definition}
The \emph{balance} of a sequent is the number of $\bot$s minus the number of $\parr$s and commas.
%
A sequent is \emph{balanced} if its balance is zero.
\end{definition}


\begin{proposition}
\label{prop:unbalanced then uninhabited}
An unbalanced sequent is uninhabited.
\end{proposition}


Let a \emph{basic} sequent be one of formulae constructed only over $\1$, $\bot$, and $\tn$.
%
After removing $\bot$-formulae and replacing subformulae $\1\tn A$ with $A$, basic sequents consist of formulae of the form $1$ or $\bigtn(\bot^n)$ with $n\geq2$.


\begin{proposition}
A basic sequent is inhabited if and only if it is balanced.
\end{proposition}

\begin{proposition}
A basic sequent $\bigtn(\bot^n),\1^n$ is inhabited by exactly $n!$ inequivalent proof nets.
\end{proposition}

\begin{proposition}
\label{prop:level0 max binary}
%
A basic sequent with at least two tensor-formulae has at most two equivalence classes of proof nets.
%
\end{proposition}


\begin{IEEEproof}
By induction on the size of a sequent $\Gamma$.
%
The base case is the sequent $\1,\1,\bot\tn\bot$, which has two inequivalent proof nets.
%
For the inductive step, let $A\tn\named a\bot$ be a largest $\tn$-formula in $\Gamma$, and pick an occurence $\named z\1$.
%
It will be shown that any net $\links$ is equivalent to one $\links'$ where $\links'(a)=z$; then by induction, for the sequent $\Gamma$ with $\named z\1$ removed and $A\tn\named a\bot$ replaced by $A$, the subnet for $\links'$ belongs to one of two equivalence classes.


To find $\links'$, if $\links(a)=z$ we are done.
%
Next, if the path from $\links(a)$ to $z$ does not pass through $a$, then by Lemma~\ref{lem:rewiring within empire} $\links'$ may be obtained from $\links$ by rewiring only $\links'(a)=z$.
%
Thirdly, let $\links(b)=z$ for a $\named b\bot$ in $A$.
%
Let $\named c\bot$ and $\named d\bot$ be occurrences in a separate formula $B$ such that $c$ links to the same $\1$-occurrence as some $\bot$ in $A$.
%
Then $\links'$ is obtained by first linking $c$ to $b$, and then applying Lemma~\ref{lem:double exchange} to exchange the targets of $a$ and $b$, as well as the targets of $c$ and $d$.


Finally, let the path from $a$ to $z$ pass $\named b\bot$ in $A$.
%
Then using Lemma~\ref{lem:rewiring within empire} re-attach $b$ to $z$, and repeat as above.
\end{IEEEproof}


\subsection*{Parity}


We shall associate a \emph{parity} with any two linkings $\links$ and $\links'$ of the same sequent $\Gamma$. We shall find that the parity of equivalent linkings is always even; and that the converse holds when $\Gamma$ is a basic sequent.

For this argument we shall assume that the connectives $\tn$ and $\parr$ are n-ary, and that every argument of a $\tn$ is a $\parr$ and vice versa. Assume also that $\Gamma$ consists of a single formula, if necessary by introducing a $\parr$ at the root. Now fix an arbitrary switching of $\Gamma$; this switching together with a linking $\links$ defines a tree whose vertices are the subformulae of $\Gamma$ and whose edges are the edges of the chosen switching together with the links of $\links$. Take the root of the formula $\Gamma$ to be the root of this tree. Now consider the edges of the tree to be directed away from the root; so the root has in-degree $0$ and the other vertices have in-degree $1$. This therefore establishes a bijection between the edges of the tree and the non-root vertices.
%
A second linking $\links'$ similarly establishes such a bijection. Given both linkings $\links$ and $\links'$, we compose these bijections to obtain a permutation of the proper subformulae of $\Gamma$. Finally the parity of the pair of linkings is taken to be the parity of this permutation.

\begin{lemma}
	The parity is well-defined, in the sense that it does not depend on the choice of switching.
\end{lemma}
\begin{IEEEproof}
	It suffices to show that changing the switching of a single $\parr$ node does not change the parity.
	Observe that the tree is bipartite: every edge connects a $\tn$ with a $\parr$ node. Therefore two
	arguments of a $\parr$ are connected, in the tree, by a path of even length. Changing the switching will
	therefore induce a cyclic permutation of an odd number of edges (the even number of edges on the path
	connecting the two $\parr$ arguments, and the edge connecting the $\parr$ to its argument); and a cyclic
	permutation of an odd number of elements is an even permutation.
\end{IEEEproof}

Essentially the same argument also establishes that:
\begin{lemma}
	If two linkings are equivalent, their parity is even.
\end{lemma}


\begin{proposition}
\label{prop:parity determines equivalence}
Two proof nets for a basic sequent with at least two tensor-formulae are equivalent if and only if they have the same parity.
\end{proposition}

\begin{IEEEproof}
By Proposition~\ref{prop:level0 max binary} the sequent has at most 2 equivalence classes.
%
Given two proof nets of even parity, both must be in the other equivalence class than a proof net with odd relative parity to both, which exists by exchanging two jumps from one tensor-formula.
\end{IEEEproof}


The previous illustrates that equivalence in the fragment without $\parr$ is determined by two main characteristics: 1) proof nets that differ by the exchange of exactly two links are generally not equivalent; and 2) as long as there are at least two tensor-formulae in the sequent, proof nets are equivalent whenever this is possible while respecting the previous.


These characteristics hold the following lessons on rewiring for the design of our encoding in Section~\ref{sec:encoding}. 
%
Firstly, making proof nets equivalent is generally easier than preventing them from being equivalent, and in particular changing a formula $A$ to $A\tn\bot$ dramatically increases its rewiring potential.
%
The focus of our encoding will therefore be on preventing undesired linkings from being proof nets at all, rather than being unreachable by rewiring.
%
Secondly, the problem that proof nets up to a single exchange of links are generally not equivalent is too subtle to be useful as a feature of an encoding, and shall mean no more than a technical distraction.



%------------------------------------------------------------

\beforesection

\section{Encoding constraint logic}
\label{sec:encoding}

\aftersection
%
\emph{Non-deterministic constraint logic} \cite{Hearn-Demaine-2005,Demaine-Hearn-2008} is a simple graph-rewriting formalism, introduced as a convenient tool for \capsabbrev{pspace}-hardness reductions.
%
A rewrite step consists of the reversal of a single edge in a \emph{constraint graph}, a graph with weighted, directed edges and an \emph{inflow constraint} on each vertex.
%
Rewrite steps must preserve the condition that the total weight of the incoming edges of each vertex is at least its inflow constraint.
%
The specific problem we will use is the \emph{configuration--to--configuration} problem, which asks whether a path of rewrite steps exists between two constraint graphs.


We will introduce minor adaptations to this formalism to suit our reduction to \capsabbrev{mll} proof equivalence.
%
Mainly, a constraint graph itself will have \emph{undirected} edges, while a separate notion of \emph{configuration} imposes a direction on them.
%
A constraint graph may then be encoded as a sequent, and a configuration as a proof net.
%
In addition, we will allow \emph{partial} configurations, where edges may be left undirected---as long as the inflow constraints are satisfied by the directed edges.


\begin{definition} 
A \emph{constraint graph} $G=(V,E,c,v,w)$ consists of: a set $V$ of vertices with \emph{inflow constraint} $c\colon V\to\mathbb N$; and a set $E$ of undirected edges with \emph{weight} $w\colon E\to\mathbb N$, connecting vertices $v(e)=\{v_1,v_2\}\subseteq V$.
%of at most one undirected edge $e$ per vertex-pair $v(e)=\{v_1,v_2\}$, with \emph{weight} $w\colon E\to N$.

\smallskip

A \emph{(partial) configuration} for a constraint graph is a (partial) function $\gamma\colon E\to V$ such that
\begin{itemize}
	\item
for every edge $e$, if $\gamma(e)$ is defined then $\gamma(e)\in v(e)$,
	\item
for every vertex $v$, the total weight of its incoming edges is at least its inflow constraint, 
%$\sum\{\kern1pt w(e)\kern1pt|\kern1pt\gamma(e)=v\kern1pt\}\geq c(v)$.
$\sum\{w(e)\mid\gamma(e)=v\}\geq c(v)$.
\end{itemize} 

\smallskip
A \emph{reconfiguration step} $\gamma\perm*\delta$ relates two (partial) configurations for an \capsabbrev{ncg} $G$ that differ in value (or definedness) on exactly one edge.
%
The reflexive--transitive closure of $(\perm*)$ will be denoted $(\perm)$.
%
\end{definition}


\begin{proposition}
\label{prop:partial simulates total reconfiguration}
For total configurations $\gamma$ and $\delta$, if $\gamma\perm\delta$ then $\gamma$ and $\delta$ are also connected by a sequence of reconfiguration steps over total configurations only.
\end{proposition}


\begin{IEEEproof}
By the following two observations: firstly, 
%
if $\gamma\perm*\delta$ for partial configurations, then these may be completed to total configurations $\gamma'\perm*\delta'$ or $\gamma'=\delta'$; and secondly,
%
if $\gamma'$ and $\gamma''$ are total configurations that both agree with a partial configuration $\gamma$ where the latter is defined, then $\gamma'$ and $\gamma''$ are connected by reversing the edges on which they disagree one after another.
%
\end{IEEEproof}


\emph{Non-deterministic constraint graph reconfiguration} or \emph{\capsabbrev{ncg}-reconfiguration} is the problem of deciding whether two total configurations of a constraint graph are connected by a sequence of reconfiguration steps.
%
%By the above proposition, \capsabbrev{ncg}-reconfiguration is unaffected by inclusion or exclusion of partial configurations.



\begin{theorem}[\cite{Hearn-Demaine-2005}]
\capsabbrev{ncg}-reconfiguration is \capsabbrev{pspace}-complete.
\end{theorem}

%By Proposition~\ref{prop:partial simulates total reconfiguration} the following is then immediate.
%
%\begin{proposition}
%Partial \capsabbrev{ncg}-reconfiguration is \capsabbrev{pspace}-complete.
%%\capsabbrev{pncg}-reconfiguration is \capsabbrev{pspace}-complete.
%\end{proposition}


We will demonstrate the \capsabbrev{pspace}-hardness of \capsabbrev{mll} proof equivalence by an encoding of \capsabbrev{ncg}-reconfiguration in \capsabbrev{mll} proof nets.


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{The encoding}


The basis of the encoding of constraint graphs in \capsabbrev{mll} is formed by \emph{weight elements}, which encode one unit of weight on an edge, and \emph{constraint elements}, that encode one unit towards the inflow constraint of a vertex.
%
The arithmetic of linking formulae of the form $\bigtn(\bot^n)$ to formulae $\bigparr(1^m)$ will be used to ensure that a weight element may be linked to only two vertices.
%
Below left is a weight element, below right a constraint element.
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big_] (A) at (0,0) {$i'$}; 
	\node[big_] (B) at (2,0) {$j'$};
	\node[big_] (C) at (4,0) {$k'$};
	\draw[rounded corners] (-1,-1) rectangle (5,1);
\end{tikzpicture}
\qquad\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big1] (1) at (0,0) {$m'$}; 
	\node[big1] (2) at (3,0) {$n'$};
	\draw[rounded corners] (-1,-1) rectangle (1,1) (2,-1) rectangle (4,1);
	\draw (1,0)--(2,0);
\end{tikzpicture}
\]
For all edges and vertices in the encoding of a constraint graph, the sum $i+j+k=m+n$ will be the same -- this way, a priori any weight element may connect to any constraint element.
%
The value of $m$ (and thus $n$) will differ for each vertex.
%
The weight element above will be able to connect naturally to those constraint elements where $m=i$ and where $m=i+j$, as illustrated below.
\[
	\connectingElements 1 \qquad \connectingElements 2
\]
To ensure that no other connections can be made, values are chosen such that $m\equiv1$ and $n\equiv2$ $(\bmod3)$, and accordingly $i\equiv1$, $j\equiv0$, and $k\equiv2$ $(\bmod3)$.


In a constraint graph, the sum of weights is usually greater than the sum of all inflow constraints---otherwise, no edge can move, or no configuration exists.
%
An encoding will therefore have weight elements not connected to constraint elements.
%
These will instead connect to additional, separate $\1$-formulae, referred to as \emph{weight absorbers}, as follows.
%
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big_] (A) at (0,0) {}; 
	\node[big_] (B) at (2,0) {};
	\node[big_] (C) at (4,0) {};
	\draw[rounded corners] (-1,-1) rectangle (5,1);
	\node[big1] (1) at (7.5,0) {};
	\begin{scope}[thepink,->,big>]
		\draw[bend left=30] (A) to (1);
		\draw[bend right=30] (B) to (1);
		\draw (C) to (1);
	\end{scope}
\end{tikzpicture}
\]
%
An edge will be encoded by an \emph{edge-gadget}, illustrated below left, constructed by stringing together a number of similar weight elements plus a single \emph{indicator} vertex.
%
Illustrated below right is a \emph{vertex-gadget} encoding a vertex, formed by a number of constraint elements plus a single \emph{indicator target}.
%
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big_] (A) at (0,0) {$i'$}; 
	\node[big_] (B) at (2,0) {$j'$};
	\node[big_] (C) at (4,0) {$k'$};
	\draw[rounded corners] (-1,-1) rectangle (5,1);
	\node[big_] (D) at (0,4) {$i'$}; 
	\node[big_] (E) at (2,4) {$j'$};
	\node[big_] (F) at (4,4) {$k'$};
	\draw[rounded corners] (-1,3) rectangle (5,5);
	\draw (2,1)--(2,1.5) (2,2.5)--(2,3);
	\draw[dotted] (2,1.5)--(2,2.5);
	\draw (2,-1)--(2,-2) node[bullet] {};
	\path (0,-2.5)--(1,-2.5);
\end{tikzpicture}
\qquad\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big1] (1) at (0,0) {$m'$}; 
	\node[big1] (2) at (3,0) {$n'$};
	\draw[rounded corners] (-1,-1) rectangle (1,1) (2,-1) rectangle (4,1);
	\draw (1,0)--(2,0);
	\node[big1] (3) at (0,4) {$m'$};
	\node[big1] (4) at (3,4) {$n'$};
	\draw[rounded corners] (-1,3) rectangle (1,5) (2,3) rectangle (4,5);
	\draw (1,4)--(2,4);
	\draw[dotted] (1.5,1.5)--(1.5,2.6);
	\node[circ] at (1.5,-2) {};
	\draw[rounded corners] (-1.5,-2.5) rectangle (4.5,5.5);
\end{tikzpicture}
\]
%
It would be natural to encode an edge of weight $n$ by an edge-gadget with $n$ weight elements.
%
However, there is a minor issue that prevents this straightforward approach.
%
Although one weight element cannot `fill' an inappropriate constraint element, two weight elements can, in the way illustrated below.
%
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\node[big_] (A) at (-1,0) {}; 
	\draw (.75,0) node[big_] (B1) {} -- (2.25,0) node[big_] (B2) {};
	\node[big_] (C) at (4,0) {};
	\draw[rounded corners] (-2,-1) rectangle (5,1);
	\draw (7,0) node[big_] (D1) {} -- (8.5,0) node[big_] (D2) {}; 
	\node[big_] (E) at (10.25,0) {};
	\node[big_] (F) at (12,0) {};
	\draw[rounded corners] (6,-1) rectangle (13,1);
	\node[big1] (1) at (1,4) {};
	\node[big1] (2) at (4,4) {}; 
	\node[big1] (3) at (7,4) {};
	\node[big1] (4) at (10,4) {};
	\draw[rounded corners] (3,3) rectangle (5,5) (6,3) rectangle (8,5);
	\draw (5,4)--(6,4);
	\begin{scope}[thepink,->,big>]
		\draw[bend right=25] (A)  to (1);
		\draw[bend right=15] (B1) to (1);
		\draw[bend right=25] (B2) to (2);
		\draw[bend right=15] (C)  to (2);
		\draw[bend left=15] (D1) to (3);
		\draw[bend right=15] (D2) to (4);
		\draw[bend left=20] (E)  to (4);
		\draw[bend left=20] (F)  to (4);
	\end{scope}
\end{tikzpicture}
\]
%
In such an inappropriate linking, since both halves of the constraint element are connected, the weight elements must be disconnected---otherwise, the linking would violate the switching condition.
%
That means the weight elements must belong to different edges.
%
For the same reason, to fill the next weight element, one half may be filled by a weight element from a previous edge, but to fill the other half requires an additional edge to be involved.
%
To fill $n$ constraint elements inappropriately therefore requires $n+1$ edges.
%
It thus suffices to multiply the number of constraint elements by the number of edges, and encode a vertex with inflow constraint $c$ by a vertex-gadget with $c\times|E|$ constraint elements (where $|E|$ denotes the number of edges in the constraint graph).


The complete encoding of a constraint graph will be a sequent consisting of: 1) all vertex-gadgets combined in a single formula via tensors, 2) all edge-gadgets as individual formulae, 3) a sufficient number of weight absorbers ($\1$-formulae).
%
For the formal definition, let $|V|$ and $|E|$ denote the number of vertices and edges, respectively, in a constraint graph $G=(V,E,c,v,w)$, and let $|c|$ and $|w|$ denote the sum of all inflow constraints and the sum of all weights respectively:
\[
	|c| = \sum_{v\in V}c(v) \qquad |w| = \sum_{e\in E}w(e)~.
\]



\begin{definition}
\label{def:graph encoding}
The \emph{encoding} $\itn G$ of a constraint graph $G$ is a sequent constructed as follows.
%
Let $G=(V,E,c,v,w)$, and let $V=\{v_1,\dotsc,v_n\}$ and $E=\{e_1,\dotsc,e_m\}$ where $|V|=n$ and $|E|=m$.

\noindent
The encoding of a vertex $v_k$ is the formula
\[
	\itn{v_k} = \bigparr\big(C_n(k)^{m\times c(v_k)} \big)\parr\1
\]
where each \emph{constraint element} $C_n(k)$ is the formula
\[
	C_n(k) = \bigparr\big(1^{3k+2}\big) \tn \bigparr\big(1^{3(n-k)+3}\big)
\]

\noindent
The encoding of an edge $e$ connecting vertices $v_i$ and $v_j$ with $i<j$ is the formula
\[
	\itn{e} = \bigtn\big(W_n(i,j)^{m\times w(e)}\big)\tn\bot
\]
where each \emph{weight element} $W_n(i,j)$ is the formula
\[
	W_n(i,j) = \bigtn\big(\bot^{3i+2}\big)\parr\bigtn\big(\bot^{3(j-i)+1}\big)\parr\bigtn\big(\bot^{3(n-j)+3}\big)
\]

\noindent
The encoding of the graph $G$ is the sequent
\[
	\itn G = \itn{v_1}\tn\dotso\tn\itn{v_n}, \itn{e_1},\dotsc,\itn{e_m}, 1^p
\]
where $p=m\times(|w|-|c|)\times(3n+4)$.

\end{definition}



In the above definition, the final $\1$-subformula of a vertex-gadget $\itn{v_k}$ is its \emph{indicator target}; the final $\bot$-subformula of an edge-gadget $\itn{e}$ is its \emph{indicator}; and in the completed encoding $\itn G$ the $p$ instances of $\1$ are the \emph{weight absorbers}.
%
In a constraint graph $G$, a vertex $v$ and an edge $e$ will be called \emph{appropriate} (for each other) if $v\in v(e)$, and \emph{inappropriate} otherwise.
%
This notion is extended to vertex-gadgets $\itn v$ and edge-gadgets $\itn e$ in $\itn G$, and their respective constraint elements and weight elements.



A configuration $\gamma$ for a constraint graph $G$ will be encoded as a proof net for the sequent $\itn G$.
%
Firstly we will define a standard way of linking a weight element to a constraint element.

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
\begin{definition}
\label{def:standard linkings}
For a weight element $W=W_n(i,j)=A\parr B\parr C$,
\begin{enumerate}
	\item
for a constraint element $C=C_n(i)=X\tn Y$, the \emph{standard linking} for the sequent $W,C$ links the first $\bot$ in $A$ to the first $\1$ in $X$, the first $\bot$ in $B$ and $C$ each to the first $\1$ in $Y$, and each remaining $\bot$ in $A,B,C$ to a remaining $\1$ in $X,Y$ in their order of occurrence;
	\item
for $C=C_n(j)=X\tn Y$, the \emph{standard linking} for $W,C$ is defined as above, except the first $\bot$ in $B$ links to the first $\1$ in $X$;
	\item
the \emph{standard linking} for the sequent $W,\1^{3n+4}$ links the first $\bot$ in $A$, $B$, and $C$ to the first $\1$, and each remaining $\bot$ to a remaining $\1$ in order of occurrence.
\end{enumerate}
\end{definition}

The standard linkings defined in the first and third case of the above definition are illustrated below.

\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[circ] (1) at (-.25,0) {};
	\node[big1] (2) at (1,0) {};
	\node[big1] (3) at (2.5,0) {};
	\node[big1] (4) at (5.5,0) {};
	\draw[rounded corners] (-1,-1) rectangle (3.5,1) (4.5,-1) rectangle (6.5,1);
	\draw (3.5,0)--(4.5,0);
	%
	\draw (-.25,4) node[bullet] (a) {} -- (.75,4) node[big_] (A) {};
	\draw (2.25,4) node[bullet] (b) {} -- (3.25,4) node[big_] (B) {};
	\node[big_] (C) at (5.5,4) {};
	\draw[rounded corners] (-1,3) rectangle (6.5,5);
	%
	\begin{scope}[thepink,->]
		\draw[bend right=5] (a) to (1);
		\draw[bend right=10] (b) to (1);
		\draw[big>,bend left=25] (A) to (2);
		\draw[big>,bend left=20] (B) to (3);
		\draw[big>,bend left=15] (C) to (4);
	\end{scope}
\end{tikzpicture}
\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[circ] (1) at (.75,0) {};
	\node[big1] (2) at (2,0) {};
	\node[big1] (3) at (3.5,0) {};
	\node[big1] (4) at (5,0) {};
	%
	\draw ( 0  ,4) node[bullet] (a) {} -- ( 1  ,4) node[big_] (A) {};
	\draw ( 2.5,4) node[bullet] (b) {} -- ( 3.5,4) node[big_] (B) {};
	\draw ( 5  ,4) node[bullet] (c) {} -- ( 6  ,4) node[big_] (C) {};
	\draw[rounded corners] (-.5,3) rectangle (7,5);
	\path (0,-1) -- (1,-1);
	%
	\begin{scope}[thepink,->]
		\draw[bend right=5] (a) to (1);
		\draw[bend right=10] (b) to (1);
		\draw[bend right=15] (c) to (1);
		\draw[big>,bend left=25] (A) to (2);
		\draw[big>,bend left=20] (B) to (3);
		\draw[big>,bend left=15] (C) to (4);
	\end{scope}
\end{tikzpicture}
\]

\begin{proposition}
\label{prop:element linkings}
The standard linkings of Definition~\ref{def:standard linkings} are proof nets.
\end{proposition}


The encoding of a configuration is then as follows.



\begin{definition}
\label{def:configuration encoding}
The \emph{encoding} $\itn\gamma$ of a total configuration $\gamma$ for a constraint graph $G$ is a linking $\links$ for $\itn G$, constructed incrementally for each successive edge $e$ and for each successive weight element $W$ within $e$, as follows.
%
Let $\gamma(e)=v$; firstly, the indicator of $\itn e$ is linked to the indicator target of $\itn v$.
%
Then successively for each weight element $W$ in $e$, if $\itn v$ has a first free constraint element $C$, extend $\itn\gamma$ to include the standard linking on $W,C$; otherwise, extend $\itn\gamma$ by the standard linking on the sequent consisting of $W$ plus the first $3n+4$ free weight absorbers.
\end{definition}



\begin{proposition}
If $\gamma$ is a total configuration for $G$ then $\itn\gamma$ is a proof net for $\itn G$.
\end{proposition}

\begin{IEEEproof}
Using Proposition~\ref{prop:scoping correctness}, it is sufficient to give a suitable scope for each $\parr$. 
%
The scope of each weight element $W$ is the sequent $W,C$ or $W,1^{3n+4}$ of its standard linking, which forms a proof net by Proposition~\ref{prop:element linkings}.
%
The scope of each vertex-gadget $\itn v$ contains the edge-gadgets $\itn e$ such that $\gamma(e)=v$, plus all the weight absorbers within scopes of weight elements inside $\itn e$.
%
Since the weights of the connected edges $e$ sum to more than the inflow constraint of $v$, there are no unused constraint elements remaining in $\itn v$.
%
After contracting the scope of each $W$, each edge-gadget in the scope of $\itn v$ becomes a single string of connected vertices, connected to other edge-gadgets only via the indicator target of $\itn v$, thus forming a tree.
\end{IEEEproof}



%------------------------------------------------------------

\beforesection

\section{Correctness of the encoding}

\aftersection
%
In this section we will establish that in our encoding of constraint graphs %partial \capsabbrev{ncg}-reconfiguration 
in \capsabbrev{mll}, reconfiguration on graphs is captured by proof equivalence in \capsabbrev{mll}.
%
Up to minor technical details, it will be shown that $\itn\gamma\perm\itn\delta$ if and only if $\gamma\perm\delta$, in two parts: completeness ($\Leftarrow$) and soundness ($\Rightarrow$).



% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Completeness}

Given a reconfiguration path $\gamma\perm\delta$ over total configurations, we will demonstrate a rewiring sequence between $\itn\gamma$ and $\itn\delta$ up to, possibly, a single exchange of two links in $\itn\delta$.
%
The central part of the argument will be to show how the weight element linking to a constraint element may be exchanged for another.
%
Once the weight elements of an edge-gadget are no longer connected to any constraint elements, the edge-gadget may straightforwardly be moved from one vertex-gadget to another by re-attaching its indicator link.
%
Throughout the rewiring process, weight elements and constraint elements will be kept in a standard linking, and according to the connectivity specified by the target configuration $\itn\delta$.
%
Linkings between weight elements and weight absorbers will remain arbitrary, and will be re-adjusted to match $\itn\delta$ at the end of the process.



In a proof net for $\itn G$, an edge-gadget $\itn e$ is \emph{well linked} if: 1) its indicator connects to the indicator target of an appropriate vertex-gadget $\itn v$, and 2) each weight element is either in a standard linking with a constraint element of $\itn v$, or linked only to weight absorbers.
%
A well-linked edge-gadget is \emph{free} if all its weight elements connect to weight absorbers.
%
In the following main lemma we will exchange the weight element linking to a constraint element.
%
The lemma considers a sequent consisting of just a vertex-gadget, some appropriate edge-gadgets, and sufficiently many weight absorbers.


\begin{lemma}
\label{lem:octopus roll}
In a proof net $\links$ for a sequent $\Gamma=\itn v,\itn{e_1},\dotsc,\itn{e_m},\bot^p$ where each edge-gadget is well linked, if a weight element $W_i$ in $\itn{e_i}$ is linked to $C$ in $\itn v$ and $W_j$ in $\itn{e_j}$ is linked to weight absorbers $\bot^n$, then there is a net $\links'\perm\links$ in which $W_j$ is naturally linked to $C$, $W_i$ is linked to $\bot^n$, and $\links'$ agrees with $\links$ otherwise.
\end{lemma}


\renewcommand\scalefactor{0.88}

\newcommand\displayOcto[1]{%
 \NoIndent{%
   \smallskip%
   \centerline{%
	 \scale{#1}%
  }}%
  \bigskip%
}


\begin{IEEEproof}
Let $W_i=A\parr B\parr C$, $W_j=D\parr E\parr F$, and $C=X\tn Y$.
%
The path of rewirings will be illustrated for the case where $A,B,X$ and $D,X$, and thus also $C,Y$ and $E,F,Y$, are balanced sequents; other cases are similar.
%
\begin{enumerate}
	\item
The initial configuration is illustrated below. 
%
Other edges, other weight and constraint elements, and the outer box of the vertex-gadget, are omitted.
%
The vertices $i$, $j$, and  $v$ are the indicators of $\itn{e_i}$ and $\itn{e_j}$ and the indicator target of $\itn v$, respectively.
%
\displayOcto{\octorollA1}


	\item
The link $i-v$ is re-attached to connect to a weight absorber together with only the links from the first $\bot$ of each of $D$, $E$, and $F$. 
%
\displayOcto{\octorollB2}


	\item
Secondly, the link from the first $\bot$ of $D$ is moved to $X$, and those from the first $\bot$ of $E$ and $F$ are moved to $Y$.
%
\displayOcto{\octorollB3}


	\item\label{item:exchange added}
In the present configuration, the links from the weight elements form two subnets: one over the sub-sequents $A,B,X,D,\bot^m$, and one over the sub-sequent $C,Y,E,F,\bot^k$, for some $m$ and $k$.
%
By Proposition~\ref{prop:parity determines equivalence}, these subnets are equivalent to any other over the same sequent, as long as their parity is preserved.
%
It is then sufficient to choose linkings so that $D\parr E\parr F$ is in a a standard linking with $X\tn Y$, with a minor adjustment: two links from $C$ to $X$ should remain exchanged, compared to the standard linking, for step \ref{item:exchange needed} below.
%
The links of $A,B,C$ link to the weight absorbers $\bot^m$ and $\bot^k$, with one remaining link from $B$ to $X$ and one from $C$ to $Y$.
%
\displayOcto{\octorollC}


	\item
The link from $C$ to $Y$ is moved towards a weight absorber connected to $A,B$.
%
\displayOcto{\octorollD1}


	\item\label{item:exchange needed}
The link from $B$ to $X$ is the one remaining connection between the edge-gadgets $\itn{e_i}$ and $\itn{e_j}$.
%
Lemma~\ref{lem:double exchange} allows to swap the targets of the link from $B$ to $X$ and the link from $i$, and simultaneously undo the exchange in the links from $C$ to $X$ added in step \ref{item:exchange added} above.
%
\displayOcto{\octorollD2}


	\item
The link from $i$ is re-attached to $v$ to yield the final configuration.
%
\displayOcto{\octorollA2\IEEEQEDhere}
\end{enumerate}
\end{IEEEproof}



In the exchange of weight elements in the above lemma, weight elements link to weight absorbers in arbitrary fashion.
%
The next lemma will demonstrate how weight absorbers can be exchanged freely, but only with two exchanges at once. 



\begin{lemma}
\label{lem:permute weight absorbers}
If $\links$ is a well linked proof net for $\itn G$ with a free edge-gadget $\itn e$, and $\links'$ agrees with $\links$ up to an even permutation of weight absorbers, then $\links\perm\links'$.
\end{lemma}

\begin{IEEEproof}
Let $e_0$ be the indicator of $\itn e$; since $\itn e$ is free, $e_0$ may re-attach anywhere within the proof net.
%
Let $e_1$ and $e_2$ be arbitrary other $\bot$-occurrences in $\itn e$.

\begin{enumerate}

	\item
To exchange two weight absorbers $v$ and $w$ linked to by other edge-gadgets than $\itn e$, attach $e_0$ to $v$, and apply Lemma~\ref{lem:double exchange} to exchange $v$ and $w$ while also exchanging the targets of $e_0$ and $e_1$.

	\item
To reinstate $e_0$ as the connection between $\itn e$ and the remainder of the proof net, either perform another exchange as above, or exchange $v$ and $w$ twice again, once exchanging also the targets of $e_1$ and $e_2$, and once exchanging also the targets of $e_2$ and $e_0$.

	\item
To exchange a weight absorber $w$ linked from a $\named d\bot$ outside $\itn e$ for the target $v$ of $e_1$, first attach $e_0$ to $w$, then re-attach $d$ to $v$.
%
At this point, $e_1$ forms the only connect between $\itn e$ and the remainder of the proof net; to reinstate $e_0$ in this role, do as above, producing a net effect of cycling the targets of $e_1$, $e_2$, and $d$.

	\item
Finally, to exchange weight absorbers $v$ and $w$ linked by $\itn e$, attach $e_0$ to the indicator target of a vertex-gadget where also another edge-gadget $\itn d$ is connected, with indicator $d_0$ and an arbitrary other $\bot$-occurrence $d_1$.
%
Connect $d_0$ to $v$, and apply Lemma~\ref{lem:double exchange} to exchange $v$ and $w$, as well as exchanging the targets of $d_0$ and $d_1$.
%
A second such exchange is needed to re-attach $d_0$ and $d_1$ to their original targets.

\end{enumerate}

In each case, if one of the weight absorbers exchanged is linked to by multiple $\bot$-occurrences within the same weight element, these may be temporarily attached elsewhere.
%
\end{IEEEproof}



If two connected configurations $\gamma\perm\delta$ are encoded individually as $\itn\gamma$ and $\itn\delta$, these may not be equivalent simply because their parity happens to be odd.
%
For that reason we shall adjust the encoding of the second to guarantee an even parity between them.

\begin{definition}
%
Let $\itn\delta'$ be $\itn\delta$ with the first two weight absorbers exchanged.
%
For configurations $\gamma$ and $\delta$ for $G$, let $\itn\delta_\gamma$ be $\itn\delta$ if it has even parity with $\itn\gamma$, and $\itn\delta'$ otherwise.
%
\end{definition}



\begin{lemma}
\label{lem:completeness}
If $\gamma\perm\delta$ for total configurations $\gamma$ and $\delta$, then $\itn\gamma\perm\itn\delta_\gamma$.
\end{lemma}

\begin{IEEEproof}
By Proposition~\ref{prop:partial simulates total reconfiguration} we may assume that $\gamma\perm\delta$ by a sequence of reconfiguration steps over total configurations.
%
We will prove that if $\gamma\perm*\delta$ then $\itn\gamma\perm\itn\delta$ or $\itn\gamma\perm\itn\delta'$.
%
The same proof will show the corresponding case for $\itn\gamma'$ instead of $\itn\gamma$, so that the general case for $\gamma\perm\delta$ follows by transitivity.



Let $\gamma$ and $\delta$ agree on every edge except $e$, where $\gamma(e)=v$ and $\delta(e)=w$.
%
Firstly, using Lemma~\ref{lem:octopus roll}, for the edges $d$ other than $e$ such that $\gamma(d)=v$, the weight elements of the edge-gadgets $\itn d$ may be linked to the constraint elements of $\itn v$, in accordance with the target configuration $\itn\delta$.
%
Since $e$ is mobile in $\gamma$, the weights of the edges $d$ suffice to fill the inflow constraint of $v$, and correspondingly the weight elements of edge-gadgets $\itn d$ suffice to fill the constraint elements of $\itn v$, so that $\itn e$ is free.
%
Next, the indicator vertex of $\itn e$, which links to the indicator target of $\itn v$, is re-attached to the indicator target of $\itn w$.
%
Again using Lemma~\ref{lem:octopus roll}, the weight elements of edge-gadgets connected to $\itn w$, including $\itn e$, may be linked in accordance with $\itn\delta$.
%
The resulting proof net is $\itn\delta$ modulo a permutation of weight absorbers; then it is equivalent to either $\itn\delta$ or $\itn\delta'$ by Lemma~\ref{lem:permute weight absorbers}.
\end{IEEEproof}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Soundness}


It will be shown that proof net rewiring $\itn\gamma\perm\itn\delta$ is sound for \capsabbrev{ncg}-reconfiguration, $\gamma\perm\delta$.
%
To each proof net $\links$ for an encoded constraint graph $\itn G$ we will associate a partial configuration $\gamma=\coitn\links$, such that 1) a rewiring step $\links\perm*\links$ corresponds to a reconfiguration path $\coitn\links\perm\coitn{\links'}$, and 2) it is a retraction of the encoding of configurations, $\coitn{\itn\gamma}=\gamma$.



The configuration $\coitn\links$ will assign an edge $e$ to a vertex $v$ when, in the proof net $(\links,\itn G)$, the edge-gadget $\itn e$ is in the empire of the vertex-gadget $\itn v$.
%
Firstly, it will be shown that $\coitn\links$ is a partial function.


\begin{proposition}[{\cite[Proposition 1.i]{Bellin-vandeWiele-1995}}]
\label{prop:tensor has disjoint subnets}
In a proof net, if vertices $v$ and $w$ are joined by a tensor, then any two subnets of which they are respective ports are disjoint.
\end{proposition}


\begin{lemma}
In a proof net for $\itn G$, an edge-gadget $\itn e$ belongs to the empire of at most one vertex-gadget $\itn v$.
\end{lemma}

\begin{IEEEproof}
Since vertex-gadgets are joined by a tensor, the lemma is immediate from Proposition~\ref{prop:tensor has disjoint subnets}.
\end{IEEEproof}


Next, it will be shown that the appropriate edge-gadgets in the empire of a vertex-gadget $\itn v$ contain sufficient weight elements to fill the constraint elements of $\itn v$.


\begin{lemma}
\label{lem:appropriate edge weights}
In a proof net for $\itn G$, for each node $v$ in $G$, the weights of the appropriate edge-gadgets in the empire of $\itn v$ are equal to or greater than the constraint of $v$.
\end{lemma}


\begin{IEEEproof}
Let $|V|=n$ and $|E|=m$, and consider the vertex $v_i$ and an edge $e$ connecting vertices $v_a$ and $v_b$ where $i\neq a,b$.
%
Each constraint element in $\itn{v_i}$ is an instance of the formula
\[
	C = \bigparr\big(1^{3i+2}\big) \tn \bigparr\big(1^{3(n-i)+3}\big)~.
\]
The two $\parr$-subformulae have a balance of $-3i-1$ and respectively $-3(n-i)-2$.
%
Each weight element in $\itn{e}$ is an instance of 
\[
	W = \bigtn\big(\bot^{3a+2}\big)\parr\bigtn\big(\bot^{3(b-a)+1}\big)\parr\bigtn\big(\bot^{3(n-b)+3}\big)~.
\]
For each of the three $\tn$-subformulae, adding it to the scope of a $\parr$ will change its balance by $3a+1$, $3(b-a)$, and $3(n-b)+2$ respectively.
%
In pairs, they add to the balance of a scope by $3b+1$ (1st and 2nd subformula), $3(a+n-b)+3$ (1st and 3rd), and $3(n-a)+2$ (2nd and 3rd).
%
Since $i\neq a,b$, and since no $\tn$-subformula of $W$ can connect to more than one $\parr$-subformula of $C$ (by Proposition~\ref{prop:tensor has disjoint subnets}), it follows that $W$ can balance the scope of at most one of both $\parr$-subformulae of $C$.


The vertex-gadget $\itn{v_i}$ is the formula
\[
	\itn{v_i} = \bigparr\big(C^{m\times c(v_i)} \big)\parr 1~.
\]
It will be shown that $m$ inappropriate edge-gadgets may balance at most $m-1$ constraint elements $C$.


Let the root nodes of the two $\parr$-subformulae of each instance of $C$ be labelled $x_j$ and $y_j$, for $1\leq j\leq m\times c(v_i)$. 
%
If the scopes $s(x_j)$ and $s(y_m)$ of any $x_j$ and $y_m$ are balanced by weight elements $W$ and $W'$ of the same edge-gadget $\itn e$, then since $W$ and $W'$ are connected by a tensor, there are switchings of $W$, $W'$, $s(x_j)$, and $s(y_m)$ such that $x_j$ and $y_m$ are connected in the proof net for $\itn G$.
%
Then the first constraint element of $\itn{v_i}$ requires 2 edge-gadgets to balance, and each successive element requires one additional edge-gadget.
\end{IEEEproof}



Using the above, a proof net for $\itn G$ may be interpreted as a configuration for $G$.



\begin{definition}
For a proof net $\links$ for $\itn G$, let $\coitn\links$ be the partial configuration for $G$ where $\coitn\links(e)$ is $v$ if 1) $e$ is appropriate for $v$ and 2) $\itn e$ belongs to the empire of $\itn v$, and undefined otherwise.
\end{definition}


The following lemma then shows that rewiring corresponds to reconfiguration under $\coitn-$.



\begin{lemma}
\label{lem:soundness}
If $\links\perm\links'$ are proof nets for $\itn G$ then $\coitn\links\perm\coitn{\links'}$.
\end{lemma}

\begin{IEEEproof}
The proof will consider the case where $\links\perm*\links'$; the general case follows by transitivity.
%
By Lemma~\ref{lem:rewiring affects empires}, the empire of each vertex-gadget $\itn v$ contains either a subset of, a superset of, or exactly the same edge-gadgets in $\links'$ as it does in $\links$.
%
Let $\itn e_1$ through $\itn e_n$ be the edge-gadgets moving in or out of the empire of $\itn v$.
%
By Lemma~\ref{lem:appropriate edge weights} other edge-gadgets must fill the constraint elements of $\itn v$.
%
Then the corresponding edges $e_1$ through $e_n$ are mobile in $\coitn\links$.
%
It follows that $\coitn\links\perm\coitn{\links'}$ by moving each $e_i$ in turn, and repeating the process for other vertices.
%
\end{IEEEproof}


%------------------------------------------------------------

\beforesection

\section{\capsabbrev{mll} proof equivalence is \capsabbrev{pspace}-complete}

\aftersection
%
We are now ready to state our main theorem.


\begin{theorem}
\capsabbrev{mll} proof equivalence is \capsabbrev{pspace}-complete.
\end{theorem}

\begin{IEEEproof}
\capsabbrev{mll} proof equivalence has at most non-deterministic polynomial space complexity: a proof net may be represented in linear space (with respect to a proof); a single rewiring step is performed without requiring additional space; and a non-deterministic algorithm may guess the correct rewiring sequence.
%
Then by Savitch's Theorem \cite{Savitch-1970} \capsabbrev{mll} proof equivalence is in \capsabbrev{pspace}.


\capsabbrev{pspace}-hardness follows by the encoding of \capsabbrev{ncg}-reconfiguration, which in its completed form is stated:
\[
	\gamma\perm\delta \qquad\iff\qquad \itn\gamma\perm\itn\delta_\gamma~.
\]
%
The direction $(\Rightarrow)$ is by Lemma~\ref{lem:completeness}; the direction $(\Leftarrow)$ is by Lemma~\ref{lem:soundness} and the observation that $\coitn{\itn\gamma}=\gamma$ and $\coitn{\itn\delta_\gamma}=\delta$.
%
\end{IEEEproof}



%===========================
\bibliographystyle{plain}
\bibliography{../refs}
\end{document}
%===========================


\end{document}
