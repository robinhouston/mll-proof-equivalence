\documentclass[conference]{IEEEtran}

\usepackage{amssymb,amsthm,amsmath}
\usepackage{microtype}
%\usepackage{enumitem}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{mathtools}

% Sorts citations; e.g. [1], [2], [5]--[7]
%\usepackage{cite}

% More reference handling options
%\usepackage{natbib}\renewcommand\bibfont{\footnotesize}

\usepackage{mllequiv,willemtools}

\graphicspath{{../notes/}}

\shortJournalNames
\makeTheoremDefs


\author{
  \IEEEauthorblockN{Willem Heijltjes}
  \IEEEauthorblockA{
  		University of Bath
	\\	Claverton Down
	\\	Bath BA2~7AY
	\\	w.b.heijltjes@bath.ac.uk
	}
\and
  \IEEEauthorblockN{Robin Houston}
  \IEEEauthorblockA{
		Kiln Enterprises
	\\	robin.houston@gmail.com	
	}
}

%\title{The proof equivalence problem for multiplicative linear logic is \textsc{pspace}-complete}

%\title{Proof equivalence in MLL is \textsc{pspace}-complete}

\title{No proof nets for MLL with units\\[5pt]\Large Proof equivalence in MLL is \textsc{pspace}-complete}

%============================================================

\begin{document}

\maketitle

\begin{abstract}
MLL proof equivalence is the problem of deciding whether two proofs in multiplicative linear logic are related by a series of inference permutations.
%
It is also known as the word problem for $*$-autonomous categories.
%
Previous work has shown the problem to be equivalent to a rewiring problem on proof nets, which are not canonical for full MLL due to the presence of the two units.
%
Drawing from recent work on reconfiguration problems, in this paper it is shown that MLL proof equivalence is PSPACE-complete, using a reduction from Nondeterministic Constraint Logic.
%
An important consequence of the result is that the existence of a satisfactory notion of proof nets for MLL with units is ruled out (under current complexity assumptions).
\end{abstract}


%------------------------------------------------------------

\section{Introduction}


%% STILL TO ADD:
%% - MLL proof equivalence is the word problem for *-autonomous categories
%% - IMLL proof equivalence is polynomial-time


An important element of the theory of linear logic \cite{Girard-1987} is the idea that proofs should be considered modulo the permutation of inferences.
%; that the chosen order of permutable inferences is inessential, or `bureaucracy'.
%contributes no essential proof content, and should be considered `bureaucracy'.
%
%The idea is supported by the categorical semantics of linear logic, in which proofs up to permutations denote the same morphism. 
%
\emph{Proof equivalence} is the problem of deciding whether two proofs are equal modulo permutations.


The proof equivalence problem is closely related to the notion of \emph{proof nets}.
%
These are canonical, geometric representations of proof that factor out permutations, so that proofs are equivalent if and only if they have the same underlying proof net.
%
Canonical proof nets have been found for several fragments of linear logic: the multipicative fragment without units \cite{Girard-1987,Danos-Regnier-1989}, the combined multiplicative-additive fragment without units \cite{Hughes-vanGlabbeek-2005}, and the additive fragment, including the additive units \cite{Heijltjes-2011}.
%
For the full multiplicative fragment, with units, several notions of proof net have been proposed \cite{BCST,Strassburger-lamarche-2004,HughesFreeStar}.
%
However, none is canonical, and whether a satisfactory notion of proof net can be found has remained an open question.



In this paper we establish that the proof equivalence problem for multiplicative linear logic with units is \textsc{pspace}-complete.
%
As a main corrolary, this effectively rules out the possibility of finding a satisfactory notion of proof net for this fragment.


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Constraint logic and reconfiguration problems}

The proof of the \textsc{pspace}-completeness result relies on a polynomial reduction from %the configuration--to--configuration problem in
\emph{constraint logic}, a graphical formalism recently introduced as a uniform tool for use in complexity reductions \cite{Demaine-Hearn-2008}.
%
It consists of a simple graph rewriting mechanism, where weighted edges may be reversed as long as the given in-flow constraint for each vertex is satisfied, and asks whether two graphs are related in a series of valid rewriting steps.



Constraint logic belongs to a class of problems called \emph{reconfiguration problems} \cite{ReconfigurationProblems}: can one solution to a given problem be transformed into another by a series of elementary changes, while remaining valid throughout?
%
For example, for boolean satisfyability (SAT) the reconfiguration problem asks whether one satisfying assignment can be transformed into another by changing the value of one atomic formula at a time, without passing via a non-satisfying assignment.
%
It is not uncommon for an \textsc{np}-complete problem to have an associated reconfiguration problem that is \textsc{pspace}-complete \cite{ReconfigurationProblems}; one example is SAT-reconfiguration, which is \textsc{pspace}-complete.



MLL proof equivalence may be usefully classified as the reconfiguration problem associated with MLL proof search, which is \textsc{np}-complete \cite{Kanovich-1992}.




%------------------------------------------------------------

\section{MLL}



\begin{figure}[!b]
\quad\MLLrule b
\hfill\MLLrule 1
\hfill\MLLrule p
\hfill\MLLrule t
\quad
\caption{Inference rules for unit-only \MLL}
\label{fig:MLL}
\end{figure}


\begin{figure}[!tb]
\renewcommand\scalefactor{0.88}
\[
\begin{array}{@{}rcl@{}}
	\multicolumn{3}{@{}c@{}}{
		\vc{\scale{\MLLperm{bb1}}} ~\perm~ \vc{\scale{\MLLperm{bb2}}}
		\hfill
		\vc{\scale{\MLLperm{bp1}}} ~\perm~ \vc{\scale{\MLLperm{bp2}}}
	}
\\ \\[6pt]
	\multicolumn{3}{@{}c@{}}{
		\vc{\scale{\MLLperm{bt2}}} ~\perm~ \vc{\scale{\MLLperm{bt1}}}
								   ~\perm~ \vc{\scale{\MLLperm{bt3}}}
	}
\\ \\[6pt]
	\vc{\scale{\MLLperm{pp1}}} &\perm& \vc{\scale{\MLLperm{pp2}}}
\\ \\[6pt]
	\vc{\scale{\MLLperm{pt1}}} &\perm& \vc{\scale{\MLLperm{pt2}}}
\\ \\[6pt]
	\vc{\scale{\MLLperm{tt1}}} &\perm& \vc{\scale{\MLLperm{tt2}}}
\end{array}
\]
\caption{Permutations}
\label{fig:permutations}
\end{figure}





The formulae of unit-only multiplicative linear logic are given by the following grammar.
%
\setMidspace{5pt}
\[
	A,B,C \Coloneq \bot \Mid 1 \Mid A\parr B \Mid A\tn B
\]
%
The connectives $\tn$ and $\parr$ will be considered up to associativity, and \emph{duality} $\dual A$ is via DeMorgan.
%
A \emph{sequent} $\Gamma,\Delta$ will be a multiset of formulae.
%
Within a sequent, connectives and units will be \emph{named} with distinct elements from an arbitrary set of names, e.g.\
$\named a1\named b\parr\named c1,\named d\bot\named e\tn\named f\bot$.
%
This allows to 1) identify \emph{occurrences} of subformulae uniquely by the name of their root connective, e.g.\ as $\named bA$, 2) distinguish the two proofs of the above sequent while using standard multiset sequents, and 3) easily extract proof nets, as graphs using the names of connectives as vertices.
%
Names will mostly be left implicit.



Proofs are constructed from the inference rules in Figure~\ref{fig:MLL}, where the names of units and connectives are preserved through inferences.
%
Only cut-free proofs are considered, and no cut-rule is added.
%
\emph{Permutations} of inference rules are displayed in Figure~\ref{fig:permutations}; the symmetric variants of the last two permutations, \emph{par-tensor} and \emph{tensor-tensor}, have been omitted.



\begin{definition}
\label{def:equivalence}
%
\emph{Equivalence} of proofs $(\perm)$ in (cut-free, unit-only) multiplicative linear logic is the congruence generated by the permutations given in Figure~\ref{fig:permutations}.
%
\emph{\MLL\ proof equivalence} is the problem of deciding whether two given proofs are equivalent.
%
\end{definition}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Proof nets}

Proof nets provide a solution to proof equivalence for MLL$^-$ (MLL without units).
%
For full MLL, they reduce the proof equivalence problem to a simple rewiring relation \cite{HughesMLLProofNets}.


\begin{definition}
\label{def:proof nets}
%
For a sequent $\Gamma$,
\begin{itemize}

	\item
	a \emph{linking} $\links$ is a function from the names of $\bot$-subformulae to the names of $1$-subformulae,

	\item
	a \emph{switching graph} for $\links$ is an undirected graph over the names of $\Gamma$, with for every subformula $\named aA\named c\tn\named bB$ the edges $\edge ac$ and $\edge bc$, for every subformula $\named aA\named c\parr\named bB$ either the edge $\edge ac$ or the edge $\edge bc$, and for every subformula $\named a\bot$ the edge $\edge a{\links(a)}$,

 	\item
	a \emph{proof net} $\links$ or $(\Gamma,\links)$ is a linking $\links$ such that every switching graph is acyclic and connected.

\end{itemize}
\end{definition}


\noindent
An edge $\edge a{\links(a)}$ in a proof net or switching graph is called a \emph{link} or a \emph{jump}.



\begin{definition}
\label{def:proof net equivalence}
%
A \emph{permutation} $(\perm*)$ between proof nets is the redirection of exactly one link.
%
\emph{Equivalence} $(\perm)$ of proof nets over a sequent $\Gamma$ is the equivalence generated by permutations.
%
\end{definition}


\noindent
In the sequent calculus, the introduction rule for $\bot$ joins a $\bot$-formula to a sequent $\Gamma$, rather than an occurrence of $\1$.
%
The interpretation of a proof as a proof net may attach the corresponding link to an arbitrary $\1$ in $\Gamma$.


\begin{definition}
\label{def:proofs to nets}
%
The relation $(\toNet)$ interprets a proof $\Pi$ for a sequent $\Delta$ by a linking $\links$ as follows:
% 
$\Pi\toNet\links$ if for each $\named a\bot$ in $\Delta$, if $\Gamma$ is the context of the inference introducing $\named a\bot$, as illustrated below, then $\links(a)$ is the name of some $1$ in $\Gamma$.
\[
	\infer[\MLLlabel b]{\Gamma,\named a\bot}{\Gamma}
\]
%
\end{definition}



\begin{proposition}[\cite{Danos-Regnier-1989}]
\label{prop:correctness and sequentialisation}
%
For a proof $\Pi$ with conclusion $\Gamma$, if $\Pi\toNet\links$ then $\links$ is a proof net for $\Gamma$.
%
For a net $\links$ for $\Gamma$, there is a proof $\Pi$ of $\Gamma$ such that $\Pi\toNet\links$ (\emph{sequentialisation}).
%
\end{proposition}


\noindent
Proof nets are canonical representations of proofs in the absence of units: they factor out the permutations among tensor- and par-inferences, which are the last three permutations in Figure~\ref{fig:permutations}.
%
Equivalence of proof nets is generated by the four remaining permutations, on $\bot$-introduction.



\begin{proposition}[\cite{HughesMLLProofNets}] %[\citeauthor{HughesMLLProofNets}, \citeyear{HughesMLLProofNets}]
\label{prop:proof nets work}
%
For proofs $\Pi$, $\Pi'$ and proof nets $\links$, $\links'$ such that $\Pi\toNet\links$ and $\Pi'\toNet\links'$, $\Pi\perm\Pi'$ if and only if $\links\perm\links'$.
%
\end{proposition}


\noindent
The above proposition means that \MLL\ proof equivalence is the problem of deciding equivalence of proof nets.
%
% We will use proof net equivalence to encode constraint logic.


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Notation}


We will use a concise diagrammatic notation for sequents and proof nets.
%
The units $1$ and $\bot$ are represented by a circle $\circ$ and a disc $\bullet$ respectively;
%
formulae related by a tensor will be connected by edges; 
and
formulae related by a par will be juxtaposed, and collected in a box when a par-formula is an immediate subformula of a tensor-formula.
%
For example, the following denote the same sequent:
\[
	\bot\tn\bot,\bot\tn\bot,\1,(\1\parr\1\parr\1)\tn\bot
\]
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (0,0) node[bullet] (a) {} -- (1,0) node[bullet] (b) {} (2,0) node[bullet] (c) {} -- (3,0) node[bullet] (d) {};
	\node[circ] (1) at (4,0) {};
	\node[circ] (2) at (5.25,0) {}; \node[circ] (3) at (6.25,0) {}; \node[circ] (4) at (7.25,0) {};
	\draw[rounded corners] (4.75,-1) rectangle (7.75,1);
	\draw (7.75,0) -- (8.75,0) node[bullet] (e) {};
\end{tikzpicture}
\]
The links of a proof net are added to the sequent as colored arrows.
%
The following example is a proof net for the above sequent.
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\node[circ] (1) at (6,0) {};
	\draw (0,0) node[bullet] (a) {} -- (1,0) node[bullet] (b) {} (3,0) node[bullet] (c) {} -- (4,0) node[bullet] (d) {};
	\node[circ] (2) at (1,3) {}; \node[circ] (3) at (2,3) {}; \node[circ] (4) at (3,3) {};
	\draw[rounded corners] (0,2) rectangle (4,4);
	\draw (4,3) -- (5,3) node[bullet] (e) {};
	\begin{scope}[thepink,->]
			\draw[bend right=10] (a) to (2.center);
			\draw[bend right=10] (b) to (3.center);
			\draw[bend left=10]  (c) to (3.center);
			\draw[bend left=10]  (d) to (4.center);
			\draw[bend right=10] (e) to (1.center);
	\end{scope}
\end{tikzpicture}
\]


We will denote by $A^n$ the sequent consisting of $n$ occurrences of a formula $A$.
%
Given a sequent $\Gamma=A_1,\dotsc,A_n$ we will write $\bigtn\Gamma$ for $A_1\tn\cdots\tn A_n$, and $\bigparr\Gamma$ for $A_1\parr\cdots\parr A_n$.
%
In diagrammatic notation, a big disc will represent an $n$-ary tensor over only $\bot$-formulae, $\bigtn(\bot^n)$, and a big circle will represent an $n$-ary par over only $1$-formulae, $\bigparr(\1^n)$.
%
A linking between $\bigtn(\bot^n)$ and $\bigparr(\1^n)$ will be represented by a wide arrow, as illustrated below.
\[
\begin{tikzpicture}[x=-5mm,y=5mm,octo]
	\node[big_] (A) at (-1,2) {};
	\node[big1] (!) at (-1,0) {};
	\node at (.5,1) {$\Rightarrow$};
	\draw (2,2) node[bullet] (a) {} -- (3,2) node[bullet] (b) {} -- (4,2) (5,2) -- (6,2) node[bullet] (c) {}; 
	\node[circ] (1) at (2,0) {}; \node[circ] (2) at (3,0) {}; \node[circ] (3) at (6,0) {};
	\draw[dotted] (4,2)--(5,2) (4,0)--(5.1,0);
	\begin{scope}[thepink,->]
			\draw[big>] (A) to (!.center);
			\draw[bend right=10] (a) to (1.center);
			\draw[bend right=10] (b) to (2.center);
			\draw[bend right=10] (c) to (3.center);
	\end{scope}
\end{tikzpicture}
\]
Two formulae $\bigtn(\bot^{i+1})$ and $\bigtn(\bot^{j+1})$ may together connect to a formula $\bigparr(\1^{i+j+1})$, as illustrated below for $i=2$ and $j=3$.
%
Nodes will be labelled $i'$ for $i+1$, so that both the abbreviated formulae and the arithmetic of connecting them remain intuitive.
%
\[
\vc{
  \begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (0,0) node[bullet] (a) {}--
		  (1,0) node[bullet] (b) {}--
		  (2,0) node[bullet] (c) {};
	\draw (4,0) node[bullet] (d) {}--
		  (5,0) node[bullet] (e) {}--
		  (6,0) node[bullet] (f) {}--
		  (7,0) node[bullet] (g) {};
	\foreach \i in {1,...,6} {\node[circ] (\i) at (\i,3) {};}
	\begin{scope}[thepink,->]
			\draw[bend right=10] (a) to (1);
			\draw[bend right=10] (b) to (2);
			\draw[bend right=10] (c) to (3);
			\draw[bend left=10]  (d) to (3);
			\draw[bend left=10]  (e) to (4);
			\draw[bend left=10]  (f) to (5);
			\draw[bend left=10]  (g) to (6);
	\end{scope}
  \end{tikzpicture}
}
\quad\Rightarrow\quad
\vc{
  \begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\node[big_] (A) at (-1,0) {$2'$};
	\node[big_] (B) at ( 1,0) {$3'$};
	\node[big1] (!) at ( 0,3) {$5'$};
	\begin{scope}[thepink,->,big>]
		\draw[bend right=15] (A) to (!);
		\draw[bend left=15]  (B) to (!);
	\end{scope}
  \end{tikzpicture}
}
\]



Finally, that two vertices in a proof net or a switching graph are connected will be indicated via a dashed edge, as illustrated below.
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[bullet] (a) at (0,0) {}; \node[bullet] (b) at (2,0) {}; \draw[dashed] (a)--(b);
\end{tikzpicture}
\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[circ] (a) at (0,0) {}; \node[circ] (b) at (2,0) {}; \draw[dashed] (a)--(b);
	%\coordinate (a') at ($(a) + (.6,0)$); \coordinate (b') at ($(b) + (-.6,0)$);
	%\draw[thepink,dashed] (a')--(b'); \draw[thepink,->] (a')--(a.center); \draw[thepink,->] (b')--(b.center);
\end{tikzpicture}
\]


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Subnets}


To conclude this section we will discuss (and adapt) some convenient standard notions for MLL proofs and proof nets.
%
Firstly we will look at subnets---see also \cite{Bellin-vandeWiele-1995}.


\begin{definition}
A \emph{sub-sequent} $\Delta\leq\Gamma$ of a sequent $\Gamma$ is a sequent consisting of disjoint subformulae of $\Gamma$, preserving names.
\end{definition}

\begin{definition}
A \emph{subnet} $(\Gamma',\links') \leq (\Gamma,\links)$ of a proof net is a net such that $\Gamma'\leq\Gamma$ and $\links'$ is $(\links|_{\Gamma'})$, the restriction of $\links$ to $\Gamma'$.
\end{definition}


The root vertices of $\Gamma'$ are the \emph{ports} of the sub-sequent $\Gamma'$ and of the subnet $(\Gamma',\links')$.
%
A \emph{scope} of a par $\named v\parr$ is a subnet that has $v$ as a port.
%
In a proof net, the \emph{kingdom} and the \emph{empire} of a par are respectively its smallest and largest scope.



The scopes of a par correspond to the possible subproofs of its introduction rule in a sequentialisation of the proof net that it occurs in.
%
In the graph of a proof net, the scope of a par $\named v\parr$ may be \emph{contracted} to a single vertex $v$ by removing all vertices except $v$,  and re-attaching the edges of any removed vertices to $v$.
%
In the example below, the kingdom of a (ternary) par is indicated (left) and contracted (right).
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (-2.25,0) node[bullet] (x) {} -- (-1.25,0) node[bullet] (y) {}
		  (.25,0) node[bullet] (a) {} -- (1.25,0) node[bullet] (b) {}
		  ( 2.75,0) node[bullet] (c) {} -- (3.75,0) node[bullet] (d) {};
	\node[circ] (0) at (5.75,0) {};
	\node[circ] (1) at (-1,3) {};
	\node[circ] (2) at (1,3) {}; \node[circ] (3) at (2,3) {}; \node[circ] (4) at (3,3) {};
	\draw[rounded corners] (0,2) rectangle (4,4);
	\draw (4,3) -- (5.5,3) node[bullet] (e) {};
	\begin{scope}[thepink,->]
			\draw[bend right=10] (x) to (1);
			\draw[bend right=20] (y) to (2);
			\draw[bend right=10] (a) to (2);
			\draw[bend right=10] (b) to (3);
			\draw[bend left=10]  (c) to (3);
			\draw[bend left=10]  (d) to (4);
			\draw[bend right=10] (e) to (0);
	\end{scope}
	\draw[dashed,rounded corners] (-.25,-.5) rectangle (4.25,4.25);
\end{tikzpicture}
\qquad\qquad
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\draw (-2.25,0) node[bullet] (x) {} -- (-1.25,0) node[bullet] (y) {};
	\node[circ] (0) at (3,0) {};
	\node[circ] (1) at (-1,3) {};
	\node[draw,rounded corners,minimum size=16pt] (box) at (1,3) {};
	\draw (box)--(3,3) node[bullet] (e) {};
	\begin{scope}[thepink,->]
			\draw[bend right=10] (x) to (1);
			\draw[bend right=20] (y) to (box);
			\draw[bend right=10] (e) to (0);
	\end{scope}
	\path (0,4.25)--(1,4.25);
\end{tikzpicture}
\]
%
The contraction of scopes may replace the switching condition as a correctness criterion.
%
The following is a variant of the local retraction algorithm by Danos \cite{Danos-1990}.


\begin{proposition}
\label{prop:scoping correctness}
A linking $\links$ for a sequent $\Gamma$ is a proof net if and only if each $\named v\parr$ is a port of a sub-sequent $s(v)\leq\Gamma$ such that:

\begin{enumerate}
	\item
sub-sequents either disjoint or strictly nested: if $s(v)\cap s(w)\neq\varnothing$ then $s(w)<s(v)$ or $s(v)<s(w)$; and
	\item
for each $\named v\parr$ the graph $\sigma(v)=(s(v),\links|_{s(v)})$ becomes a tree when all immediate sub-sequents are contracted.
\end{enumerate}

\end{proposition}


\begin{IEEEproof}
For the `if' direction, it follows by induction on the nesting of sub-sequents that each graph $\sigma(v)$ satisfies the switching condition.
%
For the `only if' direction, given a sequentialisation of $(\Gamma,\links)$, a sub-sequent $s(v)\leq\Gamma$ for each $\named v\parr$ is found by taking the conclusion $\Delta, A\named v\parr B$ of its introduction rule, below.
\[
	\infer{\Delta,A\named v\parr B}{\Delta,A,B}
\]
\end{IEEEproof}


Finally, the standard notion of \emph{balance} provides an easy way of identifying some unprovable sequents.


\begin{definition}
The \emph{balance} of a sequent is the number of $\bot$s minus the number of $\parr$s and comma's.
%
A sequent is \emph{balanced} if its balance is zero.
\end{definition}


\begin{proposition}
\label{prop:unbalanced then uninhabited}
An unbalanced sequent is uninhabited.
\end{proposition}


%A positive balance guarantees a cycle in any switching graph, for any linking, while a negative balance similarly guarantees disconnectedness.
%
%An early conjecture of Girard, which turned out to be false, was that a sequent is inhabited if and only if it is balanced. [[FIND CITATION (probably TCS87)]]
%










%------------------------------------------------------------


\section{Encoding constraint logic}


\emph{Non-deterministic constraint logic} \cite{Hearn-Demaine-2005,Demaine-Hearn-2008} is a simple graph-rewriting formalism, introduced as a convenient tool for \textsc{PSPACE}-hardness reductions.
%
A rewrite step consists of the reversal of a single edge in a \emph{constraint graph}, a graph with weighted, directed edges and an \emph{inflow constraint} on each vertex.
%
Rewrite steps must preserve the condition that the total weight of the incoming edges of each vertex is at least its inflow constraint.
%
The specific problem we will use is the \emph{configuration--to--configuration} problem, which asks whether a path of rewrite steps exists between two constraint graphs.


We will introduce minor adaptations to this formalism to suit our reduction to MLL proof equivalence.
%
Mainly, a constraint graph itself will have \emph{undirected} edges, while a separate notion of \emph{configuration} imposes a direction on them.
%
A constraint graph may then be encoded as a sequent, and a configuration as a proof net.
%
In addition, we will allow \emph{partial} configurations, where edges may be left undirected---as long as the inflow constraints are satisfied by the directed edges.


\begin{definition} 
A \emph{constraint graph} $G=(V,E,c,v,w)$ consists of: a set $V$ of vertices with \emph{inflow constraint} $c\colon V\to\mathbb N$; and a set $E$ of undirected edges with \emph{weight} $w\colon E\to\mathbb N$, connecting vertices $v(e)=\{v_1,v_2\}\subseteq V$.
%of at most one undirected edge $e$ per vertex-pair $v(e)=\{v_1,v_2\}$, with \emph{weight} $w\colon E\to N$.

\smallskip

A \emph{(partial) configuration} for a constraint graph is a (partial) function $\gamma\colon E\to V$ such that
\begin{itemize}
	\item
for every edge $e$, if $\gamma(e)$ is defined then $\gamma(e)\in v(e)$,
	\item
for every vertex $v$, the total weight of its incoming edges is at least its inflow constraint, 
%$\sum\{\kern1pt w(e)\kern1pt|\kern1pt\gamma(e)=v\kern1pt\}\geq c(v)$.
$\sum\{w(e)\mid\gamma(e)=v\}\geq c(v)$.
\end{itemize} 

\smallskip
A \emph{reconfiguration step} $\gamma\perm*\delta$ relates two (partial) configurations for an \textsc{ncg} $G$ that differ in value (or definedness) on exactly one edge.
%
The reflexive--transitive closure of $(\perm*)$ will be denoted $(\perm)$.
%
\end{definition}


\begin{proposition}
\label{prop:partial simulates total reconfiguration}
For total configurations $\gamma$ and $\delta$, if $\gamma\perm\delta$ then $\gamma$ and $\delta$ are also connected by a sequence of reconfiguration steps over total configurations only.
\end{proposition}


\begin{IEEEproof}
By the following two observations: firstly, 
%
if $\gamma\perm*\delta$ for partial configurations, then these may be completed to total configurations $\gamma'\perm*\delta'$ or $\gamma'=\delta'$; and secondly,
%
if $\gamma'$ and $\gamma''$ are total configurations that both agree with a partial configuration $\gamma$ where the latter is defined, then $\gamma'$ and $\gamma''$ are connected by reversing the edges on which they disagree one after another.
%
\end{IEEEproof}


\emph{Non-deterministic constraint graph reconfiguration} or \emph{\textsc{ncg}-reconfiguration} is the problem of deciding whether two total configurations for a constraint graph are connected by a sequence of reconfiguration steps.
%
%By the above proposition, \textsc{ncg}-reconfiguration is unaffected by inclusion or exclusion of partial configurations.



\begin{theorem}[\cite{Hearn-Demaine-2005}]
\textsc{ncg}-reconfiguration is \textsc{pspace}-complete.
\end{theorem}

%By Proposition~\ref{prop:partial simulates total reconfiguration} the following is then immediate.
%
%\begin{proposition}
%Partial \textsc{ncg}-reconfiguration is \textsc{pspace}-complete.
%%\textsc{pncg}-reconfiguration is \textsc{pspace}-complete.
%\end{proposition}


We will demonstrate the \textsc{pspace}-hardness of MLL proof equivalence by an encoding of \textsc{ncg}-reconfiguration in MLL proof nets.


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{The encoding}


The basis of the encoding of constraint graphs in MLL is formed by \emph{weight elements}, which encode one unit of weight on an edge, and \emph{constraint elements}, that encode one unit towards the inflow constraint of a vertex.
%
The arithmetic of linking formulae of the form $\bigtn(\bot^n)$ to formulae $\bigparr(1^m)$ will be used to ensure that a weight element may be linked to only two vertices.
%
Below left is a weight element, below right a constraint element.
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big_] (A) at (0,0) {$i'$}; 
	\node[big_] (B) at (2,0) {$j'$};
	\node[big_] (C) at (4,0) {$k'$};
	\draw[rounded corners] (-1,-1) rectangle (5,1);
\end{tikzpicture}
\qquad\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big1] (1) at (0,0) {$m'$}; 
	\node[big1] (2) at (3,0) {$n'$};
	\draw[rounded corners] (-1,-1) rectangle (1,1) (2,-1) rectangle (4,1);
	\draw (1,0)--(2,0);
\end{tikzpicture}
\]
For all edges and vertices in the encoding of a constraint graph, the sum $i+j+k=m+n$ will be the same---this way, a priori any weight element may connect to any constraint element.
%
The value of $m$ (and thus $n$) will differ for each vertex.
%
The weight element above will be able to connect naturally to those constraint elements where $m=i$ and where $m=i+j$, as illustrated below.
\[
	\connectingElements 1 \qquad \connectingElements 2
\]
To ensure that no other connections can be made, values are chosen such that $m\bmod3=1$ and $n\bmod3=2$, and accordingly $i\bmod3=1$, $j\bmod3=0$, and $k\bmod3=2$.


In a constraint graph, the sum of weights is usually greater than the sum of all inflow constraints---otherwise, no edge can move, or no configuration exists.
%
An encoding will therefore have weight elements not connected to constraint elements.
%
These will instead connect to additional, separate $\1$-formulae, referred to as \emph{weight absorbers}, as follows.
%
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big_] (A) at (0,0) {}; 
	\node[big_] (B) at (2,0) {};
	\node[big_] (C) at (4,0) {};
	\draw[rounded corners] (-1,-1) rectangle (5,1);
	\node[big1] (1) at (7.5,0) {};
	\begin{scope}[thepink,->,big>]
		\draw[bend left=30] (A) to (1);
		\draw[bend right=30] (B) to (1);
		\draw (C) to (1);
	\end{scope}
\end{tikzpicture}
\]
%
An edge will be encoded by an \emph{edge-gadget}, illustrated below left, constructed by stringing together a number of similar weight elements plus a single \emph{indicator} vertex.
%
Illustrated below right is a \emph{vertex-gadget} encoding a vertex, formed by a number of constraint elements plus a single \emph{indicator target}.
%
\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big_] (A) at (0,0) {$i'$}; 
	\node[big_] (B) at (2,0) {$j'$};
	\node[big_] (C) at (4,0) {$k'$};
	\draw[rounded corners] (-1,-1) rectangle (5,1);
	\node[big_] (D) at (0,4) {$i'$}; 
	\node[big_] (E) at (2,4) {$j'$};
	\node[big_] (F) at (4,4) {$k'$};
	\draw[rounded corners] (-1,3) rectangle (5,5);
	\draw (2,1)--(2,1.5) (2,2.5)--(2,3);
	\draw[dotted] (2,1.5)--(2,2.5);
	\draw (2,-1)--(2,-2) node[bullet] {};
	\path (0,-2.5)--(1,-2.5);
\end{tikzpicture}
\qquad\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[big1] (1) at (0,0) {$m'$}; 
	\node[big1] (2) at (3,0) {$n'$};
	\draw[rounded corners] (-1,-1) rectangle (1,1) (2,-1) rectangle (4,1);
	\draw (1,0)--(2,0);
	\node[big1] (3) at (0,4) {$m'$};
	\node[big1] (4) at (3,4) {$n'$};
	\draw[rounded corners] (-1,3) rectangle (1,5) (2,3) rectangle (4,5);
	\draw (1,4)--(2,4);
	\draw[dotted] (1.5,1.5)--(1.5,2.6);
	\node[circ] at (1.5,-2) {};
	\draw[rounded corners] (-1.5,-2.5) rectangle (4.5,5.5);
\end{tikzpicture}
\]
%
It would be natural to encode an edge of weight $n$ by an edge-gadget with $n$ weight elements.
%
However, there is a minor issue that prevents this straightforward approach.
%
Where one weight element cannot `fill' an inappropriate constraint element, two weight elements can, in the way illustrated below.
%
\[
\begin{tikzpicture}[x=5mm,y=-5mm,octo]
	\node[big_] (A) at (-1,0) {}; 
	\draw (.75,0) node[big_] (B1) {} -- (2.25,0) node[big_] (B2) {};
	\node[big_] (C) at (4,0) {};
	\draw[rounded corners] (-2,-1) rectangle (5,1);
	\draw (7,0) node[big_] (D1) {} -- (8.5,0) node[big_] (D2) {}; 
	\node[big_] (E) at (10.25,0) {};
	\node[big_] (F) at (12,0) {};
	\draw[rounded corners] (6,-1) rectangle (13,1);
	\node[big1] (1) at (1,4) {};
	\node[big1] (2) at (4,4) {}; 
	\node[big1] (3) at (7,4) {};
	\node[big1] (4) at (10,4) {};
	\draw[rounded corners] (3,3) rectangle (5,5) (6,3) rectangle (8,5);
	\draw (5,4)--(6,4);
	\begin{scope}[thepink,->,big>]
		\draw[bend right=25] (A)  to (1);
		\draw[bend right=15] (B1) to (1);
		\draw[bend right=25] (B2) to (2);
		\draw[bend right=15] (C)  to (2);
		\draw[bend left=15] (D1) to (3);
		\draw[bend right=15] (D2) to (4);
		\draw[bend left=20] (E)  to (4);
		\draw[bend left=20] (F)  to (4);
	\end{scope}
\end{tikzpicture}
\]
%
In such an inappropriate linking, since both halves of the constraint element are connected, both weight elements must be disconnected---otherwise, the linking would violate the switching condition.
%
That means the weight elements must belong to different edges.
%
For the same reason, to fill the next weight element, one half may be filled by a weight element from a previous edge, but to fill the other half requires an additional edge to be involved.
%
To fill $n$ constraint elements inappropriately therefore requires $n+1$ edges.
%
It thus suffices to multiply the number of constraint elements by the number of edges, and encode a vertex with inflow constraint $c$ by a vertex-gadget with $c\times|E|$ constraint elements (where $|E|$ denotes the number of edges in the constraint graph).


The complete encoding of a constraint graph will be a sequent consisting of: 1) all vertex-gadgets combined in a single formula via tensors, 2) all edge-gadgets as individual formulae, 3) a sufficient number of weight absorbers ($\1$-formulae).
%
For the formal definition, let $|V|$ and $|E|$ denote the number of vertices and edges, respectively, in a constraint graph $G=(V,E,c,v,w)$, and let $|c|$ and $|w|$ denote the sum of all inflow constraints and the sum of all weights respectively:
\[
	|c| = \sum_{v\in V}c(v) \qquad |w| = \sum_{e\in E}w(e)~.
\]



\begin{definition}
\label{def:graph encoding}
The \emph{encoding} $\itn G$ of a constraint graph $G$ is a sequent constructed as follows.
%
Let $G=(V,E,c,v,w)$, and let $V=\{v_1,\dotsc,v_n\}$ and $E=\{e_1,\dotsc,e_m\}$ where $|V|=n$ and $|E|=m$.

\noindent
The encoding of a vertex $v_k$ is the formula
\[
	\itn{v_k} = \bigparr\big(C_n(k)^{m\times c(v_k)} \big)\parr\1
\]
where each \emph{constraint element} $C_n(k)$ is the formula
\[
	C_n(k) = \bigparr\big(1^{3k+2}\big) \tn \bigparr\big(1^{3(n-k)+3}\big)
\]

\noindent
The encoding of an edge $e$ connecting vertices $v_i$ and $v_j$ with $i<j$ is the formula
\[
	\itn{e} = \bigtn\big(W_n(i,j)^{m\times w(e)}\big)\tn\bot
\]
where each \emph{weight element} $W_n(i,j)$ is the formula
\[
	W_n(i,j) = \bigtn\big(\bot^{3i+2}\big)\parr\bigtn\big(\bot^{3(j-i)+1}\big)\parr\bigtn\big(\bot^{3(n-j)+3}\big)
\]

\noindent
The encoding of the graph $G$ is the sequent
\[
	\itn G = \itn{v_1}\tn\dotso\tn\itn{v_n}, \itn{e_1},\dotsc,\itn{e_m}, 1^p
\]
where $p=m\times(|w|-|c|)\times(3n+4)$.

\end{definition}



In the above definition, the final $\1$-subformula of a vertex-gadget $\itn{v_k}$ is its \emph{indicator target}; the final $\bot$-subformula of an edge-gadget $\itn{e}$ is its \emph{indicator}; and in the completed encoding $\itn G$ the $p$ instances of $\1$ are the \emph{weight absorbers}.
%
In a constraint graph $G$, a vertex $v$ and an edge $e$ will be called \emph{appropriate} (for each other) if $v\in v(e)$, and \emph{inappropriate} otherwise.
%
This notion is extended to vertex-gadgets $\itn v$ and edge-gadgets $\itn e$ in $\itn G$, and their respective constraint elements and weight elements.



A configuration $\gamma$ for a constraint graph $G$ will be encoded as a proof net for the sequent $\itn G$.
%
Firstly we will define a standard way of linking a weight element to a constraint element.

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
\begin{definition}
\label{def:standard linkings}
For a weight element $W=W_n(i,j)=A\parr B\parr C$,
\begin{enumerate}
	\item
for a constraint element $C=C_n(i)=X\tn Y$, the \emph{standard linking} for the sequent $W,C$ links the first $\bot$ in $A$ to the first $\1$ in $X$, the first $\bot$ in $B$ and $C$ each to the first $\1$ in $Y$, and each remaining $\bot$ in $A,B,C$ to a remaining $\1$ in $X,Y$ in their order of occurrence;
	\item
for $C=C_n(j)=X\tn Y$, the \emph{standard linking} for $W,C$ is defined as above, except the first $\bot$ in $B$ links to the first $\1$ in $X$;
	\item
the \emph{standard linking} for the sequent $W,\1^{3n+4}$ links the first $\bot$ in $A$, $B$, and $C$ to the first $\1$, and each remaining $\bot$ to a remaining $\1$ in order of occurrence.
\end{enumerate}
\end{definition}

The standard linkings defined in the first and third case of the above definition are illustrated below.

\[
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[circ] (1) at (-.25,0) {};
	\node[big1] (2) at (1,0) {};
	\node[big1] (3) at (2.5,0) {};
	\node[big1] (4) at (5.5,0) {};
	\draw[rounded corners] (-1,-1) rectangle (3.5,1) (4.5,-1) rectangle (6.5,1);
	\draw (3.5,0)--(4.5,0);
	%
	\draw (-.25,4) node[bullet] (a) {} -- (.75,4) node[big_] (A) {};
	\draw (2.25,4) node[bullet] (b) {} -- (3.25,4) node[big_] (B) {};
	\node[big_] (C) at (5.5,4) {};
	\draw[rounded corners] (-1,3) rectangle (6.5,5);
	%
	\begin{scope}[thepink,->]
		\draw[bend right=5] (a) to (1);
		\draw[bend right=10] (b) to (1);
		\draw[big>,bend left=25] (A) to (2);
		\draw[big>,bend left=20] (B) to (3);
		\draw[big>,bend left=15] (C) to (4);
	\end{scope}
\end{tikzpicture}
\qquad
\begin{tikzpicture}[x=5mm,y=5mm,octo]
	\node[circ] (1) at (.75,0) {};
	\node[big1] (2) at (2,0) {};
	\node[big1] (3) at (3.5,0) {};
	\node[big1] (4) at (5,0) {};
	%
	\draw ( 0  ,4) node[bullet] (a) {} -- ( 1  ,4) node[big_] (A) {};
	\draw ( 2.5,4) node[bullet] (b) {} -- ( 3.5,4) node[big_] (B) {};
	\draw ( 5  ,4) node[bullet] (c) {} -- ( 6  ,4) node[big_] (C) {};
	\draw[rounded corners] (-.5,3) rectangle (7,5);
	\path (0,-1) -- (1,-1);
	%
	\begin{scope}[thepink,->]
		\draw[bend right=5] (a) to (1);
		\draw[bend right=10] (b) to (1);
		\draw[bend right=15] (c) to (1);
		\draw[big>,bend left=25] (A) to (2);
		\draw[big>,bend left=20] (B) to (3);
		\draw[big>,bend left=15] (C) to (4);
	\end{scope}
\end{tikzpicture}
\]

\begin{proposition}
\label{prop:element linkings}
The standard linkings of Definition~\ref{def:standard linkings} are proof nets.
\end{proposition}


The encoding of a configuration is then as follows.



\begin{definition}
\label{def:configuration encoding}
The \emph{encoding} $\itn\gamma$ of a total configuration $\gamma$ for a constraint graph $G$ is a linking $\links$ for $\itn G$, constructed incrementally for each successive edge $e$ and for each successive weight element $W$ within $e$, as follows.
%
Let $\gamma(e)=v$; firstly, the indicator of $\itn e$ is linked to the indicator target of $\itn v$.
%
Then successively for each weight element $W$ in $e$, if $\itn v$ has a first free constraint element $C$, extend $\itn\gamma$ to include the standard linking on $W,C$; otherwise, extend $\itn\gamma$ by the standard linking on the sequent consisting of $W$ plus the first $3n+4$ free weight absorbers.
\end{definition}



\begin{proposition}
If $\gamma$ is a total configuration for $G$ then $\itn\gamma$ is a proof net for $\itn G$.
\end{proposition}

\begin{IEEEproof}
Using Proposition~\ref{prop:scoping correctness}, it is sufficient to give a suitable scope for each $\parr$. 
%
The scope of each weight element $W$ is the sequent $W,C$ or $W,1^{3n+4}$ of its standard linking, which forms a proof net by Proposition~\ref{prop:element linkings}.
%
The scope of each vertex-gadget $\itn v$ contains the edge-gadgets $\itn e$ such that $\gamma(e)=v$, plus all the weight absorbers within scopes of weight elements inside $\itn e$.
%
Since the weights of the connected edges $e$ sum to more than the inflow constraint of $v$, there are no unused constraint elements remaining in $\itn v$.
%
After contracting the scope of each $W$, each edge-gadget in the scope of $\itn v$ becomes a single string of connected vertices, connected to other edge-gadgets only via the indicator target of $\itn v$, thus forming a tree.
\end{IEEEproof}






\begin{figure*}
\[
	\vc{\doubleExchange uvxy}
	\quad\perm*\quad
	\vc{\doubleExchange uyxy}
	\quad\perm*\quad
	\vc{\doubleExchange uyxu}
	\quad\perm*\quad
	\vc{\doubleExchange vyxu}
	\quad\perm*\quad
	\vc{\doubleExchange vyyu}
	\quad\perm*\quad
	\vc{\doubleExchange vuyu}
	\quad\perm*\quad
	\vc{\doubleExchange vuyx}
\]
\caption{Double exchange of links}
\label{fig:double exchange}
\end{figure*}


%------------------------------------------------------------

\section{Rewiring proof nets}



In this section we will explore the global rewiring behaviour of proof nets.
%
In particular, we will give a simple account of equivalence for the fragment of MLL that omits the par, i.e.\ that of sequents of formulae constructed over $\1$, $\bot$, and $\tn$.
%
Equivalence in this fragment is determined by two main characteristics: 1) proof nets that differ by the exchange of exactly two links are not equivalent; and 2) as long as there are at least two tensor-formulae in the sequent, proof nets are equivalent whenever this is possible while respecting the previous.



Before turning to this fragment there is the following lemma for full MLL, which states that (under the given connectedness conditions) equivalence is preserved by a double exchange of links.



\begin{lemma}
\label{lem:double exchange}
Let $\links$ be a proof net where $\links(a)=u$, $\links(b)=v$, $\links(c)=x$, and $\links(d)=y$, and for any switching the path from $u$ to $y$ passes through the links $\edge bv$ and $\edge xc$.
%
Then $\links\perm\links'$ where $\links'(a)=v$, $\links'(b)=u$, $\links'(c)=y$, and $\links'(d)=x$, and $\links'(z)=\links(z)$ otherwise.
\end{lemma}

\begin{IEEEproof}
By the rewiring path shown in Figure~\ref{fig:double exchange}.
\end{IEEEproof}






Let a \emph{1-alternation} sequent be one over formulae of the form $1$ or $\bot\tn\ldots\tn\bot$, where the number of $\bot$-subformulae is at least 2.
%
Such a sequent is inhabited exactly when the number of formulae in the sequent is one greater than the total number of $\bot$-subformulae it contains.
%
An inhabited 1-alternation sequent with only one tensor-formula, i.e.\ a sequent of the form $\1,\ldots,\1,\bot\tn\ldots\tn\bot$ with $n$ $\bot$-subformulae and $n$ $1$-subformulae, will admit $n!$ different proof nets, each with $n$ links.
%
Since no link can re-attach, its equivalence classes are singletons.



\begin{proposition}
\label{prop:level0 max binary}
%
For a 1-alternation sequent with at least two tensor-formulae there are at most two equivalence classes of proof nets.
%
\end{proposition}


%
%\begin{figure}[p]
%\[
%\begin{array}{ccc}
%	\netA 1213 & \perm	& \netA 3213 \\ \\[-6pt] \vperm && \vperm \\ \\[-6pt]
%	\netA 1223 &		& \netA 3212 \\ \\[-6pt] \vperm && \vperm \\ \\[-6pt]
%	\netA 1323 &		& \netA 3112 \\ \\[-6pt] \vperm && \vperm \\ \\[-6pt]
%	\netA 1321 &		& \netA 3132 \\ \\[-6pt] \vperm && \vperm \\ \\[-6pt]
%	\netA 2321 &		& \netA 2132 \\ \\[-6pt] \vperm && \vperm \\ \\[-6pt]
%	\netA 2331 & \perm	& \netA 2131
%\end{array}
%\qquad
%\begin{array}{ccc}
%	\netA 1312 & \perm	& \netA 1332 \\ \\[-6pt] \vperm && \vperm \\ \\[-6pt]
%	\netA 2312 &		& \netA 1232 \\ \\[-6pt] \vperm && \vperm \\ \\[-6pt]
%	\netA 2313 &		& \netA 1231 \\ \\[-6pt] \vperm && \vperm \\ \\[-6pt]
%	\netA 2113 &		& \netA 3231 \\ \\[-6pt] \vperm && \vperm \\ \\[-6pt]
%	\netA 2123 &		& \netA 3221 \\ \\[-6pt] \vperm && \vperm \\ \\[-6pt]
%	\netA 3123 & \perm	& \netA 3121
%\end{array}
%\]
%\caption{The two equivalence classes of nets for $\1,\1,\1,\bot\tn\bot,\bot\tn,\bot$}
%\label{fig:2x12 nets}
%\end{figure}



\begin{IEEEproof}
%
It will be shown by induction on the number of $\bot$-formulae in $\Gamma$ that every proof net for $\Gamma$ belongs to one of two equivalence classes.
%
For the base case, the smallest inhabited sequent with two tensor-formulae is the following.
\[
	\1,\1,\1,\bot\tn\bot,\bot\tn,\bot
\]
It has two equivalence classes, of 12 proof nets each.
%
(Apart from listing these exhaustively, this can also be shown by using the proof of the inductive step, below, to reduce the base case to that of the sequent $\1,\1,\bot\tn\bot$, which has two singleton equivalence classes.)

%, displayed in Figure~\ref{fig:2x12 nets}.



For the inductive step, let $\Gamma$ be the following sequent.
\[
	\Delta,A\tn\named a\bot,\named z\1
\]
There are two cases: 1) where $A$ is a tensor-formula, and 2) where $A$ is $\bot$ and where, for the induction hypothesis to apply, $\Delta$ contains at least two tensor-formulae.
%
For both cases, it will be shown that any net $\links$ for $\Gamma$ is equivalent to a net $\links'$ where $\named a\bot$ connects to $\named z1$, and is the only link to do so.
%
This reduces equivalence on $\Gamma$ to equivalence on $\Delta,A$ in case 1, and on $\Delta$ in case 2, so that the induction hypothesis applies.


In constructing $\links'$, since the proof net must be connected, there is a path from $a$ to $z$.
%
We will consider only the jumps on this path, not any other edges.
%
There are four cases.

\begin{enumerate}
	\item
The path consists of exactly the jump $\edge az$.
%
Let $\edge by$ be a jump from a $\named b\bot$ in $A$; then $\links'$ is obtained from $\links$ by changing: $\links'(e)=y$  for every $\named e\bot$ such that $\links(e)=z$ and $e\neq a$.


	\item
The path starts with the jump $\edge ax$ (and $x\neq z$).
%
Let $\edge by$ be a jump from a $\named b\bot$ in $A$, and let the path end with the jumps $\edge wc$ and $\edge dz$, where $\named c\bot$ and $\named d\bot$ are in the same tensor-formula $B$.
%
Then $\links'$ is obtained from $\links$ by changing: $\links'(a)=z$, and $\links'(e)=w$ for every $\named e\bot$ such that $\links(e)=z$ and $e\neq a$, including $d$.
%
These changes are illustrated as permutations below.
%
\[
	\netB xywz \perm \netB zywz \perm \netB zywy
\]



	\item
The path consists of exactly one jump $\edge bz$ from a $\named b\bot$ in $A$ (and $b\neq a$).
%
Let $\links(a)=y$.
%
Choose a jump $\edge cw$ from $\named c\bot$ in $A$ such that there is another $\edge dw$ from $\named d\bot$ in a formula $B$ (not excluding the possibilities $c=b$ and $c=a$).
%
Let $\edge ex$ be a further jump from $\named e\bot$ in $B$.
%
Then $\links'$ is obtained from $\links$ by changing: $\links'(a)=z$, $\links'(d)=x$, $\links'(e)=y$, and $\links'(f)=x$ for each $f$ (including $b$) such that $\links(f)=z$ and $f\neq a$.
%
These changes are exhibited as a series of permutations below, from top left to bottom left (note that the jump from $d$ moves twice).
%
\[
\kern-3pt
\begin{array}{@{}c@{~}c@{~}c@{~}c@{~}c@{}}
	\netC yzwx & \perm & \netC yzzx & \perm & \netC yxzx
	\\ &&&& \vperm \\
	\netC zxxy & \perm & \netC zxzy & \perm & \netC yxzy
\end{array}
\]



	\item
The path starts with a jump $\edge bx$ from a $\named b\bot$ in $A$ (and $b\neq a$, $x\neq z$).
%
Let the path end with the jumps $\edge wc$ and $\edge dz$, and let $\links(a)=y$.
%
Then $\links'$ is obtained from $\links$ by changing: $\links'(c)=y$, $\links'(a)=z$, and $\links'(e)=w$ for every $\named e\bot$ such that $e\neq a$ and $\links(e)=z$, including $d$.
%
This is illustrated below.
\end{enumerate}
%
\[
	\netB yxwz \perm \netB yxyz \perm \netB zxyz \perm \netB zxyw
\]
%
\end{IEEEproof}




\begin{proposition}
\label{prop:level0 may-connect path}
%
For a proof net for a 1-alternation sequent containing a link $\edge{\named a\bot}{\named b\1}$ and a formula $\named c\1$, the following are equivalent.
%
\begin{itemize}
	\item
The edge $\edge ab$ can be permuted to $\edge ac$.
	\item
There is a path from $b$ to $c$ not passing through $a$.
	\item
The path from $a$ to $c$ starts with the jump $a-b$.
\end{itemize} 
\end{proposition}


If a link $\edge ab$ may be reconnected as $\edge ac$ it is said that $a$ \emph{may connect to} $c$. 
%
By the above proposition, it is immediate that if $a$ and $b$ may both connect to $c$, then after actually reconnecting $\edge ac$, still $b$ may connect to $c$.



Consider the following naming scheme for the units in a 1-alternation sequent $\Gamma$ with tensor-formulae $A_1,\dotsc,A_n$.
%
\begin{itemize}

	\item
One $\1$ in $\Gamma$ is named $*$, and the remaining ones with the numbers $n+1,\dotsc,m$.

	\item
A $\bot$-formula in $A_i$ is named by a pair $(i,k)$, where $k=i$ for the first $\bot$-formula in each $A_i$, and for the remaining $\bot$-formulae in all $A_i$, each $k$ is a distinct number in $n+1,\dotsc,m$.

\end{itemize}
%
The naming scheme suggests a linking for $\Gamma$, defined by $\links(i,i)=\star$ and $\links(i,k)=k$ otherwise; i.e\ the first $\bot$ in each tensor-formula connects to $\named *\1$, while other $\bot$-subformulae connect uniquely to the remaining $\1$-subformulae.



A net for $\Gamma$ is interpreted as a combinatorial permutation (an automorphism on $\{1,\dotsc,m\}$) as follows.
%
\begin{definition}
\label{def:combinatorial permutation}
To a proof net $\links$ for a 1-alternation sequent $\Gamma$ named as above, associate the \emph{permutation} $\prm:\{1,\dotsc,m\}\to\{1,\dotsc,m\}$ given by:
\[
	\prm(k) = 
	\begin{cases}
		i				& \text{ if $(i,k)$ may connect to $*$; and}
	\\	\links(i,k)		& \text{ otherwise.}
	\end{cases}
\]
The \emph{parity} of $\links$ is the parity of its permutation.
\end{definition}


To see that $\prm$ is injective, consider the following.
\begin{itemize}
	\item The domains of $i$ and $\links(i,k)$, respectively $1,\dotsc,n$ and $n+1,\dotsc,m$, are disjoint.
	\item Exactly one $\bot$-formula in each $A_i$ may connect to $*$ because of connectedness and acyclicity, since if a $\bot$-formula may connect to $*$ it has a path to $*$ (Proposition~\ref{prop:level0 may-connect path}).
	\item If two $\bot$-formulae have the same target, which means they are in different tensor-formulae, at least one may connect to $*$ via the other tensor-formula, which must have a path to $*$ by the above.
\end{itemize}



\begin{proposition}
\label{prop:level0 min binary}
A permutation on a net $\links$ preserves its parity. 
\end{proposition}


\begin{IEEEproof}
Let $\links$ be a net for $\Gamma$, with $\Gamma$ named as above, and let the link $\edge{(i,k)}x$ in $\links$ re-attach as $\edge{(i,k)}y$, forming $\links'$.
%
There are two cases, depending on whether $(i,k)$ may connect to $*$.
%
If so, using Proposition~\ref{prop:level0 may-connect path}, the re-wiring preserves which $\bot$-formulae may connect to $*$, since for any path to $*$ via $\edge{(i,k)}x$ in $\links$ there is a path to $*$ via $\edge{(i,k)}y$.
%
Then the permutation of $\links'$ is that of $\links$.


If $(i,k)$ may not connect to $*$, let the path from $x$ to $y$ run via the following $\bot$- and $\1$-vertices.
\[
	x=x_1, (i_1,j_1), (i_1,k_1), x_2, (i_2,j_2), \dotsc, (i_n,k_n), x_{n+1}=y 	
\]
Note that the $\bot$-formulae $(i_a,j_a)$ may connect to $*$.
%
On the relevant domain, this gives the following permutation for $\links$.
\[
\left(\begin{array}{ccccccc}
	j_1 & \dotso & j_n &  k  & k_1 & \dotso & k_n \\
	i_1 & \dotso & i_n & x_1 & x_2 & \dotso & x_{n+1}
\end{array}\right)
\]
In $\links'$, since $\links'(i,k)=y$, the $\bot$-formulae that may connect to $*$ are the $(i_a,k_a)$.
%
The permutation $\prm[\links']$ is the following.
\[
\left(\begin{array}{ccccccc}
	j_1 & \dotso & j_n &    k    & k_1 & \dotso & k_n \\
	x_1 & \dotso & x_n & x_{n+1} & i_1 & \dotso & i_n
\end{array}\right)
\]
The parity of both permutations is the same if and only if the relative permutation, below, is even.
\[
\left(\begin{array}{ccccccc}
	i_1 & \dotso & i_n & x_1     & x_2 & \dotso & x_{n+1} \\
	x_1 & \dotso & x_n & x_{n+1} & i_1 & \dotso & i_n
\end{array}\right)
\]
This is the case, as it is obtained by the exchange of $x_a$ and $i_a$ for each $a\leq n$, and subsequently the exchange of $x_{n+1}$ and each $i_a$ in turn.
%
\end{IEEEproof}



\begin{proposition}
\label{prop:parity determines equivalence}
Two proof nets for a 1-alternation sequent with at least two tensor-formulae are equivalent if and only if they have the same parity.
\end{proposition}


\begin{theorem}
\MLL\ proof equivalence in the absence of ~$\parr$ is linear-time decidable.
\end{theorem}

\begin{IEEEproof}
For a sequent with 1 tensor-formula, the problem is reduced to syntactic equality.
%
For a sequent with 2 or more tensor-formulae, by Propositions~\ref{prop:parity determines equivalence} the equivalence of two nets is determined by their parity.
%
Following Definition~\ref{def:combinatorial permutation} the parity of a net can be read off in a single traversal of the net.
%
This yields a linear-time algorithm.
%
\end{IEEEproof}






%------------------------------------------------------------

\section{Correctness of the encoding}

In this section we will establish that in our encoding of constraint graphs %partial \textsc{ncg}-reconfiguration 
in MLL, reconfiguration on graphs is captured by proof equivalence in MLL.
%
Up to minor technical details, it will be shown that $\itn\gamma\perm\itn\delta$ if and only if $\gamma\perm\delta$, in two parts: completeness ($\Leftarrow$) and soundness ($\Rightarrow$).



% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Completeness}

Given a reconfiguration path $\gamma\perm\delta$ over total configurations, we will demonstrate a rewiring sequence between $\itn\gamma$ and $\itn\delta$ up to, possibly, a single exchange of two links in $\itn\delta$.
%
The central part of the argument will be to show how the weight element linking to a constraint element may be exchanged for another.
%
Once the weight elements of an edge-gadget are no longer connected to any constraint elements, the edge-gadget may straightforwardly be moved from one vertex-gadget to another by re-attaching its indicator link.
%
Throughout the rewiring process, weight elements and constraint elements will be kept in a standard linking, and according to the connectivity specified by the target configuration $\itn\delta$.
%
Linkings between weight elements and weight absorbers will remain arbitrary, and will be re-adjusted to match $\itn\delta$ at the end of the process.



In a proof net for $\itn G$, an edge-gadget $\itn e$ is \emph{well linked} if: 1) its indicator connects to the indicator target of an appropriate vertex-gadget $\itn v$, and 2) each weight element is either in a standard linking with a constraint element of $\itn v$, or linked only to weight absorbers.
%
A well-linked edge-gadget is \emph{free} if all its weight elements connect to weight absorbers.
%
In the following main lemma we will exchange the weight element linking to a constraint element.
%
The lemma considers a sequent consisting of just a vertex-gadget, some appropriate edge-gadgets, and sufficiently many weight absorbers.


\begin{lemma}
\label{lem:octopus roll}
In a proof net $\links$ for a sequent $\Gamma=\itn v,\itn{e_1},\dotsc,\itn{e_m},\bot^p$ where each edge-gadget is well linked, if a weight element $W_i$ in $\itn{e_i}$ is linked to $C$ in $\itn v$ and $W_j$ in $\itn{e_j}$ is linked to weight absorbers $\bot^n$, then there is a net $\links'\perm\links$ in which $W_j$ is naturally linked to $C$, $W_i$ is linked to $\bot^n$, and $\links'$ agrees with $\links$ otherwise.
\end{lemma}


\renewcommand\scalefactor{0.88}

\newcommand\displayOcto[1]{%
 \NoIndent{%
   \smallskip%
   \centerline{%
	 \scale{#1}%
  }}%
  \bigskip%
}


\begin{IEEEproof}
Let $W_i=A\parr B\parr C$, $W_j=D\parr E\parr F$, and $C=X\tn Y$.
%
The path of permutations will be illustrated for the case where $A,B,X$ and $D,X$, and thus also $C,Y$ and $E,F,Y$, are balanced sequents; other cases are similar.
%
\begin{enumerate}
	\item
The initial configuration is illustrated below. 
%
Other edges, other weight and constraint elements, and the outer box of the vertex-gadget, are omitted.
%
The vertices $i$, $j$, and  $v$ are the indicators of $\itn{e_i}$ and $\itn{e_j}$ and the indicator target of $\itn v$, respectively.
%
\displayOcto{\octorollA1}


	\item
The link $i-v$ is re-attached to connect to a weight absorber together with only the links from the first $\bot$ of each of $D$, $E$, and $F$. 
%
\displayOcto{\octorollB2}


	\item
Secondly, the link from the first $\bot$ of $D$ is moved to $X$, and those from the first $\bot$ of $E$ and $F$ are moved to $Y$.
%
\displayOcto{\octorollB3}


	\item\label{item:exchange added}
In the present configuration, the links from the weight elements form two subnets: one over the sub-sequents $A,B,X,D,\bot^m$, and one over the sub-sequent $C,Y,E,F,\bot^k$, for some $m$ and $k$.
%
By Proposition~\ref{prop:parity determines equivalence}, these subnets are equivalent to any other over the same sequent, as long as their parity is preserved.
%
It is then sufficient to choose linkings so that $D\parr E\parr F$ is in a a standard linking with $X\tn Y$, with a minor adjustment: two links from $C$ to $X$ should remain exchanged, compared to the standard linking, for step \ref{item:exchange needed} below.
%
The links of $A,B,C$ link to the weight absorbers $\bot^m$ and $\bot^k$, with one remaining link from $B$ to $X$ and one from $C$ to $Y$.
%
\displayOcto{\octorollC}


	\item
The link from $C$ to $Y$ is moved towards a weight absorber connected to $A,B$.
%
\displayOcto{\octorollD1}


	\item\label{item:exchange needed}
The link from $B$ to $X$ is the one remaining connection between the edge-gadgets $\itn{e_i}$ and $\itn{e_j}$.
%
Lemma~\ref{lem:double exchange} allows to swap the targets of the link from $B$ to $X$ and the link from $i$, and simultaneously undo the exchange in the links from $C$ to $X$ added in step \ref{item:exchange added} above.
%
\displayOcto{\octorollD2}


	\item
The link from $i$ is re-attached to $v$ to yield the final configuration.
%
\displayOcto{\octorollA2}


\end{enumerate}
\end{IEEEproof}



In the exchange of weight elements in the above lemma, weight elements link to weight absorbers in arbitrary fashion.
%
The next lemma will demonstrate how weight absorbers can be exchanged freely, but only with two exchanges at once. 



\begin{lemma}
\label{lem:permute weight absorbers}
If $\links$ is a well linked proof net for $\itn G$ with a free edge-gadget $\itn e$, and $\links'$ agrees with $\links$ up to an even permutation of weight absorbers, then $\links\perm\links'$.
\end{lemma}

\begin{IEEEproof}
Let $e_0$ be the indicator of $\itn e$; since $\itn e$ is free, $e_0$ may re-attach anywhere within the proof net.
%
Let $e_1$ and $e_2$ be arbitrary other $\bot$-occurrences in $\itn e$.

\begin{enumerate}

	\item
To permute two weight absorbers $v$ and $w$ linked to by other edge-gadgets than $\itn e$, attach $e_0$ to $v$, and apply Lemma~\ref{lem:double exchange} to exchange $v$ and $w$, also exchanging the targets of $e_0$ and $e_1$.

	\item
To reinstate $e_0$ as the connection between $\itn e$ and the remainder of the proof net, either perform another permutation as above, or permute $v$ and $w$ twice again, once exchanging the targets of $e_1$ and $e_2$, and once exchanging the targets of $e_2$ and $e_0$.

	\item
To exchange a weight absorber $w$ linked from a $\named d\bot$ outside $\itn e$ for the target $v$ of $e_1$, first attach $e_0$ to $w$, then re-attach $d$ to $v$.
%
At this point, $e_1$ forms the only connect between $\itn e$ and the remainder of the proof net; to reinstate $e_0$ in this role, do as above, producing a net effect of cycling the targets of $e_1$, $e_2$, and $d$.

	\item
Finally, to permute weight absorbers $v$ and $w$ linked by $\itn e$, attach $e_0$ to the indicator target of a vertex-gadget where also another edge-gadget $\itn d$ is connected, with indicator $d_0$ and an arbitrary other $\bot$-occurrence $d_1$.
%
Connect $d_0$ to $v$, and apply Lemma~\ref{lem:double exchange} to permute $v$ and $w$, as well as exchanging the targets of $d_0$ and $d_1$.
%
A second such exchange is needed to re-attach $d_0$ and $d_1$ to their original targets.

\end{enumerate}

In each case, if one of the weight absorbers exchanged is linked to by multiple $\bot$-occurrences within the same weight element, these may be termporarily attached elsewhere.

\end{IEEEproof}


For any configuration $\gamma$ let $\itn\gamma'$ denote $\itn\gamma$ where the first two weight absorbers are exchanged.


\begin{lemma}
\label{lem:completeness}
If $\gamma\perm\delta$ for total configurations $\gamma$ and $\delta$, then either $\itn\gamma\perm\itn\delta$ or $\itn\gamma\perm\itn\delta'$.
\end{lemma}

\begin{IEEEproof}
By Proposition~\ref{prop:partial simulates total reconfiguration} we may assume that $\gamma\perm\delta$ by a sequence of reconfiguration steps over total configurations.
%
We will prove that if $\gamma\perm*\delta$ then $\itn\gamma\perm\itn\delta$ or $\itn\gamma\perm\itn\delta'$.
%
The same proof will show the corresponding case for $\itn\gamma'$ instead of $\itn\gamma$, so that the general case for $\gamma\perm\delta$ follows by transitivity.



Let $\gamma$ and $\delta$ agree on every edge except $e$, where $\gamma(e)=v$ and $\delta(e)=w$.
%
Firstly, using Lemma~\ref{lem:octopus roll}, for the edges $d$ other than $e$ such that $\gamma(d)=v$, the weight elements of the edge-gadgets $\itn d$ may be linked to the constraint elements of $\itn v$, in accordance with the target configuration $\itn\delta$.
%
Since $e$ is mobile in $\gamma$, the weights of the edges $d$ suffice to fill the inflow constraint of $v$, and correspondingly the weight elements of edge-gadgets $\itn d$ suffice to fill the constraint elements of $\itn v$, so that $\itn e$ is free.
%
Next, the indicator vertex of $\itn e$, which links to the indicator target of $\itn v$, is re-attached to the indicator target of $\itn w$.
%
Again using Lemma~\ref{lem:octopus roll}, the weight elements of edge-gadgets connected to $\itn w$, including $\itn e$, may be linked in accordance with $\itn\delta$.
%
The resulting proof net is $\itn\delta$ modulo a permutation of weight absorbers; then it is equivalent to either $\itn\delta$ or $\itn\delta'$ by Lemma~\ref{lem:permute weight absorbers}.
\end{IEEEproof}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\subsection*{Soundness}


It will be shown that proof net rewiring $\itn\gamma\perm\itn\delta$ is sound for \textsc{ncg}-reconfiguration, $\gamma\perm\delta$.
%
To each proof net $\links$ for an encoded constraint graph $\itn G$ we will associate a partial configuration $\gamma=\coitn\links$, such that 1) a rewiring step $\links\perm*\links$ corresponds to a reconfiguration path $\coitn\links\perm\coitn{\links'}$, and 2) it is a retraction of the encoding of configurations, $\coitn{\itn\gamma}=\gamma$.



The configuration $\coitn\links$ will assign an edge $e$ to a vertex $v$ when, in the proof net $(\links,\itn G)$, the edge-gadget $\itn e$ is in the empire of the vertex-gadget $\itn v$.
%
Firstly, it will be shown that $\coitn\links$ is a partial function.


\begin{proposition}[{\cite[Proposition 1.i]{Bellin-vandeWiele-1995}}]
\label{prop:tensor has disjoint subnets}
In a proof net, if vertices $v$ and $w$ are joined by a tensor, then any two subnets of which they are respective ports are disjoint.
\end{proposition}


\begin{lemma}
In a proof net for $\itn G$, an edge-gadget $\itn e$ belongs to the empire of at most one vertex-gadget $\itn v$.
\end{lemma}

\begin{IEEEproof}
Since vertex-gadgets are joined by a tensor, the lemma is immediate from Proposition~\ref{prop:tensor has disjoint subnets}.
\end{IEEEproof}


Next, it will be shown that the appropriate edge-gadgets in the empire of a vertex-gadget $\itn v$ contain sufficient weight elements to fill the constraint elements of $\itn v$.


\begin{lemma}
\label{lem:appropriate edge weights}
In a proof net for $\itn G$, for each node $v$ in $G$, the weights of the appropriate edge-gadgets in the empire of $\itn v$ are equal to or greater than the constraint of $v$.
\end{lemma}


\begin{IEEEproof}
Let $|V|=n$ and $|E|=m$, and consider the vertex $v_i$ and an edge $e$ connecting vertices $v_a$ and $v_b$ where $i\neq a,b$.
%
Each constraint element in $\itn{v_i}$ is an instance of the formula
\[
	C = \bigparr\big(1^{3i+2}\big) \tn \bigparr\big(1^{3(n-i)+3}\big)~.
\]
The two $\parr$-subformulae have a balance of $-3i-1$ and respectively $-3(n-i)-2$.
%
Each weight element in $\itn{e}$ is an instance of 
\[
	W = \bigtn\big(\bot^{3a+2}\big)\parr\bigtn\big(\bot^{3(b-a)+1}\big)\parr\bigtn\big(\bot^{3(n-b)+3}\big)~.
\]
For each of the three $\tn$-subformulae, adding it to the scope of a $\parr$ will change its balance by $3a+1$, $3(b-a)$, and $3(n-b)+2$ respectively.
%
In pairs, they add to the balance of a scope by $3b+1$ (1st and 2nd subformula), $3(a+n-b)+3$ (1st and 3rd), and $3(n-a)+2$ (2nd and 3rd).
%
Since $i\neq a,b$, and since no $\tn$-subformula of $W$ can connect to more than one $\parr$-subformula of $C$ (by Proposition~\ref{prop:tensor has disjoint subnets}), it follows that $W$ can balance the scope of at most one of both $\parr$-subformulae of $C$.


The vertex-gadget $\itn{v_i}$ is the formula
\[
	\itn{v_i} = \bigparr\big(C^{m\times c(v_i)} \big)\parr 1~.
\]
It will be shown that $m$ inappropriate edge-gadgets may balance at most $m-1$ constraint elements $C$.


Let the root nodes of the two $\parr$-subformulae of each instance of $C$ be labelled $x_j$ and $y_j$, for $1\leq j\leq m\times c(v_i)$. 
%
If the scopes $s(x_j)$ and $s(y_m)$ of any $x_j$ and $y_m$ are balanced by weight elements $W$ and $W'$ of the same edge-gadget $\itn e$, then since $W$ and $W'$ are connected by a tensor, there are switchings of $W$, $W'$, $s(x_j)$, and $s(y_m)$ such that $x_j$ and $y_m$ are connected in the proof net for $\itn G$.
%
Then the first constraint element of $\itn{v_i}$ requires 2 edge-gadgets to balance, and each successive element requires one additional edge-gadget.
\end{IEEEproof}



Using the above, a proof net for $\itn G$ may be interpreted as a configuration for $G$.



\begin{definition}
For a proof net $\links$ for $\itn G$, let $\coitn\links$ be the partial configuration for $G$ where $\coitn\links(e)$ is $v$ if 1) $e$ is appropriate for $v$ and 2) $\itn e$ belongs to the empire of $\itn v$, and undefined otherwise.
\end{definition}


To show that rewiring corresponds to reconfiguration under $\coitn-$, we will use the following lemmata.


\begin{lemma}
\label{lem:rewiring within empire}
For a proof net $(\Gamma,\links)$ where $\links(a)=v$ and $w$ names a $\1$-occurrence in $\Gamma$, the following are equivalent:
%
\begin{enumerate}
	\item
$\links\perm*\links'$ where $\links'(a)=w$;
	\item
$w$ is in the empire of $a$; and
	\item
in any switching graph for $(\Gamma,\links)$, the path from $v$ to $w$ does not pass through $a$.
\end{enumerate}
\end{lemma}


\begin{IEEEproof}
By \cite[Proposition 2.a]{Bellin-vandeWiele-1995} 2 and 3 are equivalent.

Next, the empire of $a$ corresponds to the largest subproof $\Sigma$ in any $\Pi\toNet\links$ with as conclusion the introduction rule of $\named a\bot$.
%
By Definition~\ref{def:proofs to nets}, in the translation of $\Sigma$ to a net $\sigma$, $a$ may link anywhere in $\sigma$.
%
Then 2 implies 1. 

Finally, if $\links'$ is a net, and for some switching of $\links$ the path from $v$ to $w$ passes through $a$, then in $\links'$ there is no path between $a$ and $v$ (and two paths between $a$ and $w$) for that switching; then 1 implies 3.
%
\end{IEEEproof}


\begin{lemma}
\label{lem:rewiring preserves empire}
Let $\links\perm*\links'$ by $\links(a)\neq\links'(a)$, and denote the empire of $a$ in $\links$ and $\links'$ by $\sigma$ and $\sigma'$ respectively; then $\sigma\perm*\sigma'$.
\end{lemma}

\begin{IEEEproof}
By Lemma~\ref{lem:rewiring empire} the empires $\sigma$ and $\sigma'$ contain the same $\1$-subformulae.
%
That they must share also any other subformula $A$ follows by the observation that $A\tn\1$ may replace $A$.
%
\end{IEEEproof}




\begin{lemma}
\label{lem:rewiring affects empires}
For proof nets $\links\perm*\links'$, let the empire of a given vertex $v$ in $\links$ be a net for the sequent $\Delta$, and in $\links'$, for $\Delta'$; then $\Delta\leq\Delta'$ or $\Delta\geq\Delta'$.
\end{lemma}


\begin{IEEEproof}
By \cite[Proposition 2.b]{Bellin-vandeWiele-1995} the empire of $v$ is determined by propagation from $v$: 1) through links; 2) up towards subformulae; 3) down from one subformula into a tensor; 4) down from all subformulae into a par; 5) but never down from $v$.
%
Let the link from $a$ be rewired, $\links(a)=w$ but $\links'(a)=w'$.
%
There are four cases.
%
\begin{enumerate}
	\item
If the empire of $v$ is propagated from $a$ to $w$ in $\links$, it includes the empire of $a$.
%
Then by Lemma~\ref{lem:rewiring preserves empire} $\Delta=\Delta'$.

	\item
If the empire of $v$ includes $w$ but not $w'$, then it is propagated through $a$ in $\links$ but not in $\links'$, so that $\Delta\geq\Delta'$.

	\item
If the empire of $v$ includes $w'$ but not $w$, then $\Delta\leq\Delta'$.

	\item
Otherwise, $\Delta=\Delta'$.
\end{enumerate}
\end{IEEEproof}



\begin{lemma}
\label{lem:soundness}
If $\links\perm\links'$ are proof nets for $\itn G$ then $\coitn\links\perm\coitn{\links'}$.
\end{lemma}

\begin{IEEEproof}
The proof will consider the case where $\links\perm*\links'$; the general case follows by transitivity.
%
By Lemma~\ref{lem:rewiring affects empires}, the empire of each vertex-gadget $\itn v$ contains either a subset of, a superset of, or exactly the same edge-gadgets in $\links'$ as it does in $\links$.
%
Let $\itn e_1$ through $\itn e_n$ be the edge-gadgets moving in or out of the empire of $\itn v$.
%
By Lemma~\ref{lem:appropriate edge weights} other edge-gadgets must fill the constraint elements of $\itn v$.
%
Then the corresponding edges $e_1$ through $e_n$ are mobile in $\coitn\links$ and it follows that $\coitn\links\perm\coitn{\links'}$ by moving each $e_i$ in turn, and repeating the same for other vertices.
%
\end{IEEEproof}



%------------------------------------------------------------


\section{MLL proof equivalence is \textsc{pspace}-complete}



%===========================
\bibliographystyle{plain}
\bibliography{../refs}
\end{document}
%===========================


\end{document}












